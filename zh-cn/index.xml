<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>cld4h 的博客</title><link>https://cld4h.github.io/blog/zh-cn/</link><description>Recent content on cld4h 的博客</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Wed, 01 Jun 2022 15:08:51 +0800</lastBuildDate><atom:link href="https://cld4h.github.io/blog/zh-cn/index.xml" rel="self" type="application/rss+xml"/><item><title>论皇帝</title><link>https://cld4h.github.io/blog/zh-cn/p/%E8%AE%BA%E7%9A%87%E5%B8%9D/</link><pubDate>Wed, 01 Jun 2022 15:08:51 +0800</pubDate><guid>https://cld4h.github.io/blog/zh-cn/p/%E8%AE%BA%E7%9A%87%E5%B8%9D/</guid><description>&lt;img src="https://cld4h.github.io/blog/wxt.webp" alt="Featured image of post 论皇帝" />&lt;p>自古以来，皇帝是特别爱被文人谈起的话题。虽然也有不少歌颂皇帝，谴责自己的“臣罪当诛，天王圣明”之类的文字；但更多还是嘲笑侮弄皇帝的。战国时期，孟子谈到殷纣王，直斥为“独夫纣”。睢景臣在《高祖还乡》中对于农村痞子出身的刘邦的流氓作风刻画的淋漓尽致。有人说这是挑战皇权；实际上是皇帝在中国人心中历来就缺少神圣感，谁都可以拿皇帝来开开玩笑。明清两代的笑话里也有许多与皇帝有关的，有的一直流行到现在，而且有明显的类型化倾向。例如许多以乞丐或农民幻想当了皇帝将如何如何之类的笑话就很多。这里举两例。有个花子早上起来肚子咕咕直叫，远处传来炸油条、烙烧饼的香味。他想，我要是做了皇帝，一边是炸油条的，一边是烙烧饼的，我一口一根油条，一口一个烧饼。有个老农，早上起来拾粪，看着自己粪杈已经磨得很短了。他忽然想到，要是我做了皇帝一定打个金粪杈。这样的笑话我们不用分析它是讽刺谁的，但就他们身份与幻想不协调本身是不是在解构着皇帝的神圣？皇帝那个高踞于彩云之端的半神半人之物，居然也是乞丐、农夫头脑中可以企及的了。&lt;/p>
&lt;p>&lt;strong>不过在有皇帝的时代谈论皇帝是危险的，下笔稍有不慎，事涉大不敬，那就不是个人掉脑袋的问题，“大不敬”罪在“十恶”，那是要株连家属的。&lt;/strong> 朱元璋登基后，微服私访，听见人称皇帝为“老头子”，十分生气，对旁边的侍从说，张士诚在苏州一带割据了十来年，至今，人们尚称他为“张王”，我做了皇帝了，这些刁民还称我为“老头子”，为此杀了许多在这一地区居住的平民。直到上个世纪三十年代，杜重远写了《闲话皇帝》，这时帝制已经取消了二十余年，不必担心皇帝找麻烦了，谁料得得罪了东洋皇帝，该国已“妨害邦交”向中国政府抗议，中国的法院也只好判杜重远一年零二个月的徒刑。天皇余威，飘洋过海，远播中国，这可能是作者没有想到的。&lt;/p>
&lt;h2 id="一从水浒传的不反皇帝谈起">一、从《水浒传》的“不反皇帝”谈起
&lt;/h2>&lt;p>这篇《说皇帝》是由研究《水浒传》问题开始的。梁山好汉在大团圆、排座次以后热衷于招安做官，这一点使颇为有造反精神的现代人不满，他们评价《水浒传》是只反贪官，不反皇帝。鲁迅先生就说，一部《水浒》，说得很分明：&lt;/p>
&lt;blockquote>
&lt;p>因为不反对天子，所以大军一到，便受招安，替国家打别的强盗——不‘替天行道’的强盗去了。终于是奴才。（《流氓的变迁》）&lt;/p>&lt;/blockquote>
&lt;p>毛泽东也说：“《水浒》只反贪官，不反皇帝。”又说：“宋江投降，搞修正主义，把晁的聚义厅改为忠义堂，让人招安了。”（《人民日报》1975年９月４日）这些意见在1975年下半年到1976年上半年期间宣传得热火朝天，那时把不敢反宋代皇帝、更不愿替代宋徽宗做皇帝、从而力主招安的宋江，打成了现实中的反面教员。当然这是政治运动，这些只是话头，不必认真对待，但是这种批评也引起我一些想法。&lt;/p>
&lt;p>我想难道宋江如果真的打到汴京，“夺了鸟位”，做了皇帝就不是“叛徒”，而是“革命派”了吗？看来也不是，例如后来的朱元璋真正做了皇帝，历史教科书不也说他“背叛了农民”，登基做了皇帝，成为地主阶级的的“代表”了吗？从这里我发现了史学界评述农民武装斗争史的一个秘密：第一：一切农民武装斗争（一般的史学家只要看到史书记载有“盗”或“贼”，马上称之为农民起义，严谨的史学家还做些分析）都是正义的，而且是正义之师，保护老百姓，并为老百姓报仇，大批屠戮地主恶霸，这是“农民起义”之所以能够推动历史进步的关键所在；第二，“农民起义”的领袖自然是人民的代表，是历史上的伟人，他们做了烈士，更加证明了他们人格的高尚；第三，如果“农民起义”取得了胜利，改朝换代，那么，其领袖必定是投降了地主阶级。这些几乎成为那时论述农民武装斗争的基本原则，但是他们陷入矛盾而不自觉。&lt;/p>
&lt;p>话扯远了，再回到皇帝问题。毛泽东的意见的前题是：他把“农民起义”领袖反皇帝和领袖“想做皇帝”看作是一个无比正确的奋斗目标和具有高尚的政治品质的表现。把想“做皇帝”看成了不起进步思想。只有这样才值得歌颂，这种理论有些令人匪夷所思。&lt;/p>
&lt;p>&lt;strong>实际上中国两千年来各种各样人等争做皇帝的还少吗？&lt;/strong> 梁启超说二十四史是一部“相斫书”，&lt;strong>实际上，它也是一部各路“英雄好汉”争作皇帝史。&lt;/strong> “相斫”就是互相兵戎相见，争做皇帝，争到了就是皇帝，没争到就是贼寇。清末民初苏北桃源有位学者名张相文，他写了两卷的《帝贼谱》。这部著作是根据历史上所记载的“帝王”和“盗贼”起事的事迹合为一编。在序中作者说“成则为王，败则为寇，帝王之号，原不足恃”。他认为凡是敢于争夺天下者都属于“有才有器”之人。这些或者已经做了皇帝，或者“自号为帝”，大家都是就奔着皇帝这个目标去的。这些“帝贼”，也就是“真假皇帝”，张相文就收罗了七百余人，可见历代争做皇帝的人之多。还有许多没有造反、不敢造反的人们，但在内心隐蔽之处也有个做皇帝的梦，争做皇帝真是太多了，可以说“滔滔者天下皆是也”。我还看过一位出身农村的青年剖析自己皇帝梦的文章，他说&lt;strong>许多青年都有“伟人梦”，而“伟人梦与天子意识狼狈为奸，互相催化”，孳生出天降大任，拯救天下，做“真龙天子”的狂想。这是与其他一些民族、国家不同的。&lt;/strong>&lt;/p>
&lt;p>一位同事从日本游学回来，谈到日本民俗时说到，他曾向日本学者问过，日本人有没有想当天皇的？那位日本朋友很惊讶，说那怎么可能呢？天皇是神啊。这个回答使我们这些了解中国传统民风民情的人感到很惊讶，&lt;strong>因为这种意识正与自古以来中国老百姓想法相反，日本人真是缺乏造反精神啊。&lt;/strong>&lt;/p>
&lt;h2 id="二中国人的皇帝情结">二、中国人的皇帝情结
&lt;/h2>&lt;p>自秦始皇发明了“皇帝”这个词以后，仿佛它在人们心目中有着极崇高的地位，似乎是神圣不可侵犯的。说到某个具体的皇帝不能形诸于口头笔下，皇宫中各种各样的巧妙的称呼，以避免直接说到“皇帝”。皇帝的通称是“陛下”，皇帝自称为“朕”，专用的东西要加上“御”字，“御膳”“御妻”之类；对于负面事物，还有一些遮丑的词汇如御敌不力，逃跑了叫“蒙尘”“巡狩”，死了叫“山陵崩”等；甚至用言语冒犯到皇帝就是犯罪，而且在律条上还创造了一个词，称为“指斥乘舆”，都不敢明白地把这条“罪行”说成是“指斥皇帝”。可见其地位神圣与尊崇。&lt;/p>
&lt;p>可是与“皇帝”取得到极其尊崇的地位的同时，它也成为各个阶层的人们追逐的目标。秦末陈涉吴广起兵反秦，陈涉就用“王侯将相宁有种乎”来鼓励造反者，陈涉本人的目标就是做皇帝（这从他不尊奉楚国之后就可以得知）。项羽、刘邦看到秦始皇的威风和气派，项羽说“彼可取而代之”。刘邦说“大丈夫当如此也”。&lt;strong>陈涉是贫雇农，项羽是没落贵族，刘邦是接近游民的农村基层干部。他们无一例外地都想当皇帝，真是无师自通、不学而能。&lt;/strong> 这种皇帝情结当然不只是他们三个人的，只要天下出现乱象，起兵争帝者便大有人在。&lt;/p>
&lt;p>五胡十六国期间有件真事。据《资治通鉴》卷113所记，建平四年（403）南燕慕容德统治的泰山地区，有个叫王始的起事造反，聚众数万，自称为太平皇帝，置署公卿百官，封其父为太上皇，其弟为征东王，征西王。但很快他就失败了，被俘虏，斩于市。在行刑时，看热闹的见只有王始和他的妻子，还觉得不过瘾，就问：“造反是要杀全家的，你的父亲兄弟呢？王始回答说：“太上皇蒙尘于外，征东征西被乱兵所杀，我虽然没死，现在还有什么指望呢？”其妻赵氏听了十分生气：“就是你那张破嘴，老爱胡说，要不我们怎么会到这种地步？”王始回答：“皇后不懂天命，自古至今，哪有不亡之国？”才做了几天皇帝？对皇帝身份的认同感简直达到了痴迷的程度。可惜的是，他的力量不够，否则谁能说他错呢？&lt;/p>
&lt;p>每到乱世都会出现大批的逐鹿者，在不断的征战杀戮中，更强者胜出，逐渐被当时和以后的历史承认。东汉末，天下大乱，曹操以武力平定北方，他就说“设使国家无有孤，不知当，几人称帝，几人称王”（《让县自明本志令》）。这是老实话，但是他还是没有亲自篡汉做皇帝，把这个辉煌留给了儿子曹丕。&lt;/p>
&lt;p>&lt;strong>皇帝的情节不仅出现在乱世，天下无事之时，想做皇帝的野心家也不能说没有。&lt;/strong> 那些有可能逐鹿天下的人物有“帝王思想”，有“做皇帝”的野心，还情有可原。因为历史毕竟给了他机会，不管这个机会有多么小。可悲的是那些生活中的失落者，或是因为痴呆愚昧，或是由于狂妄无知，或是被他人利用也会生出“做皇帝”的幻想。他们更让人感到可笑和可悲。&lt;/p>
&lt;p>吴趼人的《二十年目睹之怪现状》的第八十回就写一个算命的骗子，为了从一个富翁那里骗钱，谎称他的女儿有正宫娘娘的命，将来要嫁给皇帝。为了要圆上这个谎，骗子在大街上找了一个有些愚昧痴呆的樵夫，说他将来要当皇帝，在这个骗子花言巧语地说服下，樵夫居然相信自己有当皇帝的命，也自然而然地称孤道寡起来，在富翁的后花园里关起门来做皇帝，并以为自己是真皇帝了，直到被抓起来为止。&lt;/p>
&lt;p>最近出版的《中国底层访谈录》中也写了一个关在狱中的“皇帝”曾应龙。这个人想“做皇帝”，犯了颠覆罪、反革命罪，政府念其愚，只判他无期徒刑。虽然他以性格乐观、服从管理，警察、犯人都对他印象不错，但是他的“做皇帝”的思想意识没有什么改变，仍然自称“真龙天子”，张口“朕”，闭口“口谕”，说自己的过去是“顺应天命，回乡登基”建国“大有”，可笑又可悲。听从事公安工作的人们说，解放以来像这样人物并非绝无仅有，而是年年都要出几起类的事件。都到二十一世纪，帝制被推翻近一百年了，做皇帝的意识仍然没有从许多人的头脑中退去。只要看一下荧屏银幕就可以感觉到，大辫子满台跑，满清入关后的十位皇帝轮流上，从创作者对他们的美化和观众对这些剧目的欢迎可见人们对于帝王威势的崇拜和羡慕。&lt;/p>
&lt;h2 id="三帝情结来源">三、帝情结来源
&lt;/h2>&lt;p>为什么中国能够形成皇帝情结，而且至今还不能完全消退？大家感到很奇怪，其实，&lt;strong>这反映了人性中对权力的渴望，权利平等的民主制度建立不起来，社会上存在权利不平等，人性中想要追求最高权力的渴望就不可遏制。&lt;/strong> 这如同排队顺序上车一样，这种排队制度建立不起来，就不能制止上车时的争抢。&lt;/p>
&lt;h3 id="1-皇帝的权力">1. 皇帝的权力
&lt;/h3>&lt;p>中国的皇帝大约是世界上权力最大的，因为从理论上他兼有四大权力。&lt;strong>一是政权&lt;/strong>，皇帝是&lt;strong>国家的首领&lt;/strong>，他对全国的土地人拥有无限权力，《诗经•北山》中说：“溥天之下，莫非王土；率土之滨，莫非王臣”。今人的胆子超过了古人，有个小土皇帝竟敢说他是：“上管天，下管地。中间管空气。”古人只敢承认自己是奉天管民的；&lt;strong>二是神权&lt;/strong>，也就是君权神授。&lt;strong>皇帝是天子，是天在人间的惟一的代表，代表天统治人们&lt;/strong>，《尚书•盘庚》中明确地说“予迓续乃命于天，予岂汝威，用奉畜汝众”（意为：你们的命是我从老天那里讨来的，我不是威吓你们，你们是要靠我养活的）；&lt;strong>三是父权&lt;/strong>，古代是宗法制，周代天子是宗子，代表血统，管理本族人民，所以&lt;strong>老百姓不仅是臣民，而且是子民&lt;/strong>；后世人民构成日益复杂，天子统治尚有先秦遗意；&lt;strong>四是道统&lt;/strong>，即所谓&lt;strong>真理权，或说话语权，因为中国是政教合一的的国家。这个“教”不是佛教、道教，而是教育的“教”&lt;/strong>。荀子认为君主的职责就在于养人、治人、用人、教育人。孟子也强调“天降下民，作之君，作之师”。君王是老百姓的老师，后代臣民称当今皇帝为“圣人”，其道理就在此。因此&lt;strong>从理论上来说皇帝是永远正确的，是真理的代表，永远有理&lt;/strong>。他拥有话语权力，即使人们与他对话，也得在他的话语权力范围之内讨论问题。&lt;strong>总之，在平民百姓看来，皇帝的权力可以在物质领域和精神领域无限延伸。这一点对于没有强烈宗教信仰的人们特别重要，因为它几乎包括了人在世俗中的一切追求。&lt;/strong>&lt;/p>
&lt;h3 id="2-皇帝令众生羡慕之处">2. 皇帝令众生羡慕之处
&lt;/h3>&lt;p>皇帝让众生心生羡慕的除了物质上、精神上的享受的无穷无尽，更重要的还是&lt;strong>他们不受监督的权力绝对性&lt;/strong>。人有生以来，无不受制于人、无不受制于外界，这给人追求带来极大的限制。&lt;strong>惟有皇帝的意志可以自由伸张，这才是令人垂涎三尺的。老百姓设想皇帝是金口玉言，只要他说了话，连鬼神也要无条件执行。&lt;/strong> 《镜花缘》中写女皇帝武则天在严冬时醉酒，降旨要百花开放下楼，当时百花仙子不在洞府，众花神不敢违旨，按时开放。可见皇帝的权威膨胀到人间以外。中国古代社会是垂直型金字塔型的，皇帝就是坐在金子塔尖的人物，这怎么不被人羡慕呢？&lt;/p>
&lt;p>“食色”这些低层次的要求，有些人看来只要有钱就能够做到。在权力本位的中国就不是这样。各个领域都是权力优先的。例如某些物质资源是极有限的，没有优先权的，就很难染指。你有钱，但买不来，或根本不卖给你，更可能你根本就不知道，没有这方面信息，连买的欲望都不会产生。而此时权力就显示出他的优越性。皇帝能充分享用在他统治的这块土地上的最佳物品。人们千辛万苦生产出的产品，只要有特点，不管产量多少，其中最好的都要保证进贡，而且人们往往主动进贡。我去过许多地区，很多有优质产品的地方以他们有进贡的义务而自豪，有个地方竟以向皇帝供奉搓脚石而自吹自擂，真是令人忍俊不禁。&lt;/p>
&lt;p>&lt;strong>在精神上自由伸张更是众生永远不能企及的。老百姓不管有钱没钱，他们在精神上是长期的匍伏在统治者脚前，意志踡踞，不得伸张，有时他们也有精神解放的渴望（这种“解放”往往是设想自己也像皇帝一样能够杀伐决断，像皇帝一样意志自由伸张）。一旦他们能够像阿Q那样说“我要什么就是什么，我喜欢谁就是谁”。用自己的喜怒哀乐去安排社会，乃至大自然，这才是他们的盛大节日，然而这时可能是换了一个新皇帝，更可能是遍地的皇帝。&lt;/strong>&lt;/p>
&lt;p>&lt;strong>皇帝拥有绝对的权力却受不到有效的监督。&lt;/strong> 从理论上说，皇帝是受到多方面监督的。首先是要受到上天的监督，他是上天的儿子嘛，当然要受到父亲的监督。然而“天何言哉”，天只能以出现灾害的方式示警，这是模糊的，往往是无针对性的。所以不能算是有效监督。虽然早在《尚书•泰誓》中就讲“天视自我民视，天听自我民听”，把“天”的监督权，转让给老百姓了，但是老百姓在现实中没有可操作性的实施的可能，&lt;strong>一监督说不定会被打成“大不敬”，身首异处；&lt;/strong>&lt;/p>
&lt;p>另外还要受到“道统”的监督，&lt;strong>“道统”和“治统”之间原本是存在一些张力的&lt;/strong>，汉代有的憨直的儒生以荷担道统自命，指斥皇帝，甚至认为皇帝已经不能代表天命，劝他下台。这种儒者后世就很少见了。有些儒者把“圣人”的高帽给皇帝戴上，皇帝又成为道统的代表，治统和道统的合一，使道统的监督作用流于徒具虚名。难道自己能监督自己？仿佛小偷左手要偷东西，右手不能他偷？&lt;/p>
&lt;p>其次还有左右“言官”（即古代政权建构中的监督制度）史官的监督。这是在皇权专制主义建立时就设计好了。周代就有“左史记言，右史记事”之说，而且史官所记有其褒贬含意在其中，这一点到孔子作《春秋》集大成。这是客观的记载和善恶是非的评价来实施监督，后来的历代王朝里都有“言官”，如御史、谏议大夫、拾遗补阙等都是法定具有监督皇帝职责的。可是这些面对皇帝的绝对权力，它们也都是软弱无力的，而且“记言记事”的皇帝“实录”也可以改来改去。清代康熙末年的《实录》就被雍正改得一塌糊涂，为的是掩盖其谋篡的真像。后世的史官也很少有像春秋时代董狐那样的直笔了，董狐宁肯死，也要记载真实的历史，后代史官惟上意是承（即使有董狐那样的史官也被杀了，而且后世不得闻知）。这些监督充其量也只是软监督。有的史学家认为这些监督制度不过是专制主义的补充，这是有道理的。&lt;/p>
&lt;p>没有了监督，得到的就不必担心失去，可以长期保有，这是一般人的逻辑。一般人即使在物质上和精神得到了满足，随时都可能失去，皇帝的权力的绝对性，使他的手可以伸向每一个臣民的钱包里、家里、头脑里。&lt;strong>在人们心目中只有皇帝才能牢牢地保有这一切。&lt;/strong>&lt;/p>
&lt;h3 id="3-皇帝轮流做">3. 皇帝轮流做
&lt;/h3>&lt;p>另外，皇帝又有不神圣的一面。中国朝代的周期基本上是二、三百年一变，在战乱之中，“几人称帝，几人称王”的情况是经常出现的，&lt;strong>与日本天皇的“千年一系”不同，中国的皇位像走马灯一样，“乱哄哄，你方唱罢我登场”&lt;/strong>。从这一点上来说，&lt;strong>皇帝又是平淡无奇、毫无神圣可言的&lt;/strong>。中国近两千年中，社会的垂直流动是很剧烈的，&lt;strong>变动最大的就是最上层的皇室和最下层的游民&lt;/strong>。五代以来，确实有些&lt;strong>游民做了皇帝，五代十国时期大多数的皇帝与国主是各色游民出身，以兵痞为多&lt;/strong>。在全社会看来，皇位不仅最被人们羡慕，只要自己荣膺“天命”，是有可能争取到的。正是适应这种想法，社会各种预言天道有变、天命所归的传说、故事乃至书籍流传（《烧饼歌》《推背图》等），挑动着普通老百姓暴得富贵的野心，这样才会有&lt;strong>孙悟空所说的“皇帝轮流做，明年到我家”的说法。这种“皇帝流传做”想法在其他民族文化中可能还是不多见的&lt;/strong>。&lt;/p>
&lt;h4 id="从受命于天到产业花息">从“受命于天”到“产业花息”
&lt;/h4>&lt;p>从社会发展史来看，皇帝是氏族首领、部落联盟长等发展来的。先秦许多思想家认为“天生烝民而立之君”，这大体上是符合事实的。但什么人作“君”呢？在科学和生产还不发达的时代，大家认为这是“受命于天”（夏代、殷代都有这种说法）。唐代柳宗元在《封建论》中对这种现象做符合实际的解释。他说生人之初，人们在获取生活资料和与大自然作斗争中，为了更好地和谐相处，有纷争能够得到及时的解决，必然要有“智而明者”为“君长”，帮助大家明断是非。柳宗元从社会发展角度解释了人们头顶上的领导是为了生存需要而产生的。他们手中的权力也是他所在生活、生产的集团给的。用现在的话说就是他们所掌握的是处理公共事务的权力，这个权力是该群体的全体成员共同委托给他的。这个人经验要比一般人多些，头脑聪明一些，更受到全体成员尊敬和信赖一些。有时他们还担任着与上天沟通的职责，他们是巫师。这种人往往是由这个群内体辈份高、年龄老的的长者的来担任。&lt;/p>
&lt;p>这些首领一般是深受人们爱戴和信仰的，他们既有权利，也有义务，如果发生了巨大的灾难，他们是要以身殉的。《吕氏春秋》记载，汤战胜夏桀以后，天大旱五年，颗粒不收。汤以天子之尊，“以身祷于桑林”，将自己为牺牲以祭天。结果天降大雨。这是天子的职责，天子受命于天，既可以代天惩罚违反天道的人，如果天降大灾，天子也要承担责任。这体现了权利与义务的均等原则。这也是“受命于天”的真正含义（可是到了后代，把这个责任推给了宰相，皇帝单独享受权利，把职责推给下级）。此时群体内对于掌握公共权力的人，也能实施一些监督，甚至把严重违反民意的“君长”拉下来，或赶走。殷代初贤相伊尹把特别“暴虐”的汤的继承者太甲放逐到桐宫，三年以后太甲悔过而后伊尹还之政。&lt;/p>
&lt;p>明末黄宗羲《原君》中对于当时君主的权力和作为有很生动的描绘。他们打江山时“屠毒天下之肝脑，离散天下之子女”。此时说这是为了子孙万代“创业”；既得天下，坐江山之时，则“敲剥天下之骨髓，离散天下之子女，以奉我一人之淫乐，视为当然，曰‘此我产业之花息也’”。汉代刘邦取得天下后，就在他的老爸面前得意洋洋地说：你以前老说我没出息，认为老二能治家、置产业。你现在看看，到底是谁挣的家业多呢？这是把整个天下都看成是自己的产业，自己爱怎么花就怎么花。&lt;strong>把老百姓委托的公共权力变成自己个人的私产，此时皇帝已经完全变成天下的大害。&lt;/strong> 黄宗羲的话说得很生动，也是打穿后壁之言。更值得关注的是为什么社会或者说一个群体必须有的掌握公共权力、为群体办事的首领，会演化至高无上、半神半人的皇帝？&lt;/p>
&lt;p>权力这东西与物质利益和精神上的好处联系在一起的，掌握它的人，如果没有监督，非常容易用它来为自己谋利益。如果这个群体比较小，只是由几十家、数百家组成的一个氏族，居住也不太分散，彼此都有血缘关系。人们所处的就属于熟人社会。大家彼此相知，社会地位的高低、财富的多少都不会相差太远。此时的首领是靠自己条件的优越而成为群体的领导者的。他不顾治下的平民百姓，老百姓就会不拥护他，就会弃他而去。这种意识直到春秋时代对一些小国的君主还有影响。《诗经•硕鼠》中就表达了老百姓要弃统治者而去的激愤心情。《左传》记载邾文公要迁都，占卜说“利于民而不利于君”。邾文公回答“天生民而树之君”。对民有利就足够了。小群体、乃至小国之君离民众上不太远，权力的来源，不论授予者还是被授予者都看得很清楚的。人多了，首领被授予的权力也随之水涨船高。一千人的一个氏族就与一万人的不同。作为氏族首领他统率的、管理的人多，自然感觉权力大。&lt;/p>
&lt;p>大国的君主，出则车马，入则深宫。君主与臣民之间地位悬绝，权力授予的实质被距离淡化了。君王说“我不有命在天？”这种话头在氏族那里只是神道设教，在大国君主那里则是百分之百的真理。而且国越大，君主位置越高，君民位置相隔越远，君主的威风越大，老百姓对他也就越怕。秦国主的祖先不过是为周天子养马驾车，直到周平王时秦襄公救周有功才被任命为诸侯。此时秦国土仅仅有今陕西西部一小块土地，此时君主与臣民生活相差不会太多，可是秦始皇一统天下，其威仪竟吓得十三岁就敢杀人的刺客秦舞阳全身发抖。皇帝的威风给老百姓带来的震慑可以想见。大一统的皇帝和小国之君权力相差之远是不可以道里计。因此夜郎之君要与汉朝大皇帝一较短长，召来千古讪笑。&lt;/p>
&lt;p>另外，君臣民之间的直接关系变成了间接的关系。这也与群体的大小有关。群体大了，居住范围广了，君王不能事必亲躬，君臣民之间建立层层机构，这种层级越多君臣民相隔越远。人和人的亲自接触会使双方产生一定的感情，破除某些因为利益不同而产生的误解与不信任，这与面对冷冰冰的机构时的感觉是完全不同的。机构是人异化的产物，它增加着统治者与被统治者之间的对立性，也张扬着统治者的权威，让人们感觉压迫的沉重。&lt;/p>
&lt;p>到了秦始皇一统中国之后，皇帝的权力达到了极点。把“皇”“帝”两字连成一个固定名词以称天子，这是从秦始皇开始的。“皇”字始见于金文，《说文古籀补》中“皇”字头上有三竖，下作土。并言“日出土则光大”。“帝”字则最早见于甲文。胡厚宣说：“武丁时，帝为天神之专称，至廪辛、康丁以后，人王始称帝。”实际上在周代“皇帝”作为一个词组已经出现过。《尚书•吕刑》有言：“皇帝清问下民，鳏寡有辞于苗。”此句还被《墨子•尚贤》引用。可是这里的皇帝不是指周天子，而是指先圣帝尧。“皇”是修饰词，用以形容帝尧光芒万丈。当秦始皇把“皇帝”作为固定名词，用以称呼天下共主的自己，并宣布这个皇帝要在自己的子孙后代中千世万世的传下去。这个词获得了最绝对的意义。由于这个准备用千世万世的名号，没有想到只用了二世（而且第二世只有短短的几个月），于是，人们把获得和失去皇帝这个名号看成轻而易举的事。自古以来，人们既尊崇这个名号，由于它给人们带来意想不到的巨大利益或危害；人们也轻易它，它是那么容易地失去或得到。&lt;/p>
&lt;p>也是自秦代以后，皇帝代表了最高的权力，同时它也成了一切利益的象征。打下江山之后，皇帝及其大臣所获得的物质上的满足和自我感受的辉煌在感到“受命于天”的同时是自己所挣下的产业的“花息”。因此它才引得千千万万人的向往和追逐。&lt;/p>
&lt;h4 id="打江山争皇帝的两种兴奋剂">打江山、争皇帝的两种兴奋剂
&lt;/h4>&lt;p>宋代以前，虽然争皇帝、打江山的行为代代有之，社会上的各类人等的或公开、或隐秘想做皇帝的恐怕也不在少数，可是很少有文学作品反映这个问题。前面我们引得项羽刘邦陈涉吴广的那些大胆的言行都是史书中正式记载的。而到了宋代和宋代以后通俗文艺作品大量产生，打江山、做皇帝就成为通俗文艺作品的一个重要主题。这些通俗文艺作品就成为鼓动人们打江山、做皇帝的兴奋剂。另一种兴奋剂就是我在前面谈到的各种各样的“昭示天命”的谶纬迷信的书籍。这种思想意识最初就来自于皇帝是“受命于天”。它的渊源更久远。秦始皇时就有许多谶言预示“始皇帝死而地分”。如“楚虽三户，亡秦必楚”，“亡秦者，胡也”等等。唐代《推背图》（据说是唐初预言家李淳风所作），在战乱数十年不止的五代十国期间特别流行，传说赵匡胤坐皇帝后想制止而不可能，干脆弄乱了其次序，使其预言不准，失去了读者的信任。这种书籍和传言挑动人们内心中对皇帝位置的觊觎。这又是一种兴奋剂。有的人被一些相面算命的被说成“贵不可言”，是有做皇帝的命，这就很能给人以鼓动。&lt;/p>
&lt;p>宋代通俗文艺作品中，把描写强烈追求提升自己社会地位直至“做皇帝”的作品称之为“发迹变泰”类，把描写闯江湖、打江山的作品称作“朴刀杆棒”类。所谓“发迹变泰”类是指写下层社会人士（大多是游民）的皇帝梦的（或退而求其次，做达官贵人）作品。所谓“朴刀杆棒”类的作品主要是写那些怀抱着“发迹变泰”愿望的江湖人，通过自己的一刀一枪，打江山，坐江山。这些作品对于后世怀抱着做皇帝理想的人们无疑是充满鼓舞的。&lt;/p>
&lt;p>&lt;strong>从中国人的“皇帝情结”的强烈来看，梦想“做皇帝”，武装起来“反皇帝”都不是什么了不得的优秀的政治品质，只要情势许可，或者主持者认为情势可能，按照中国人的思维定式许多人都会这样干，但以挣扎在生死线上的游民表现得最为积极，因为只有这样才能彻底解决他们的问题。&lt;/strong> 《水浒传》中不想做皇帝的的意识在众多的造反活动中是个异数，它非是他们不向往那个崇高的位置，而是它产生的具体的社会环境限制了它。《水浒传》作为文艺作品议及皇帝的地方不多，因为它自南宋时就已在社会上公开演出，南宋说北宋的故事，其忌讳一定很多，不可能正面大肆描写下层人士争相抢做北宋皇帝的故事，这是要触犯朝廷的律条的。因此书中虽然李逵说过让晁盖哥哥做“大皇帝”，宋江哥哥做“小皇帝”，（第四十一回），晁盖去世后，李逵又鼓动宋江“做了大宋皇帝”（见第六十回，就是这两句话也不一定是宋代话本流传下来的，而是明代作者的笔墨）。作者对此还是持批评态度的，而且李逵是个粗人，对现实问题没有合乎实际的考量，并不能代表水泊梁山的主流意见，所以他才能说出这样的话来，听众也能容忍，官方才不会计较。而宋江是梁山上的领导人，他要从梁山的全局和当时的情势考虑，没有想争皇帝做，但不等于他没有政治上的诉求。&lt;/p>
&lt;h4 id="水浒传中的皇帝梦">《水浒传》中的皇帝梦
&lt;/h4>&lt;p>《水浒》中一些特别讲义气（通俗地说就是肯花银子）、滥交江湖豪杰的人物都是有“异志”的。柴进是后周世宗柴荣裔孙，按照朝廷的规矩，他本是应该侍奉周室陵庙香火的，可是“专一招接天下往来的好汉，三五十个养在家中”，还扬言在家里接待流放犯人，又与占山为王的梁山好汉交厚。柴进放着好好的日子不过，冒着风险干这些违法的事情干什么？是不是有什么不轨的企图，其中是否包含着对曾经有过的帝位的怀恋？这些只有柴进自己知道，但官府要整柴进则一定会从这个角度去看的。作者创造这样一个人物形象绝不是为了在梁山泊里增加个贵族，而是暗示着梁山好汉中如果从血统上来说有足以做皇帝的。这是不是写出了梁山好汉们内心的隐秘之处对皇帝位置的欲求。&lt;/p>
&lt;p>另外，东溪村的“富户”晁盖，“专爱结识天下好汉，但有人来投奔他的，不论好歹，便留在庄上住。若要去时，又将银两赍助他起身，最爱刺枪使棒，亦自身强力壮，不娶妻室，终日只是打熬筋骨”。他要干什么不是很明显吗？可以看出这些特别注重“义气”，广交天下豪杰的人们，实际上都是在暗地制造一种组织的力量。在专制社会里，只有政府才是有组织的力量，而 平民只是单个的人，政府可以随意压迫整治百姓。一些人用钱财把有反抗力的人们组织起来，本身就是与政府对抗，其内心深处必定隐藏着强烈的政治诉求的，这一点江湖上的人们都知道。除了晁盖在“智取生辰纲”中有所表现外，《水浒》的作者没有说破，但这些细节的指向还是很明显的。&lt;/p>
&lt;p>柴进没有自己拉杆子干事，晁盖早死，其盖棺论定只是个山大王。《水浒传》中喜爱交接天下豪杰的人物中只有宋江表现出其政治上的诉求。他“平生只好结识江湖上好汉，但有人来投奔他的，若高若低，无有不纳，便留在庄上馆谷，终日追陪，并无厌倦。若要起身，尽力资助，端的是挥霍，视金似土。”而且，家里还有地窨子，以备不时之需。梁山的第一把手是宋江，从他向往“招安”的政治方案中可见他的诉求是作宋朝的官吏，“封妻荫子，福祚绵长”。论者鄙视这种没有“大志”的诉求，认为想做皇帝才好。实际上天下皇帝只有一个，在这座王朝大厦没有倒塌时，这种取向要受到统治者的全力反击的，成功的概率很小。与此相反，如果退而求其次，当自己有一定力量的时候，伸手向皇帝要官做，这样成功率就很大。它往往只是皇帝一句话而已。南北宋之交，武装造反的人们，待自己羽毛丰满之时，再投降朝廷做官是很普遍的事，所以当时老百姓有“若要官，杀人放火受招安”之说。这种政治诉求倒不是游民所独有的，被迫揭竿而起的人们大约都有这种心态。不过如果考虑到《水浒》的故事，最早是由江湖艺人，这个游民群体创造的，他们是从游民的“变泰发迹”理解梁山好汉的政治诉求的。&lt;/p>
&lt;p>&lt;strong>帝制的覆灭已经快一百年了，但皇帝的阴魂尚未散尽，但愿人们早日走出皇帝的阴影。&lt;/strong>&lt;/p></description></item><item><title>Linux 下的「全过程翻墙」</title><link>https://cld4h.github.io/blog/zh-cn/p/linux-%E4%B8%8B%E7%9A%84%E5%85%A8%E8%BF%87%E7%A8%8B%E7%BF%BB%E5%A2%99/</link><pubDate>Wed, 04 May 2022 16:19:40 +0800</pubDate><guid>https://cld4h.github.io/blog/zh-cn/p/linux-%E4%B8%8B%E7%9A%84%E5%85%A8%E8%BF%87%E7%A8%8B%E7%BF%BB%E5%A2%99/</guid><description>&lt;img src="https://cld4h.github.io/blog/p/the-ultimate-way-to-bypass-gfw-on-linux/iptables.webp" alt="Featured image of post Linux 下的「全过程翻墙」" />&lt;p>本文展示了在Linux下使用clash和iptables搭建透明代理进行翻墙的步骤&lt;/p>
&lt;p>我们用到了&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/Dreamacro/clash" target="_blank" rel="noopener"
>clash&lt;/a> 作为代理程序&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/tindy2013/subconverter" target="_blank" rel="noopener"
>online subconverter&lt;/a> 和 crontab 来定期更新配置文件&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/ACL4SSR/ACL4SSR/tree/master" target="_blank" rel="noopener"
>ACL4SSR&lt;/a> 来提供GFW屏蔽域名规则&lt;/li>
&lt;/ul>
&lt;p>你可以从 &lt;a class="link" href="https://gist.github.com/cld4h/9a03ec2f826a25be5ab974fdbc540de4" target="_blank" rel="noopener"
>github gist&lt;/a> 来下载本文中提到的文件。&lt;/p>
&lt;p>配置所需的全部文件：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── clash-base-config.yaml ---🟢clash的基础配置以使其工作在tproxy和fake-ip模式
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── clash.service ---🟢systemd 配置文件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── clean.sh ---🟢清理iptables的脚本
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── config.ini ---🟢subconverter的配置文件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── iptables.sh ---🟢iptables配置文件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── update-config.sh ---🟡订阅更新脚本; 须将&amp;#34;XXXXXXXX&amp;#34;替换成你的订阅地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── config.yaml ---⭕clash 配置文件, 须从update-config.sh生成
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── README.zh-cn.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">🟢: 无需修改
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">🟡: 需要修改
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">⭕: 需要生成
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="参考">参考
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.sobyte.net/post/2022-02/clash-tproxy/" target="_blank" rel="noopener"
>clash-tproxy&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://git.breakpoint.cc/cgit/fw/tcprdr.git" target="_blank" rel="noopener"
>Transparent proxy demo code&lt;/a>&lt;/p>
&lt;h2 id="准备条件">准备条件
&lt;/h2>&lt;ul>
&lt;li>安装好的 &lt;code>clash&lt;/code> .(默认在 &lt;code>/usr/bin/clash&lt;/code> 路径下)&lt;/li>
&lt;li>iptables&lt;/li>
&lt;li>systemd （你完全可以使用其他的启动程序，这不过在这里我只展示systemd的配置过程，因为大多数GNU/Linux发行版默认使用systemd）&lt;/li>
&lt;li>crontab&lt;/li>
&lt;/ul>
&lt;h2 id="步骤">步骤
&lt;/h2>&lt;h3 id="创建一个名为clash的系统用户">创建一个名为clash的系统用户
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">useradd -r -M -s /usr/sbin/nologin clash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>由于我们要做全局的透明代理（代理网卡上的全部流量），所有我们需要避免代理软件发出的流量再次进入代理软件形成回路无限循环。&lt;/p>
&lt;p>因此，我们创建一个独立的用户 &lt;code>clash&lt;/code> (名字可以是任意的，但要一致) 来运行代理软件。
之后通过iptables的规则将 &lt;code>clash&lt;/code> 用户的流量分离出来。&lt;/p>
&lt;h3 id="创建iptables和路由规则">创建iptables和路由规则
&lt;/h3>&lt;p>创建一个内容是iptables命令的shell脚本 &lt;code>/etc/clash/iptables.sh&lt;/code>.&lt;/p>
&lt;p>文件包含三个主要部分：&lt;/p>
&lt;ol>
&lt;li>iptables规则用于劫持DNS请求流量&lt;/li>
&lt;li>PREROUTING 中 &lt;code>clash&lt;/code> 链的配置&lt;/li>
&lt;li>OUTPUT 中 &lt;code>clash_local&lt;/code> 链的配置&lt;/li>
&lt;/ol>
&lt;p>iptables 示意图:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">┌─────────┐ ┌─────────┐
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ PREROUTING INPUT │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ┌─────────────────────────────────────┐ ┌────────────────────┐ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ /───\ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ ┌───┐ ┌─────────┐ ┌──────┐ ┌───┐ │ / \ │ ┌──────┐ ┌──────┐ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├──┤►│raw├─►│conntrack├─►│mangle├─►│nat├─┼──────►&amp;lt;routing&amp;gt;──────┤►│mangle├─►│filter├─┤►│ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ └───┘ └─────────┘ └──────┘ └───┘ │ \ / │ └──────┘ └──────┘ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ \─┬─/ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └─────────────────────────────────────┘ │ └────────────────────┘ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ┌──────────┐ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ ┌──────┐ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │mangle◄─┼─────────┘ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ Network │ │ └──┬───┘ │ │ Local │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│Interface│ │ │ │ FORWARD │ Process │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ ┌──▼───┐ │ /───\ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ┌───────────────┼─┤filter│ │ / \ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ └──────┘ │ &amp;lt;routing&amp;gt;◄─┤ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ │ \ / │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ └──────────┘ \─┬─/ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ┌────────────┼────┐ ┌──────────────────────────────────────────┼────┐ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ │ ───── │ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ ┌───┐ ┌───▼──┐ │ / \ │ ┌──────┐ ┌───┐ ┌──────┐ ┌─────────┐ ┌▼──┐ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │◄─┼─┤nat│◄─┤mangle│◄├───&amp;lt;reroute&amp;gt;───┼─┤filter│◄─┤nat│◄─┤mangle│◄─┤conntrack│◄─┤raw│ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ └───┘ └──────┘ │ \check/ │ └──────┘ └───┘ └──────┘ └─────────┘ └───┘ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ ───── │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └─────────────────┘ └───────────────────────────────────────────────┘ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ POSTROUTING OUTPUT │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─────────┘ └─────────┘
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>/etc/clash/iptables.sh&lt;/code> 内容如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/usr/bin/env bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># set -ex 选项说明:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -e 当有命令以非0值退出时立刻结束执行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -x 当命令执行时打印命令及其参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> -ex
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ENABLE ipv4 forward&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sysctl -w net.ipv4.ip_forward&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ROUTE RULES&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip rule add fwmark &lt;span class="m">666&lt;/span> table &lt;span class="m">666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route add &lt;span class="nb">local&lt;/span> 0.0.0.0/0 table &lt;span class="m">666&lt;/span> dev lo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## hijack the dns query traffic ##&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 转发从局域网收到的所有 DNS 查询流量到 1053 端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 此操作会导致所有 DNS 请求全部返回虚假 IP(fake ip 198.18.0.1/16)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -I PREROUTING -p udp --dport &lt;span class="m">53&lt;/span> -j REDIRECT --to &lt;span class="m">1053&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ipv6 同样配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -I PREROUTING -p udp --dport &lt;span class="m">53&lt;/span> -j REDIRECT --to &lt;span class="m">1053&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 转发从所有本机进程（除去uid为clash的进程）收到的所有 DNS 查询流量到 1053 端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 此操作会导致所有 DNS 请求全部返回虚假 IP(fake ip 198.18.0.1/16)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -N clash_dns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -A OUTPUT -p udp --dport &lt;span class="m">53&lt;/span> -j clash_dns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -A clash_dns -m owner --uid-owner clash -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -A clash_dns -p udp -j REDIRECT --to-ports &lt;span class="m">1053&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ipv6 同样配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -N clash_dns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -A OUTPUT -p udp --dport &lt;span class="m">53&lt;/span> -j clash_dns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -A clash_dns -m owner --uid-owner clash -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -A clash_dns -p udp -j REDIRECT --to-ports &lt;span class="m">1053&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##############################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## config for `clash` chain ##&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##############################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># `clash` 链负责利用tproxy将流量转发到clash的7893端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -N clash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 目标地址为局域网或保留地址的流量跳过处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 保留地址参考:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># https://zh.wikipedia.org/wiki/%E5%B7%B2%E5%88%86%E9%85%8D%E7%9A%84/8_IPv4%E5%9C%B0%E5%9D%80%E5%9D%97%E5%88%97%E8%A1%A8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># https://zh.wikipedia.org/wiki/%E4%B8%93%E7%94%A8%E7%BD%91%E7%BB%9C&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IANA - Local Identification&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 0.0.0.0/8 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IANA - Loopback&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 127.0.0.0/8 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IANA - Private Use&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 10.0.0.0/8 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 172.16.0.0/12 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 192.168.0.0/16 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IPv4 Link-Local Addresses&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 169.254.0.0/16 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Multicast&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 224.0.0.0/4 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Future Use&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 240.0.0.0/4 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 其他所有流量转向到 7893 端口，并打上 mark&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -p tcp -j TPROXY --on-port &lt;span class="m">7893&lt;/span> --tproxy-mark &lt;span class="m">666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -p udp -j TPROXY --on-port &lt;span class="m">7893&lt;/span> --tproxy-mark &lt;span class="m">666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将 `clash` 链加在PREROUTING链后面使其生效&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A PREROUTING -j clash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## config for `clash_local` chain ##&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># `clash_local` 链负责处理本机的本地进程发出的流量：给发往公网的流量打上666标记&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (之后会reroute给lo设备，然后会在PREROUTING中的clash链上转发到tproxy 7893端口)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -N clash_local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># nerdctl 容器流量重新路由&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#iptables -t mangle -A clash_local -i nerdctl2 -p udp -j MARK --set-mark 666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#iptables -t mangle -A clash_local -i nerdctl2 -p tcp -j MARK --set-mark 666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 跳过内网流量&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 0.0.0.0/8 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 127.0.0.0/8 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 10.0.0.0/8 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 172.16.0.0/12 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 192.168.0.0/16 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 169.254.0.0/16 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 224.0.0.0/4 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 240.0.0.0/4 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 为本机发出的流量打 mark&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># clash_local 链会为本机流量打 mark, 打过 mark 的流量会重新回到device lo，再从PREROUTING开始走流程.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -p tcp -j MARK --set-mark &lt;span class="m">666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -p udp -j MARK --set-mark &lt;span class="m">666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 跳过来自服务端口的流量&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># https web server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># iptables -t mangle -I OUTPUT -p tcp --sport 443 -j RETURN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># transmission&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># iptables -t mangle -I OUTPUT -p tcp --sport 51413 -j RETURN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 跳过 clash 程序本身发出的流量, 防止死循环(clash 程序需要使用 &amp;#34;clash&amp;#34; 用户启动)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A OUTPUT -p tcp -m owner --uid-owner clash -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A OUTPUT -p udp -m owner --uid-owner clash -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将 `clash_local` 链加在 OUTPUT 链后面使其生效&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A OUTPUT -j clash_local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#######################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## unimportant staff ##&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#######################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修复 ICMP(ping)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 这并不能保证 ping 结果有效(clash 等不支持转发 ICMP), 只是让它有返回结果而已&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># --to-destination 设置为一个可达的地址即可&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#sysctl -w net.ipv4.conf.all.route_localnet=1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#iptables -t nat -A PREROUTING -p icmp -d 198.18.0.0/16 -j DNAT --to-destination 127.0.0.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#iptables -t nat -A OUTPUT -p icmp -d 198.18.0.0/16 -j DNAT --to-destination 127.0.0.1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当执行完上述脚本后，iptables的状态如下图所示：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">┌─────────┐ ┌─────────┐
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ PREROUTING rule1* INPUT │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ┌─────────────────────────────────┼───┐ ┌────────────────────┐ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ │ /───\ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ ┌───┐ ┌─────────┐ ┌──────┐ ┌─┴─┐ │ / \ │ ┌──────┐ ┌──────┐ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├──┤►│raw├─►│conntrack├─►│mangle├─►│nat├─┼──────►&amp;lt;routing&amp;gt;──────┤►│mangle├─►│filter├─┤►│ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ └───┘ └─────────┘ └┬─────┘ └───┘ │ \ / │ └──────┘ └──────┘ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ │ \─┬─/ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └──────────────────────┼──────────────┘ │ └────────────────────┘ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ┌──┴──┐ ┌──────────┐ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │clash│ │ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └─────┘ │ ┌──────┐ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │mangle◄─┼─────────┘ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ Network │ │ └──┬───┘ │ ┌───────────┐ │ Local │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│Interface│ │ │ │ FORWARD │clash_local│ │ Process │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ ┌──▼───┐ │ └─┬─────────┘ /───\ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ┌───────────────┼─┤filter│ │ │ / \ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ └──────┘ │ ├───rule3* &amp;lt;routing&amp;gt;◄─┤ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ │ │ \ / │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ └──────────┘ ├───rule2* \─┬─/ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ┌────────────┼────┐ ┌──────────────────────┼───────────────────┼────┐ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ │ ───── │ │ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ ┌───┐ ┌───▼──┐ │ / \ │ ┌──────┐ ┌───┐ ┌───┴──┐ ┌─────────┐ ┌▼──┐ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │◄─┼─┤nat│◄─┤mangle│◄├───&amp;lt;reroute&amp;gt;───┼─┤filter│◄─┤nat│◄─┤mangle│◄─┤conntrack│◄─┤raw│ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ └───┘ └──────┘ │ \check/ │ └──────┘ └┬──┘ └──────┘ └─────────┘ └───┘ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ │ ───── │ │ │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └─────────────────┘ └────────────┼──────────────────────────────────┘ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ POSTROUTING │ OUTPUT │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ┌──────┴──┐ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─────────┘ │clash_dns│ └─────────┘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └─────────┘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *rule1: iptables -t nat -I PREROUTING -p udp --dport 53 -j REDIRECT --to 1053
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *rule2: iptables -t mangle -A OUTPUT -p tcp -m owner --uid-owner clash -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *rule3: iptables -t mangle -A OUTPUT -p udp -m owner --uid-owner clash -j RETURN
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>研究一下 &lt;code>iptables.sh&lt;/code> 中的路由规则:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">ip rule add fwmark &lt;span class="m">666&lt;/span> table &lt;span class="m">666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route add &lt;span class="nb">local&lt;/span> 0.0.0.0/0 table &lt;span class="m">666&lt;/span> dev lo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>ip rule&lt;/code> 用于控制策略路由数据库，管理策略路由的路由选择算法&lt;/p>
&lt;p>这里 &lt;code>ip rule&lt;/code> 命令让内核对标记有666的数据包查找666号路由表&lt;/p>
&lt;p>&lt;a class="link" href="http://linux-ip.net/html/tools-ip-rule.html" target="_blank" rel="noopener"
>ip rule 参考文档&lt;/a>&lt;/p>
&lt;p>&lt;code>ip route&lt;/code> 命令在666号路由表中添加了一条到lo设备的默认路由&lt;/p>
&lt;p>我们可以通过 &lt;code>ip route show table 666&lt;/code> 来查看 &lt;code>ip route add local 0.0.0.0/0 table 666 dev lo&lt;/code> 添加的路由项&lt;/p>
&lt;p>查看路由表编号和名称的映射：
&lt;code>cat /etc/iproute2/rt_tables&lt;/code>&lt;/p>
&lt;h3 id="创建规则清理脚本">创建规则清理脚本
&lt;/h3>&lt;p>在退出clash后需清除设定的规则&lt;/p>
&lt;p>&lt;code>-D&lt;/code> 或 &lt;code>--delete&lt;/code>:&lt;/p>
&lt;p>从所选链中删掉一条或多条规则。
可以指定要删除的规则号；或指定规则内容（将 &lt;code>-A&lt;/code>、&lt;code>-I&lt;/code> 替换成 &lt;code>-D&lt;/code> 即可）&lt;/p>
&lt;p>&lt;code>-F&lt;/code> or &lt;code>--flush&lt;/code>:&lt;/p>
&lt;p>刷新所选链，相当于逐条清除链上的所有规则&lt;/p>
&lt;p>&lt;code>-X&lt;/code> or &lt;code>--delete-chain&lt;/code>:&lt;/p>
&lt;p>删除用户定义的链&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/usr/bin/env bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> -ex
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip rule del fwmark &lt;span class="m">666&lt;/span> table &lt;span class="m">666&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route del &lt;span class="nb">local&lt;/span> 0.0.0.0/0 table &lt;span class="m">666&lt;/span> dev lo &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -D PREROUTING -p udp --dport &lt;span class="m">53&lt;/span> -j REDIRECT --to &lt;span class="m">1053&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -D PREROUTING -p udp --dport &lt;span class="m">53&lt;/span> -j REDIRECT --to &lt;span class="m">1053&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -D OUTPUT -p udp --dport &lt;span class="m">53&lt;/span> -j clash_dns &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -D OUTPUT -p udp --dport &lt;span class="m">53&lt;/span> -j clash_dns &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -F clash_dns &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -X clash_dns &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -F clash_dns &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -X clash_dns &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#iptables -t nat -D PREROUTING -p icmp -d 198.18.0.0/16 -j DNAT --to-destination 127.0.0.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#iptables -t nat -D OUTPUT -p icmp -d 198.18.0.0/16 -j DNAT --to-destination 127.0.0.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -D PREROUTING -j clash &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -F clash &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -X clash &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -D OUTPUT -p tcp -m owner --uid-owner clash -j RETURN &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -D OUTPUT -p udp -m owner --uid-owner clash -j RETURN &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -D OUTPUT -j clash_local &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -F clash_local &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -X clash_local &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="修正ping">修正ping
&lt;/h3>&lt;p>fake-ip 模式的一个主要缺点是无法ping&lt;/p>
&lt;p>前面 &lt;code>iptables.sh&lt;/code> 中将所有ping请求重定向到127.0.0.1 的操作是掩耳盗铃的，它不提供任何信息。&lt;/p>
&lt;p>但是，可以通过clash用户的身份进行ping&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">alias&lt;/span> &lt;span class="nv">ping&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;sudo -u clash ping&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="提供systemd-unit-file-以一键启动clash及相关iptables等配置">提供systemd unit file 以一键启动clash及相关iptables等配置
&lt;/h3>&lt;p>此步骤是可选的，但我觉得能够一键启动/关闭clash很方便。&lt;/p>
&lt;p>同时也可以设置clash开机启动。&lt;/p>
&lt;p>Systemd 配置文件命名为&lt;code>clash.service&lt;/code> ，放在 &lt;code>/usr/lib/systemd/system&lt;/code> 目录下，执行 &lt;code>sudo systemctl start clash&lt;/code> 来启动运行clash&lt;/p>
&lt;p>开机启动： &lt;code>sudo systemctl enable clash&lt;/code>.&lt;/p>
&lt;h3 id="配置clash">配置clash
&lt;/h3>&lt;p>下面看一看对clash本身的配置&lt;/p>
&lt;p>clash 使用 &lt;code>-d&lt;/code> 选项得到配置文件目录； &lt;code>-f&lt;/code> 选项得到配置文件&lt;/p>
&lt;p>当 &lt;code>-f&lt;/code> 被忽略时，默认的配置文件名是 &lt;code>config.yaml&lt;/code>&lt;/p>
&lt;p>我们想要通过 &lt;code>crontab&lt;/code> 从clash的订阅链接中定时更新clash的配置文件&lt;/p>
&lt;h4 id="构造订阅连接">构造订阅连接
&lt;/h4>&lt;p>TL;DR. 将下面URL中&lt;code>XXXXXXXX&lt;/code> 替换成&lt;a class="link" href="https://www.urlencoder.io/" target="_blank" rel="noopener"
>URL Encode后的&lt;/a>节点订阅URL即可&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">https://sub.xeton.dev/sub?target=clash&amp;amp;new_name=true&amp;amp;filename=config.yaml&amp;amp;url=XXXXXXXX&amp;amp;config=https%3A%2F%2Fgist.githubusercontent.com%2Fcld4h%2F9a03ec2f826a25be5ab974fdbc540de4%2Fraw%2Fconfig.ini
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我们通过&lt;a class="link" href="https://github.com/tindy2013/subconverter" target="_blank" rel="noopener"
>subconverter&lt;/a>来生成clash的配置文件。&lt;/p>
&lt;p>你需要修改订阅链接中的一些参数以使得生成的clash正确配置成 &lt;strong>监听tproxy&lt;/strong> 以及 &lt;strong>fake-ip&lt;/strong> 模式&lt;/p>
&lt;p>具体的：&lt;/p>
&lt;ol>
&lt;li>&lt;code>url&lt;/code> 参数要是正确的节点信息并且经过&lt;a class="link" href="https://www.urlencoder.io/" target="_blank" rel="noopener"
>URL Encode&lt;/a>.&lt;/li>
&lt;li>多个节点订阅URL要用 &lt;code>|&lt;/code> 分割, 此符号&lt;a class="link" href="https://www.urlencoder.io/" target="_blank" rel="noopener"
>URL Encode&lt;/a> 之后是 &lt;code>%7C&lt;/code> .&lt;/li>
&lt;li>&lt;code>config&lt;/code> 参数是用于告诉subconverter如何进行订阅转换的关键，应当&lt;a class="link" href="https://gist.githubusercontent.com/cld4h/9a03ec2f826a25be5ab974fdbc540de4/raw/config.ini" target="_blank" rel="noopener"
>配置正确&lt;/a>. ⚠️&lt;/li>
&lt;/ol>
&lt;p>⚠️ 注意: 这里subconverter 的配置文件非常重要&lt;/p>
&lt;p>&lt;a class="link" href="https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online.ini" target="_blank" rel="noopener"
>ACL4SSR 项目提供了一个默认的subconverter配置文件&lt;/a>，这个文件没问题，但默认的选项不足以让clash开启fake-ip模式并监听tproxy&lt;/p>
&lt;p>要想使其工作，需指定 &lt;code>clash_rule_base&lt;/code>： 在&lt;a class="link" href="https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online.ini" target="_blank" rel="noopener"
>其&lt;/a>中插入下面这一行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">clash_rule_base=https://gist.githubusercontent.com/cld4h/9a03ec2f826a25be5ab974fdbc540de4/raw/clash-base-config.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这一行的作用是告诉subconverter使用&lt;a class="link" href="https://gist.githubusercontent.com/cld4h/9a03ec2f826a25be5ab974fdbc540de4/raw/clash-base-config.yaml" target="_blank" rel="noopener"
>URL中的文件&lt;/a>作为clash的基础配置&lt;/p>
&lt;p>或者你可以直接使用&lt;a class="link" href="https://gist.githubusercontent.com/cld4h/9a03ec2f826a25be5ab974fdbc540de4/raw/config.ini" target="_blank" rel="noopener"
>我的config.ini&lt;/a>&lt;/p>
&lt;p>示例URL:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">https://sub.xeton.dev/sub? --- 后端地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">target=clash --- 客户端类型
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;new_name=true --- 重命名
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;filename=config.yaml --- 文件名
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;url= --- 节点信息
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ss%3A%2F%2FYmYtY2ZiOnRlc3QvIUAjOkAxOTIuMTY4LjEwMC4xOjg4ODg%23example-server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">%7C --- 分隔符 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ss%3A%2F%2FYmYtY2ZiOnRlc3QvIUAjOkAxOTIuMTY4LjEwMC4xOjg4ODg%23example-server-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;config= --- subconverter的配置文件; .ini 格式
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https%3A%2F%2Fgist.githubusercontent.com%2Fcld4h%2F9a03ec2f826a25be5ab974fdbc540de4%2Fraw%2Fconfig.ini
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --- 下面这些配置是多余的，没啥用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;list=false --- 用于输出 Surge Node List 或者 Clash Proxy Provider 或者 Quantumult (X) 的节点订阅 或者 解码后的 SIP002
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;tfo=false --- 用于开启该订阅链接的 TCP Fast Open，默认为 false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;scv=false --- 用于关闭 TLS 节点的证书检查，默认为 false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;fdn=false --- 用于过滤目标类型不支持的节点，默认为 true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;sort=false --- 用于对输出的节点或策略组按节点名进行再次排序，默认为 false
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="设置定时更新订阅任务">设置定时更新订阅任务
&lt;/h4>&lt;p>创建订阅更新脚本 &lt;code>/etc/clash/update-config.sh&lt;/code> ，内容如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/usr/bin/env bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="nb">set&lt;/span> -ex
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/bin/curl &lt;span class="s2">&amp;#34;https://sub.xeton.dev/sub?target=clash&amp;amp;new_name=true&amp;amp;filename=config.yaml&amp;amp;url=XXXXXXXX&amp;amp;config=https%3A%2F%2Fgist.githubusercontent.com%2Fcld4h%2F9a03ec2f826a25be5ab974fdbc540de4%2Fraw%2Fconfig.ini&amp;#34;&lt;/span> -o /etc/clash/config.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>⚠️ 上面的URL要替换一下&lt;/p>
&lt;p>手动执行一下上述脚本确认配置文件能够正常生成。&lt;/p>
&lt;p>确保你的clash&lt;code>config.yaml&lt;/code>配置文件中有如下内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">tproxy-port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">7893&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">dns&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">listen&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0.0.0.0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">1053&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enhanced-mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">fake-ip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fake-ip-range&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">198.18.0.1&lt;/span>&lt;span class="l">/16&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>添加&lt;a class="link" href="https://crontab.guru" target="_blank" rel="noopener"
>定时任务&lt;/a>： 执行 &lt;code>sudo crontab -e&lt;/code> 并加入下面这一行以在每天早上10:00执行订阅更新脚本。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="m">0&lt;/span> &lt;span class="m">10&lt;/span> * * * /usr/bin/bash /etc/clash/update-config.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>中国的“颂圣”情结</title><link>https://cld4h.github.io/blog/zh-cn/p/%E4%B8%AD%E5%9B%BD%E7%9A%84%E9%A2%82%E5%9C%A3%E6%83%85%E7%BB%93/</link><pubDate>Wed, 16 Mar 2022 09:49:07 +0800</pubDate><guid>https://cld4h.github.io/blog/zh-cn/p/%E4%B8%AD%E5%9B%BD%E7%9A%84%E9%A2%82%E5%9C%A3%E6%83%85%E7%BB%93/</guid><description>&lt;img src="https://cld4h.github.io/blog/zzy.jpg" alt="Featured image of post 中国的“颂圣”情结" />&lt;p>建国六十年来，军事成就最大：新政权刚建立十五年，在经济十分困难的情况下就造出了原子弹。在军事领域对国际先进水平跟得最紧；经济建设走了大弯路，以至于到1976年濒于崩溃，改革开放三十年来，赖走向市场经济和向外开放之力，取得举世瞩目的成就，只是现在已经到了拐点，可持续性发生问题；政治改革步履维艰，始终迈不出关键的一步；而文化，包括精神文明，则破坏大于建设。这种破坏是渐进的、逐步加剧、逐步扩大范围，到“文革”达于全面摧毁。&lt;/p>
&lt;p>以中国“士”的传统而言，这六十年是“颂圣文化”一枝独秀，发展到空前规模。为什么这么快就达成舆论一律，多少硕学大儒否定自己积几十年学而思、思而学之所得，放弃“自由之思想，独立之人格”？在什么程度上是被迫，什么程度上是自愿？这种情况是怎样形成的？试从客观、主观两方面因素探讨：&lt;/p>
&lt;p>（一）客观形势&lt;/p>
&lt;p>中国再一次出现大变局，产生了史无前例的“政教合一”的体制。政治领袖与思想“导师”合为一体。中国读书人失去了代表“道统”的身份，成为依附于某张皮的“毛”。这是最根本的变化。如果说新政权废黜百家，独尊“马克思主义”（加引号是因为实际上并不完全是马克思主义），那么对“马克思主义”的解释权不在学院，而在中南海。不但“朕即国家”而且“朕即真理”。过去天下士子考科举，需要熟读经书，而不是当朝皇帝的御笔批示。今之“政治学习”需要熟读的不是马恩经典著作，而是领袖言论。“导师”也说要建立“新文化”。若全盘“马克思主义化”果真能做到，那就是全盘西化。这当然不可能，要“与中国的实际相结合”。&lt;/p>
&lt;p>如何结合？一种外来思想需要嫁接到本土的思想资源上，结果不是嫁接到经过百年启蒙的已经初步建立以民主和科学为目标的新文化上，而是越过两千年嫁接到了秦始皇那里，自称是“马克思加秦始皇”，其实与马克思的学说关联甚少，而是“斯大林加秦始皇”。这里面多的是历代帝王的统治术加现代集权，少的是以民主宪政为核心的现代政治学。这是在执政之后，在取得政权之前是嫁接到陈胜吴广—李自成，“文革”期间则是二者的奇异结合。&lt;/p>
&lt;p>以此为标准，进行全体知识分子的思想改造，把对是非的判断权全部收缴上去，以一人之是非为是非。愚民政策臻于极致，读书人失去独立思考的权利，逐渐成为习惯，也就失去了思考能力和自信。“虽千万人吾往矣”是建立在“自反而缩”的基础上的，就是坚信自己是正确、有理的，如果这点自信没有了，无所坚守，自然再难谈什么骨气和“浩然之气”。于是“士林共识”没有了，一人一旦获罪，在亲友、同事中得不到同情和支持，在精神上也彻底孤立，这是最可怕的境地，犹如天主教的革出教门。过去中国的皇权体系，“政、教”相对说来是分离的，现在反而把对信仰的操控与政权合一起来，从世界思想史的角度论是大倒退。&lt;/p>
&lt;p>做到这一点，端赖持续不断的对全体知识界贯穿始终的“思想改造运动”。最初首当其冲的是最高级的知识精英，即大学教授和科学院的高级研究人员。他们之中被认为有“历史问题”的，在之前的“镇反”运动中已经遭难，知名的如雷海宗、叶企荪等。1950年，燕京 大学一位美籍教授回国，学生为之送行，送了一块“春风化雨”的匾，受到上面严厉批评，燕大的党支部做深刻检讨。借此，清华、燕京等与外国关系较多的大学展开了“肃清帝国主义思想影响”的运动。抗美援朝开始后，发展为反对“亲美、崇美、恐美”的运动。大规模的教师思想改造运动从1952年开始。各大学学识渊博、平时备受尊崇的教授们在大会小会交代历史、检查思想，批判和否定自己半生的著述。越是学术成就大、地位高的，越难“过关”。下面坐的多为自己的学生，他们的任务是“帮助”老师更加深刻地认识自己的“反动性”。&lt;/p>
&lt;p>紧接着“三反”、“五反”、文艺界批判电影《武训传》、“反胡风”、批判“红楼梦研究”，等等，再后来就是众所周知的“阳谋”，精神领域无一幸免。许多教授的自我批判被选登在《人民日报》、《光明日报》等报刊，今天看来，其自贬、自虐的程度惨不忍睹。刊登出来的是知 名人士，实际上大小知识分子几乎人人都写过无数此类今天令自己汗颜的“思想检查”（笔者当然不例外）。从此独立人格荡然无存，不但是非标准，连审美标准也不再有自主权。&lt;/p>
&lt;p>主要批判的内容，恰好就是支撑读书人精神的上述第二点传统— —重气节。具体批判的重点为：“清高”（自以为不问政治，政治要来问你）、“骨气”（有阶级性，反对剥削阶级宣扬的反动“骨气”，对“人民”必须“折腰”）以及“旧道德”（家庭伦理、朋友信义等都以阶级 划线，反对小资产阶级温情主义），乃至鼓励投（革命之）机（转变越 越好，不必怕落“投机”之嫌）。&lt;/p>
&lt;p>另一条主线是追随苏联。第一次令高等院校元气大伤的改组，就是依照苏联模式，那一次的“调整”特点是高度实用主义，重工科、抑文科，甚至理科（纯自然科学）也服从于工科需要，许多社会科学的学科干脆取消。从此大学失去自主权，中西的通识教育传统都被扬弃，只生产“听话、出活”的工匠，再无独立思想可言。在自然科学界一个典型的例子，是苏联大肆宣扬李森科、米丘林时，中国生物学界亦步亦趋批判孟德尔—摩尔根遗传学，压制一切不同意见，不少知名科学家放弃科学真理加入批判队伍，而以谈家桢、胡先骕为代表的坚持科学良心的科学家遭同行的公开批判。但是苏共二十大前后，李森科在苏联失宠，于是中国科学界也奉命开始转向。当时的科学院院长竺可桢“代表有关方面”向他们道歉 。仅此一例，已可见即使在重实证的自然科学界，政治已经压倒科学真理，多数知名科学家也屈服于高压之下了。以后顺应政治斗争需要，科学泰斗公开发表文章肯定“亩产万斤”，原子物理学家发表文章论证大气中核试验的放射微尘于生物无害，也就不足为奇了。&lt;/p>
&lt;p>有时恩威并施，或者领导层间或有较为开明的，最后都被压倒。1956年周总理作“关于知识分子报告”，在知识分子接受改造的前提下，表示尊重和团结知识分子，随后一批高知被发展入党。紧接着一场“阳谋”，知识分子又遭大规模洗劫。不少刚入党的又变成右派， 开除出党，有的还来不及转正，就划归“敌人”了。在大饥荒尾声的1962年，陈毅副总理作著名的为知识分子“脱（资产阶级）帽”讲话，使知识界又升起沐浴皇恩的希望，奔走相告，额手称庆。但是紧接着就是“天天讲、月月讲、年年讲”，等于否定了这次讲话，此后“阶级斗争”一浪高过一浪，卒至打入“臭老九”，相当于元朝的“九儒、 十丐”。&lt;/p>
&lt;p>早在1958年，领袖已经为“一穷二白”踌躇满志。“穷”者，全民皆被剥夺，私营工商企业完全消灭，农民失去土地，再无人有恒产；“白”者，中华民族几千年深厚的文化底蕴和近百年的文化革新都被洗刷一空，五色斑斓的瑰丽画面变成一张白纸，供一人在上面狂书乱画。到“文革”开始，连十七年的教育都被否定，中小学教员都被认为是“国民党培养出来的资产阶级分子”，以至于掀起学生羞辱、殴打、肉体摧残直至杀害老师的史无前例、惨绝人寰的高潮。在“与一切传统决裂”的口号下，一切基于人性的道德伦理荡然无存，善恶是非以“政治路线站队”划线。古今中外的文化都“扫入历史的垃圾堆”。最后，文化教育领域只剩下八个样板戏、一个作家、一个白卷英雄。斯文扫地、文明退向野蛮，除少数清醒者惨遭杀戮外，全民进入蒙昧时期，中华民族文化浩劫于斯为最。&lt;/p>
&lt;p>哈耶克对计划经济导致“思想国有化”有透彻的论述，他指出：极权主义宣传摧毁一切道德的一个重要基础，就是对真理的尊重。在这种社会中，道德中的大部分因素——尊重人的生命，尊重弱者和普遍尊重个人等，都将消失。这一论断已经为事实所证明。这是新的道德沦丧的起源。&lt;/p>
&lt;p>（二）知识分子接受改造的主观因素&lt;/p>
&lt;p>当然达到文化专制的前提是“武化”统治。胜利者挟雷霆万钧、横扫玉宇之势，君临天下，手无寸铁的“秀才”们不由得不为之慑服。但是简单地把一切归之于高压下的恐惧，完全是人趋利避害的本性导向人格卑下，既不全面，也不公平。深层次的还有以下一些因素：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>“家国情怀”的延续。中国人，特别是其精英，百年来最深切的感受是民族屈辱，最大的诉求是国家统一、民族兴旺。这一诉求高于个人荣辱。所以，一句“中国人从此站起来了”的话，足以使无数男儿热泪盈眶，下决心委身于新政权、追随新领袖，其他的都可以放 弃和牺牲。这是真诚的、发自内心的。1949年，化学家傅鹰在美国正在犹豫是否回国，读到解放军炮击英国“紫石英号”军舰的消息，他根据以往经验，以为仍将以中国政府道歉了结，没想到新政府对英国态度如此强硬，大受感动，于是决心回国。这种心情是有代表性的。所以，多数知识分子拥护新政权，首先是满足了外抗强权的要求。即使接受了西方教育的知识分子，仍未摆脱寄希望于“明君”的传统。革命领导的个人魅力、传说中的长征英雄事迹，都产生巨大的吸引力，也足以使没有参加革命的人自卑。另外，新政权开始正处于“其兴也勃”的时期，与溃败前的旧政权成鲜明对比，令人对它能扫荡旧社会 的污泥浊水升起无限希望。在这种形势下，个人显得十分渺小，不知不觉间接受政教合一的道统并不感到太勉强。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>二战后的世界形势和潮流。当时两大阵营的对立，非此即彼。 选择留在大陆等于选择留在一个“阵营”。二战之后，国际知识界左倾也是一种潮流，因此不少知识分子相信“这边”代表未来，急于跟上世界潮流，怕为时代所抛弃，作“向隅而泣的可怜虫”。特别是朝 鲜战争之后，中国与西方多数国家是敌对的关系。政治上的选择与意识形态的“站队”无法分开。思想上有任何个人主义或自由主义倾向，就有“里通外国”之嫌。国家的敌人与思想的敌人相重合。尽管公开宣布的“政策”有“将思想问题与政治问题区别开来”的说法，在实践中却难得分开，稍一不慎就落入政治罪人，人人自危，只能兢兢业业接受“改造”。外部“敌人”的存在被统治者充分利用。所以 1962 年七千人大会之后，眼看自己在中上层干部中一贯正确的威信有所动摇，领袖曾布置高级干部学习柳宗元的《敌诫》。用外敌的威胁转移对内政缺失的注意力，用以巩固其权威，是统治者常用的手法，在特定的环境下，对中国知识分子特别有效。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>知识成为原罪。1949年以前受过高等教育者，多半非工农子弟，伴随着对阶级斗争理论的认同而来的是无法摆脱的“原罪”感，“阶级烙印”有如罪犯的金印。“书香门第”不是荣耀而是耻辱，这是对几千年传统的逆反。即使贫寒出身的子弟一旦受了高等教育，也被认为“变质”。除了少数已是“左派”的知识分子外，多数对“马列”理论不熟悉，所以许多饱学之士都有一种自卑感，真心诚意愿意重新学习，用新的理论来审视自己过去的学问。有意思的是，很多人都开始学俄文，却很少人学德文，可见实际目标还是学苏联而不是马恩经典。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>“颂圣文化”的延续和大发扬。如前所述，“颂圣”本来就是传统文化的一大特点，无论大儒或白丁概莫能外。所以偶像崇拜、领袖神化、歌颂太平盛世，都有深厚的土壤，在新的气候条件下推向极致而很少遇到质疑和抵制。在历次政治运动中不论受到怎样的不公平待遇，乃至家破人亡，都被要求“正确对待”，还是“臣罪当诛兮，天王圣明”的延续。后来冤假错案得以“平反”，则感激涕零，“天王”更加圣明。“文革”之后，还有人发明了“娘打孩子”之说，一切罪责一笔勾销，就此对绝非外患造成的民族灾难心安理得地拒绝反思。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>以上几点是最初阶段接受“改造”的“自愿”因素。以后，一轮紧似一轮的“阶级斗争”使强制的成分日益增加，但已无退路，衣食住行的厚薄有无，以至婚姻、亲情、友谊的自由一切操之于“组织”，想要“归隐”也无可能。同时又被示以“出路”，只要努力改造，达到“脱胎换骨”，就有希望被接纳。这是一种漫长的修炼过程，或可比作经过炼狱达到天堂之路。有人将之比为“温水煮青蛙”，每次政治运动是一次加温，但又对不同人群有所选择，所谓打击5%，团结大多数，于是人人争相加入那95%，直到“文革”95% 都被“横扫”。&lt;/p>
&lt;p>当然每个人的阅历与处境不同，思想轨迹各有差异。每一轮的整人运动裹挟一大批人进一步丧失自我，同时另一些开始怀疑、有所觉醒的人数也在增加。“文革”的狂飙使全民陷入疯狂与愚昧，而混乱失控的局面又无意中提供了某种自由思考的空间，那种达于极致的荒 谬反过来唤醒了许多人的理性和良知，心中的“神”一经动摇，人性就从混沌中开始寻找回归之路。这种情况在部分知青中尤为突出，在无人指导的情况下，“乱读”了许多“禁书”，无意中大开眼界，吸取了迥异于官方教条的知识营养，成就了新时期脱颖而出的一代文化骨干，有的后来进入高等院校，有的散落民间，成为今之颇有成就的“自由撰稿人”。&lt;/p>
&lt;p>以1979年真理标准的辩论为标志，打破“两个凡是”，可以说是一次再启蒙，对三十年蒙昧的祛魅作用有划时代的意义。长期被压抑的理性爆发出来，借此冲破牢笼，封闭的国门再一次打开，中国人与百年前的先辈一样，又一次“睁眼看世界”，又一次受到震撼。长期 视为不可动摇的教条和权威在理性面前失去力量；原来不能想象的都可以成为现实。是非观念又回归常识。幸而长寿的老一代学人，劫后余生，又焕发新的活力，恢复自信，在学术上仍能有所贡献。恢复高考初期入学的青年学子有幸得到这一代老先生的亲炙，在某种程度上， 薪火得以传续。新时期的第一个十年虽然没有出现百家争鸣的局面， 但是思想空前活跃，在精神上充满活力，为1949年以来所仅有，涌现出一批好学深思、勇于探索的中青年学子，如果有机会发展下去， 有望继承“五四”的传统，对在新时期重建新文化有所作为。&lt;/p>
&lt;p>但是，这场思想解放与“五四”前后的新文化运动不可相提并论。 其致命的弱点在于收放仍在“如来佛手心”。掌权者为特定的政治需要服务，给予一定的鼓励，但不打算作彻底的反思和清算，基本体系不容突破，旧势力的阻力十分顽强，所以在前进中道路迂回曲折——镇压“民主墙”、反精神污染、反资产阶级自由化、反人道主义„„ 知识分子仍然动辄得咎，心有余悸，没有安全感。这一轮新的启蒙仍以“武化”手段结束。以此为分界线，文化思想再一次逆转。在“思 想上保持一致”的口号下，实际上恢复了“两个凡是”，以在位领导的是非为是非。1992年的“南巡讲话”，挽回了经济倒退，而对政治 思想却反其道而行。一方面是毫不放松的思想钳制，另一方面是拜金主义、商业大潮和恶性市场竞争，这两面夹击对思想文化起到“逼良为娼”的作用，知识分子进一步犬儒化，文化进一步低俗化。当前， 尽管以言获罪之事仍不断发生，但比前三十年环境已相对宽松，也存在体制外的其他出路，但是自觉地揣摩上意的风气却更盛，说一些常识性的真话者竟成异类，或者被誉为特别“勇敢”。颂圣文化又一次抬头，而且随着国力的加强愈演愈烈。&lt;/p>
&lt;p>再以前面所列“士”的三点传统来看今之知识分子的主观世界：&lt;/p>
&lt;p>家国情怀、忧国忧民，和对“道”的承载，依然存在于一部分人中间，现在转化为对严重的时弊和改革倒退的忧虑、对普世价值的追求，还有拒绝遗忘，追寻和揭示历史真相的努力。这些在进入耄耋之年的老人中特别强烈，同时在中青年中仍不乏有志者。主流媒体以外 的报纸、杂志以及论坛，如雨后春笋，此起彼落，前仆后继，承载了 当代优秀思想和探索，加之网络对冲破禁锢、活跃思想的作用，构成一道闪闪发光的文化风景线。&lt;/p>
&lt;p>但是毋庸讳言，多数青年学子的家国情怀日趋淡薄。其原因是现在个人命运不一定与民族国家紧密联系，可以“用脚投票”，而且出路与才能成正比。合则留，不合则去。人才国际流动是大势所趋，无可非议。同时，正义感与理想也为现实的功利所淹没。如果说，前三 十年的思想改造主要是为威武所屈，那么现在有话语权的上层精英多为富贵（名利）所淫，而多数尚未站稳脚跟，忙于为稻粱谋者，则可以说是为贫贱所移。多数人并非良知全泯，但感到无力和无奈，而抗拒则立即失去很多，于是选择与种种明知非正义的“潜规则”或“明规则”妥协。自19世纪中叶至20世纪中叶的留学生主要是“偷天火”， 企图回国进行启蒙，改变黑暗、落后的现状；今之留学生则是主要为自己找更好的出路，如果选择回国来发展，大多不是改造社会而是被改造，一部分甚至成为维护现状的吹鼓手。士林已无共识，即使有， 也各人自扫门前雪，形不成道义的压力。少数有所坚守，进行了抗争的，受到迫害时往往孤立无援。有识者所忧虑的社会危机都是长远之事，至少目前还能在歌舞升平中苟安于一时，何苦自寻烦恼？&lt;/p>
&lt;p>至于主流文化，一切新老传统的特点中唯有颂圣文化如鱼得水。当下的“颂圣”不一定表现在直接颂个人，而是颂“盛世”。在全球化背景下中国因经济增长迅速而国际地位空前提高，相当多的知识分子在收入和社会地位上是得利者。在此情况下，直接或间接“颂圣” 表现为新特点是：以各种“理论”维护现有体制，否定必要的改革， 为显而易见的弊病——特别是当前严重的社会不公和弥漫性的腐败——辩护。一部分所谓“文人”在因颂圣而名利双收中不但堕落到无耻的地步，而且已经超越了起码的人道底线。以至于汶川地震中出现 “纵做鬼，也幸福”和“含泪劝家长”那样的“作品”丑闻，此举招 来网上一片骂声，但是并未引起“舆论哗然”，他们感受不到任何压力。那位文化明星依然为主流媒体所追捧，频频以“大师”面貌亮相。实际上这种“颂圣”充斥于媒体乃至日常生活，人们对此习以为常，已经麻木，只不过那两位的言论发生于国殇之际，特别引人注目而已。&lt;/p>
&lt;p>古之颂圣还有真诚的一面，出于对某种纲常的认同。今之“颂圣” 多数言不由衷，明知其非。在大会、小会上一本正经地说，大小笔杆子成本大套地写的内容，在茶余饭后私人之间却是讽刺讥笑的话题。人人都做两面派，丝毫没有歉疚感。古之欺君是大罪，今之“君”似乎有意需要被欺。古来帝王还相信以史为鉴，可知兴替，所以史官还有一定的写真事的空间。今之官史不但不发扬“以史为鉴”的优良传统，却着力于屏蔽真相，伪造历史，拒绝反思。这一点对青年一代毒害尤甚，使他们对当代事、近代史完全无知，对古代史严重误读，重新陷入蒙昧。&lt;/p>
&lt;p>特别值得注意的是，进入21世纪以来，或者更早，各种版本的极端国家主义思潮大行其道。有的表现为“国学热”，有的表现为直接排外、仇外，有的借近几年经济增长之力自大狂，真以为中国可以拯救世界；有的重新肯定古今一切“传统”（例如所谓三个传统——儒家、（1949年以后）前三十年、后三十年——一并继承，就是不提1840年以后那一百年），有的公然倡导“政教合一”，还有赤裸裸地恢复已经被拉下神坛的领袖的神话和崇拜，大造神像，等等。极端国家主义否定了百年来洒满无数先烈鲜血的谋求民族振兴的道路，甚至否定近三十年的改革。所有这些论调，殊途同归，落脚在质疑或反对普世价值，把“社会主义”嫁接到专制皇朝，通过美化古之帝王（包括暴君），颂今之“盛世”。&lt;/p>
&lt;p>百年近代史上，每逢改革到一定程度，需要向民主、宪政的道路转型的关键时刻，总有以“国粹”抵制“西化”的思潮出现，以“爱国”为名，反对社会进步，行祸国之实。而这种言论总是有一定的迷惑力，因为它能打动国人一种敏感的情结——即“五千年辉煌”与“百年屈辱”，把一切不满转向洋人。所以，以“反洋”为旗号的，无论理论上如何不合逻辑、如何歪曲历史，无视客观现实，在表面上却常占领道义制高点，同时为当局所鼓励，至少默许。在位者以“××亡 我之心不死”（过去是“帝国主义”、“帝修反”，现在是“境外敌对势力”）来掩盖施政的缺失，压制国内的不平之鸣；摇旗呐喊者以虚骄的对外的“骨气”，掩盖实质上与权势的默契和“颂圣”。上述“含泪劝家长”一文，用的借口也是家长维权讨个说法，就要为“境外敌对势力”所利用，罪名吓人。这种论调动不了国际霸权主义一根毫毛，只能掩护国内的贪腐权势集团，误导善良的爱国者，抵制改革，阻挠中华民族走人类共同的进步道路。此种思潮再次进入主流文化，则改革头十年思想解放的成果又将遭毁灭性打击，社会不进反退，中华民族可能付出沉重的代价。&lt;/p>
&lt;p>有鉴于此，当前我国急需开启民智，掀起一次再启蒙，打破新老专制制度造成的精神枷锁，否则民族精神有日益萎缩之虞。在这方面，号称“知识分子”者责无旁贷。有人认为“启蒙”是某些人自以为高明，高高在上教育别人。其实如康德所言“启蒙就是有勇气运用自己的理智”，就是用理性之光照亮蒙昧的心智。在长期思想禁锢的制度下，每个人都需要而且可以自我启蒙，也可以相互启蒙。当然不能讳言“闻道有先后”，先觉者有义务与他人分享自己之所悟。首先，知识分子需要自己解放自己，争取人格独立，减少依附性，坚决抵制颂圣文化，摆脱祈盼或仰望“明君”的情结，努力面向公众，理直气壮地弘扬普世价值：人权、法治、自由、平等、宪政、民主，这可以说是今天的“道统”，是自救与救国的需要，无关“西化”或外部压力。不断撑开文化专制的缝隙，见缝插针地做一些扎实的启蒙工作，继承百年来先贤未竟之业，建设以民主和科学为取向的“新文化”，假以时日，经过几代人的努力，民族精神振兴或许有望。&lt;/p>
&lt;p>（作者：资中筠, 摘自《士人风骨》）&lt;/p></description></item><item><title>福利的「高低」「正负」与中国的转型</title><link>https://cld4h.github.io/blog/zh-cn/p/%E7%A6%8F%E5%88%A9%E7%9A%84%E9%AB%98%E4%BD%8E%E6%AD%A3%E8%B4%9F%E4%B8%8E%E4%B8%AD%E5%9B%BD%E7%9A%84%E8%BD%AC%E5%9E%8B/</link><pubDate>Fri, 04 Mar 2022 08:26:31 +0800</pubDate><guid>https://cld4h.github.io/blog/zh-cn/p/%E7%A6%8F%E5%88%A9%E7%9A%84%E9%AB%98%E4%BD%8E%E6%AD%A3%E8%B4%9F%E4%B8%8E%E4%B8%AD%E5%9B%BD%E7%9A%84%E8%BD%AC%E5%9E%8B/</guid><description>&lt;img src="https://cld4h.github.io/blog/qinhui.jpg" alt="Featured image of post 福利的「高低」「正负」与中国的转型" />&lt;p>【按：本文刊载于《二十一世纪》第139期，&lt;a class="link" href="https://cld4h.github.io/blog/post/thoughts/repost/welfare.pdf" >原始pdf&lt;/a>】&lt;/p>
&lt;h2 id="西方的社会主义要颠覆中国的资本主义">西方的「社会主义」要颠覆中国的「资本主义」？
&lt;/h2>&lt;p>记得2010年「诺贝尔和平奖事件」引起一些国人的强烈反弹。官方的《环球时报》招集了「七位中国知名学者谈2010年诺贝尔和平奖」。这七位大腕当然不可能是「右派」；在中国的语境中一般被视为「左派」。但有趣的是，这七个「左派」以诺奖话题开场，讲着讲着有人就跑了题，骂起「福利国家」来了。例如，中国社会科学院政治学研究所所长房宁如是说&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>：&lt;/p>
&lt;blockquote>
&lt;p>前段时间去欧洲考察，到了英国、希腊、匈牙利。这才意识到，金融危机其实是一次福利主义的危机，背后是西方的政治体制。西方自罗斯福「新政」以后，改变了传统的政治合法性。此前政治合法性本质是压制与管束，「新政」把「压制合法性」变成「福利合法性」，对老百姓实行甜头主义。但福利主义政治积累了大量的问题，惰风四起。政党政治、议会民主更使社会失去了纠偏能力，以至积重难返，终于酿成了这次危机。这不是小问题，它也许意味一种文明的衰落。现在西方对待新兴国家也没什么好办法，弄个什么「和平奖」恶心人，其实也没什么大不了。&lt;/p>&lt;/blockquote>
&lt;p>著名的民族主义倡导者王小东附和说&lt;sup id="fnref:2">&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref">2&lt;/a>&lt;/sup>：&lt;/p>
&lt;blockquote>
&lt;p>西方现在的问题说白了就是人变懒了。美国议员纷纷做广告骂中国，但说来说去无非也就是中国人抢了美国人的工作。但有点知识水平的美国老百姓也觉得理亏：你实在不好意思说中国人比你勤劳肯干，且肯忍受较低生活水平就是不对的。&lt;/p>&lt;/blockquote>
&lt;p>这些话真叫人拍案惊奇！在《环球时报》上，这些议论出现在「和平奖折射了西方危机」的小标题之下，仿佛要告诉读者，西方福利国家的危机是促成刘晓波获得诺贝尔和平奖的一个贡献因子。&lt;/p>
&lt;p>福利国家养了懒汉；福利主义的政治经济制度积累了大量社会问题；&lt;mark>西方今天的危机不是资本主义危机，而是福利国家危机。这类看法本不是什么新观点，甚至在某种意义上也不能说全无道理。只是，这种话在世界上的其他地方通常都出自「右派」之口，在学界则属于典型的「新自由主义经济学」之说。然而在中国，咱们都听到了：这些话不是什么「右派」说的，也不是什么「新自由主义经济学家」说的，而是中国「官方左派」学者说的！&lt;/mark>&lt;/p>
&lt;p>当然，说了这些话，并不表明他们因此成了「右派」。因为在西方，&lt;mark>乃至在其他非西方国家，「右派」和「新自由主义者」反对高福利通常是要追求高自由，倾向于用「自由放任」取代「福利国家」。可是我们的「左派」对老百姓的自由和福利同样排斥，他们既反对「自由主义」，也反对「福利主义」。&lt;/mark>我们现在看到的这篇宏文一方面挖苦西方的「福利主义」，另一方面也怒斥西方国家重视中国百姓的自由和人权。中国社会科学院美国研究所副所长倪峰忧心忡忡地说：「美国的人权政策重心主要往草根上靠，以此针对中国现在存在的社会矛盾。刘晓波只是这种人权政策的符号而已，这种意识形态层次的东西对普通中国人的生活影响不大。不过，他们要是把那些意识形态的东西与中国现在的社会矛盾搅合在一起，那就非常可怕了。」&lt;sup id="fnref:3">&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref">3&lt;/a>&lt;/sup>房宁感到无比的委屈和愤怒：「我们愿意付出更大的代价，为西方人打工，靠挣一点辛苦钱来实现民族的复兴！但这样他们还是不接受！」&lt;sup id="fnref:4">&lt;a href="#fn:4" class="footnote-ref" role="doc-noteref">4&lt;/a>&lt;/sup>&lt;/p>
&lt;p>福利国家是西方的万恶之源，血汗工厂是中国的制胜之宝，但西方人却不让我们「为西方人打工」！他们「人权政策重心主要往草根上靠」，这不是存心想搞垮咱们的血汗工厂吗！资本主义那「意识形态层次的东西」对我们「影响不大」 （咱们早就比他们更资本主义了），不过他们要是把那些民主思想「与中国现在的社会矛盾搅合在一起，那就非常可怕了」。整个故事听起来就像是西方的「社会主义」处心积虑要颠覆咱们中国的「资本主义」！&lt;/p>
&lt;p>过去中国的「左派」在某些时候还是称赞福利国家的，说福利国家是资本主义向共产主义学的。现在他们却大骂人家要向我们输入福利国家！当然，过去我们的「左派」也骂过福利国家，理由是福利国家只均富不共产，太保守，不过瘾。但现在我们的「左派」不搞共产了，却咒骂西方「对老百姓实行甜头主义」！过去我们的「左派」对自由、民主、人权这类说法最拿手的挡箭牌就是「阶级论」，动辄就反问「谁的自由？」「谁的民主？」「谁的人权？」，说西方的人权是只给富人、资本家的，而穷人没份。可是现在我们的「左派」明确说了：富人、权贵玩玩人权没关系，对咱们「影响不大」，但如果「人权政策重心主要往草根上靠」，「那就非常可怕了」！听见了吗？怕的就是工人、农民有人权！过去中国的「左派」也搞「专政」，说这专政是对付资本家的，是保证百姓福利的。但现在这专政恰恰是要防御「福利主义」的影响，它要对付的是一心想对付资本家的人。&lt;/p>
&lt;p>英国《金融时报》（Financial Times）特约撰稿人吴迪去黑龙江亚布力滑雪，「车子一进入尚志县地界，路边就不断出现一个个醒目的标语牌——『谁刁难投资者，谁就是人民的罪人』，『谁损害投资者的利益，谁就是与人民为敌』，『老板不分大小，能来投资就好』⋯⋯我赶紧用手机拍下了这些惊悚的语句。」&lt;sup id="fnref:5">&lt;a href="#fn:5" class="footnote-ref" role="doc-noteref">5&lt;/a>&lt;/sup>这样的标语笔者也见过一两次，例如，吉林蛟河市有标语：「谁与招商引资企业过不去，就是与蛟河人民过不去」！河北宣化县有标语：「谁刁难投资者，谁就是宣化的罪人」！当然，公开张扬这种「惊悚」标语的地方不会多，但这样的想法可谓普遍流行。就这样「西方」还是不满，甚至把「人权政策重心主要往草根上靠」，你说我们的「左派」怎能不气大？&lt;/p>
&lt;h2 id="什么是福利国家福利国家概念的发生学考察">什么是福利国家？——「福利国家」概念的发生学考察
&lt;/h2>&lt;p>这就引出了一个问题：这西方左派喜欢、而他们的右派和我们的「左派」都讨厌的「福利国家」，到底是个什么东西？&lt;/p>
&lt;p>今天西方人通常把「福利国家」看成与「自由放任」相对的一种「大政府」主张，即以高税收、高福利的二次分配手段增加「平等」。从计量的角度看，如今西方学界一般认为福利国家有四个指标：一、福利支出占政府公共开支的很大比重：如果政府开支大量用于军队、警察，用于政府的自我服务（行政经费、官办文宣与公关经费等），或者用于建设投资，那就不是福利国家；二、反过来看，公共支出也占福利支出总额中的绝大部分：如果福利主要是靠民间慈善而非公共财政，那就不是福利国家；三、福利支出占国内生产总值（GDP）的比重达到一定的水平；四、福利制度中存在力度较大的再分配。我们可以福利支出多少和再分配力度高低两个维度来对国家进行分类：美国福利支出与再分配力度都「双低」，而瑞典则「双高」，德国福利支出高而再分配力度低，英国福利支出低而再分配力度高。根据这种标准，可以说&lt;mark>最严格意义上的福利国家就是福利开支比重与再分配力度「双高」的瑞典式国家；而两者有一高的英国式与德国式也可以算是较为广义的福利国家；两者「双低」的美国则可视为「自由放任」的代表，不算福利国家（或者说是典型的低福利国家）了。&lt;/mark>&lt;/p>
&lt;p>但是这种比较只能在宪政民主国家范围内进行。如果历史尺度扩展到宪政以前、空间尺度扩展到民主国家以外，「福利国家」又该如何定义呢？值得指出的是：这正是历史上「福利国家」这一概念出现时人们主要考虑的问题。通常完整的定义必须有排除性的标准，而这种标准往往是有针对性的。无论你喜欢还是讨厌「福利国家」，当你提到它时总有个相反的参照物浮现在脑海中：对于喜欢福利国家的人来说，他们讨厌的「非福利国家」是什么？而讨厌福利国家的人，他们所喜欢的「非福利国家」又是什么？或者说，如果我们说不清楚什么是福利国家，也应该容易说清楚什么不是福利国家？&lt;/p>
&lt;p>那么，什么不是「福利国家」呢？有人说，福利国家这种「民主社会主义」是只搞分配的，那么，如果搞生产性的公有经济，就不是福利国家而是斯大林式的「社会主义」了。这种说法不完全对，因为尽管今天人们主要从分配方面讨论福利国家，但像法国、奥地利、以色列、印度这类民主的「社会主义国家」都有或曾经有大量的国有企业。当然，国有企业有没有效率、要不要改制，那是另外的问题。然而，是不是福利国家，是不能以有无国企或国企占多大比例来判断的。&lt;/p>
&lt;mark>
通常人们更强调的是「福利国家」与「自由放任」之别。但如前所述，这是在今天宪政社会上下文中的区别。而历史的事实是：最早提倡「福利国家」和指责「福利国家」的人，主要都是强调它与另一些「大政府」的区别，而不是与「自由放任」的区别。
&lt;/mark>
&lt;p>先说讨厌福利国家的人。有人考证说历史上「福利国家」一词最早见于德语，即“Wohlfahrstaat”。在1920年代的魏玛共和国，这个词是右派用以攻击社会民主党政府（据说它「过度关注对人民的给予，而不是要求人民为德国的荣誉与强权而奉献」）的贬义词&lt;sup id="fnref:6">&lt;a href="#fn:6" class="footnote-ref" role="doc-noteref">6&lt;/a>&lt;/sup>。然而，这些反对魏玛民主的极右翼人士本身也是大国家主义者，他们鄙视「福利国家」的「小恩小惠」而向往穷兵黩武的大帝国。显然，他们绝不主张所谓的「自由放任」。&lt;/p>
&lt;p>再说一下喜欢福利国家的人。英语「福利国家」（welfare state）一词据说是牛津大学国际政治学者齐默恩（Alfred Zimmern）在1930年代第一次使用，他把英美等民主国家称为「福利国家」，以区别于「强权国家」（power state），后者指纳粹德国和法西斯意大利等，其特点是「把国家或政府当成目标，而人民大众成了从属的工具」。稍后不久，英国经济学家舒斯特（George Schuster）也在1937年提到：「削弱独裁者在强权国家中影响的最好办法，是我们的福利国家表明它更能为人民提供幸福。」&lt;sup id="fnref:7">&lt;a href="#fn:7" class="footnote-ref" role="doc-noteref">7&lt;/a>&lt;/sup>&lt;/p>
&lt;p>但是，「福利国家」这个词组之广为人知，则始于坎特伯雷大主教坦普尔（William Temple）的宣示。坦普尔年轻时是英国工党成员、民主社会主义者，1908年他成为教会神职人员后著文主张「进化式的社会主义」，并认为教会主张的选择是「介于社会主义与异教徒〔指再浸礼派等主张平等主义社会改革的激进教派〕之间」。1927年他在神学著作中主张「渐进的保守主义改革」，英国的一些马克思主义者批评这一主张的实质是「有人道面貌的资本主义」。1942年，他当选英国基督教最高教职——坎特伯雷大主教，直至1944年在任上逝世。当时正值二战艰苦岁月，英国不分朝野左右，团结一致进行反法西斯战争。而超越世俗左右之上的基督教信仰和世俗政治中左右共同遵守的宪政民主规则成为团结全国、振奋民族精神的两大基础，代表前者的教会与体现后者的政府也精诚合作。坦普尔就任最高教职前夕于1941年发表的《公民与教徒》（Citizen and Churchman）一书也因此名重一时，传播极广。坦普尔在书中除了与齐默恩一样用「福利国家」概念来区别「福利导向的民主国家」和纳粹式的「强权国家」以外，还借助「福利」（welfare）和「战争」（warfare）两词的音近大做文章，把英美这类由公民授权为公众提供福利保障的民主国家称为「福利国家」（welfare state），而把德意等极权国家称为「战争国家」（warfare state，也可译为「军国主义」）&lt;sup id="fnref:8">&lt;a href="#fn:8" class="footnote-ref" role="doc-noteref">8&lt;/a>&lt;/sup>。&lt;/p>
&lt;p>总之，我们看到&lt;mark>在「福利国家」一词的发生学背景中，无论在德语还是英语，作为贬义词还是作为褒义词，从反对福利国家的极右翼到倡导福利国家的政治学家、经济学家与神学家，他们当时都是把「福利国家」与「极权国家」相对立，而不是与「自由放任」相对立的。&lt;/mark>至于后来人们经常提到的「福利国家vs自由放任」这种对立，那只有在排除专制、极权制度后的宪政民主背景下才会凸显出来。&lt;/p>
&lt;h2 id="福利是可问之责还是必谢之恩">福利是可问之责，还是必谢之恩？
&lt;/h2>&lt;p>然而在坦普尔的时代，民主的「福利国家」也在全力打仗，而与之对立的「强权国家」或「战争国家」也可能拥有国家福利安排。两者的区别何在？坦普尔没有清楚地说明。事实上，一直就有人明确指出英国同样也是「战争国家」&lt;sup id="fnref:9">&lt;a href="#fn:9" class="footnote-ref" role="doc-noteref">9&lt;/a>&lt;/sup>。但笔者认为，起码有如下三个区别是可以清楚划分的：&lt;/p>
&lt;p>第一，福利是可问之责，还是必谢之恩？——福利国家不是「皇恩国家」。&lt;/p>
&lt;p>第二，福利是正调节，还是反调节？——民主国家福利有高低，但不会有「负福利」。&lt;/p>
&lt;p>第三，百姓要求于政府，还是官府要求于百姓？——「主仆」权责是否倒置。关于这三点，有必要予以逐一说明。&lt;/p>
&lt;p>&lt;mark>「喜欢福利」的专制国家不同于「承担福利责任」的民主国家。「福利国家」中的福利是政府责任，不是「皇恩浩荡」。&lt;/mark>这本是常识。2012年5月9日，时任广东省委领导人汪洋在中国共产党广东省第十一次代表大会上有言：「人民群众是创造历史的主体，我们必须破除人民幸福是党和政府恩赐的错误认识。」&lt;sup id="fnref:10">&lt;a href="#fn:10" class="footnote-ref" role="doc-noteref">10&lt;/a>&lt;/sup> 此话立即引发「热议」。有人指责汪洋离经叛道，有人则说他只不过说出了个「常识」。但这个常识，许多人是陌生久矣。早在百余年前维新人士谭嗣同就在《仁学》中说：「君也者，为民办事者也；臣也者，助办民事者也。赋税之取于民，所以为办民事之资也。如此而事犹不办，事不办而易其人，亦天下之通义也。」&lt;sup id="fnref:11">&lt;a href="#fn:11" class="footnote-ref" role="doc-noteref">11&lt;/a>&lt;/sup>何有谢恩之说乎？&lt;/p>
&lt;p>的确，对于可问之责是没有谢恩一说的。只有那些你无法要求、但他还是给了你好处——比如慈善家的捐献等，你才应该感谢。但&lt;mark>政府必尽之责到底有哪些，人们看法很不同。&lt;/mark>在西方有的左派认为「从摇篮到坟墓」都可以问责于政府，有的右派害怕政府权力大了会减少民众的自由，因而在权责对应的宪政体制下，他们认为政府责任愈少愈好，即所谓「最不管事的政府是最好的政府」。但至少有一点他们都同意，就是认为应对紧急事态（比如重大灾害）肯定是政府的职责。西方的自由放任论者有的主张政府连教育和医疗都可以不管，&lt;mark>但从没有人主张政府可以不救灾（国防和外交也类似）。民主社会的人们无论左右，至少在救灾这个问题上对政府都是只会问责而不会谢恩的。&lt;/mark>&lt;/p>
&lt;p>2010年台风「凡亚比」（台湾称「凡那比」）吹袭台湾及中国大陆后，政府官员的应对及民众的反应就显示了一次极其鲜明的对比。该台风于9月19日横扫台湾时为「超强台风」，高雄冈山镇24小时降雨872毫米（几乎两倍于北京2012年导致80 人死亡的「721大暴雨」——房山河北镇最大雨量400 多毫米），结果致2人死（全台6人死）。当地舆论铺天盖地问责于政府。有传说高雄市长陈菊那天睡了午觉，当局岂敢说那是「谣言」？赶忙公布市长官邸当日的监视器画面，证明市长在坚守岗位。高雄当局公布了12时的监视视频，舆论又要求下午1时的；公布了1时的，又被要求追查2时至5时的。市府一律照办，不敢怠慢。「不过议员还是认为，只凭官邸监视器『不清不楚』的监视画面，车牌也不明显，不能证明当日行程。」尽管副市长表示，市长又不是刑事犯，「拿出监视器画面，就足以证明有诚意」，对于「市长在哪 」的话题为何延烧这么多日，感到相当不解，但在民意代表「大动作追查市长9月19号风灾当天行程」的逼迫下，陈菊市长「声音越来越小，语气越来越不肯定」，终于「抵挡不住议员的连番逼问，率领〔市府〕团队低头道歉，承认919风灾当天下午2点到5点，她在官邸休息」。这下不得了，在如潮的责问下，陈市长最终只能「语带哽咽地说：『我从来没有也绝不会推卸责任，……我只有向市民道歉、道歉、再道歉！』」而一些议员仍认为，「只有自责还不够，市长必须下台负责。」在那几天笔者亲眼见到该市长在电视上哭了三次。她到处「视察灾情，不停道歉」，每处都鞠躬谢罪，但不少灾民（不是什么反对党官员，就是普通老百姓）也没什么好脸色，一边接受救济，一边「呛声」曰：「不必选了！」……媒体报导的标题则有「台湾脉动：陈菊遭呛为灾情道歉」、「高雄市长台风天睡觉惹风波」、「姚立明：陈菊被台风『破了功』」⋯⋯除了「午睡」事件，台北、高雄的一些学者也纷纷质疑「政府治水不专业」，区域排水不合理，城市地面过份水泥化，影响降雨下渗，加剧灾情⋯⋯云云。&lt;/p>
&lt;p>当时，大陆这边的报导也宣传了台湾那边的「洋相」。可是这台风也不长眼，紧接就刮到了海峡的这一边。在遭受了比那边惨重得多的损失后，这边的媒体没有发出一句问责之声，只有铺天盖地的感恩：报纸表扬官员「身先士卒，鏖战一线」；有关部门发出通知：「宣传舆论要更加积极。要大力宣传报导……基层组织、基层干部和共产党员发挥的战斗堡垒作用、骨干带头作用和先锋模范作用，让灾区群众更真切地感受党和政府的关怀……」&lt;sup id="fnref:12">&lt;a href="#fn:12" class="footnote-ref" role="doc-noteref">12&lt;/a>&lt;/sup>
据报导，广大群众对「各级党委、政府，特别是广大领导干部在抢险救灾中表现出来的身先士卒、靠前指挥、不畏艰险、英勇奋战的优良作风和精神面貌表示崇高的敬意」&lt;sup id="fnref:13">&lt;a href="#fn:13" class="footnote-ref" role="doc-noteref">13&lt;/a>&lt;/sup>。&lt;/p>
&lt;p>然而，一个最基本的事实是：这场在台湾致死6人的「超强台风」在跨越海峡前已减弱为热带风暴，登陆大陆时再减为低气压；但是，这边仅一个省就因这「低气压」而死亡或失踪了136人！这样强烈的对比还让人说什么好呢？笔者真是无语了。&lt;/p>
&lt;p>当然这不是什么例外，&lt;mark>改革经历三十年后，我们的感恩宣传已经算是很克制的了。改革前更过份的事也是习以为常的：著名的大饥荒时代，受到救济的饥民感激涕零&lt;/mark>，笔者至今仍记得的一部样板戏有段声情并茂的唱词描绘那时：「乡亲们手捧馒头热泪滚，领袖的恩情，比天高，比地厚，更比海洋深！更比海洋深！」但是，&lt;mark>那几年有几千万人得不到馒头饿死了，那只能解释为「自然灾害」。小民怎么能、怎么敢、怎么会问责于官府呢？&lt;/mark>更有甚者，那时甚至在政府负有特殊责任的灾难中，受难者也为政府的应对感恩戴德。例如，同为饥荒时代发生的「为了六十一个阶级兄弟」事件，曾经在全国范围内引发了长时间的感恩浪潮。事由是1960年为三门峡工程配套的某公路工地上，一批被徵调来无偿修路的民工在工地伙房吃饭遭遇大规模中毒，政府空投解毒药进行救治。就政府而言，这当然是一种负责任的行为，但《中国青年报》于1960年2月28日刊发了题为〈为了六十一个阶级兄弟〉的报导，后经删节又入选中学课本，这篇风行神州数十年，进入了戏剧、电影、教科书、连环画等一切传播通道的典型报导中，竟然出现如此肉麻的文字：「咱这些普通民工闹点病，中央就派飞机救咱们，领袖真是咱贴心的人哪！」据称某老人对中毒的儿子说：「领袖在北京比咱老汉还关心我儿！小子，领袖才真是你的亲爹娘！」&lt;sup id="fnref:14">&lt;a href="#fn:14" class="footnote-ref" role="doc-noteref">14&lt;/a>&lt;/sup>&lt;/p>
&lt;p>但要知道，这些人不是在自己家中，而是在被政府征发劳役的过程中中毒的，尽管犯罪的是投毒者，但组织劳役的政府要承担的责任，也非民间社会上随机发生的一般中毒罪案中政府要做的破案、救治等一般公共服务责任可比。这不是什么特别的或现代发达国家的标准，中国古代「孟姜女哭倒长城」的故事也可以反映中国传统文化对这类事情的看法：尽管孟姜女的丈夫被秦始皇的政府征发去修长城而死于工地，他并不是被官府或官吏更不是被秦始皇蓄意谋害（至少故事没有这样说），而且修长城也可以说是那时的「公共工程」，与只为秦始皇个人服务的阿房宫、骊山墓不同，但是，人们还是认为秦始皇和朝廷对孟夫之死负有责任。毕竟是你把人征发去的，你对被你征发的人的生死难道不负有特殊责任？这和在自己家中自然死亡或意外死亡能一样吗？企业中如果出现员工事故伤亡，企业尽力抢救是正常的。员工获救不死，也仍然可以对企业问事故之责，并因受到损害要求企业负一定的赔偿之责，哪有丝毫不言问责、反而不死就要对老板感激涕零、以为深恩厚泽万死不足相报的道理？&lt;/p>
&lt;p>企业员工为挣钱而自愿受雇的尚且如此，如果是强征来无偿劳作的，征发者对被征发者劳役期间的死亡要负责就更不用说了。政府采取得力措施避免这种一旦发生自己就负有惊天之责的恶性结果发生，这难道不是理所当然的正常反应吗？这样做了不是什么大恩大德，不这样做就是草菅人命罪莫大焉了。一个孟姜女之怨就可以「哭倒长城」，何况六十一个「孟姜女」？&lt;/p>
&lt;p>五十年过去，现在我们知道，当时只报导在飞机投药后有六十一人死里逃生，没报导的是「其实中毒民工大都留下后遗症，不少人患了眼疾，有的大脑受症而痴呆，有的因患了胃癌或肺气肿而死去，还有一些其他病」。按文明国家的通例，这些人在被征发状态下遭到如此不幸，不仅无恩可感，还势必会提出问责和要求赔偿。而事实上，事发后平陆县当局也确实一度很紧张，以为官办工地食堂发生如此惊人的大规模民工中毒影响恶劣，「有关领导指示不许报导」。不料，北京的文人妙笔生花，一篇「感恩」报导创造了「坏事变成好事」的奇迹&lt;sup id="fnref:15">&lt;a href="#fn:15" class="footnote-ref" role="doc-noteref">15&lt;/a>&lt;/sup>。&lt;/p>
&lt;p>我们这里还有一个耐人寻味的现象是：政府救灾，老百姓要感恩戴德，山呼万岁。但是民间的慈善捐款和义工，却好像与纳税一样成为一种「他律」的份内责任，捐了无需感谢，不捐可以「问责」。政府部门往往出面「组织」民众纳捐，甚至直接从工资中扣捐，而舆论往往指责一些富人与民营企业捐得少，甚至要求经理人把属于股东的钱拿出来纳捐，出现所谓「逼捐」现象。&lt;/p>
&lt;p>这里要指出：社会上慈善意愿低落可以被认为是一种负面现象，人们应该忧虑并检讨其原因。但具体针对某某某指其该捐未捐、该多捐而捐少，则是十分奇怪的。如果慈善捐献不是出于一种自律的道德，而是变成一种「他律」的义务，那还能叫慈善，能叫捐献吗？提出这一问题倒不是像有些朋友主张的「为富人说话」：如果你是左派，是社会主义者，对社会平等有更高的要求，对贫富差异有更大的反感，那你可以要求改善二次分配，加强税收调节，提高累进率，让富人多交点税。但是，无论税多税少，公民的法定责任只能是纳税，而不是「纳捐」。税外再奉献公益，无论穷人富人都是献爱心，是他的权利，而非他的责任（注意：这是指狭义的〔即「他律」的〕责任，而非所谓「义不容辞的责任」之类的道德话语），是一种应受褒奖的善行，而非可以问责的必为。对于这种奉献，有之我们应该感谢，无之我们也不能逼索。「逼捐」会造成什么后果？我们都知道「苛捐杂税」这句成语，那就是历史上本来属于自愿奉献的「捐」成为强制义务后的景象。当「捐」成了横征暴敛的体现，其慈善的意义也就荡然无存了。&lt;/p>
&lt;h2 id="如果救灾尚且是皇恩何况其他">如果救灾尚且是皇恩，何况其他
&lt;/h2>&lt;p>对于公共服务，我们习惯于千恩万谢政府，还会厉声「逼捐」富人。这实在是完全颠倒的态度。最无争议的政府责任尚且如此，其他被称为「福利」的那些更高层次的、乃至对其是否可问之责还有争论的服务就更不要提了。&lt;/p>
&lt;p>不可否认，历史上不少专制国家（从斯大林式国家到纳粹德国）也搞过社会福利。但与瑞典这类福利国家不同的是：专制国家如果有福利，那就被认为是皇恩浩荡，臣民必须感恩戴德、山呼万岁。假如不给你福利，你也不能抱怨。而&lt;mark>瑞典国民享受「从摇篮到坟墓」的高福利，我们几时见过他们「吃水不忘挖井人，千秋万代颂党恩」？福利来自国民的税收，政府按国民要求收了这笔钱提供服务，服务好是应该的，服务不令人满意就请下台另选他人来干，如此而已。换言之，人们必须对福利感恩戴德的国家，就不是福利国家。&lt;/mark>&lt;/p>
&lt;p>在民主国家，相当程度的福利首先是被统治者所要求、而统治者不能不满足的（所谓「责任」，就是不管你喜欢与否都必须干的事）。所以统治者是否喜好福利，并不很重要。现代瑞典史上曾经有「右派」执政的时期，他们并不喜欢福利国家，但他们也不得不搞许多福利。除非他们能说服选民取消福利立法，否则那些责任就无法卸除。类似地，在经历1990年代「剧变」后执政的一些东欧国家自由派人士是相信「自由放任」的，如先后担任捷克总理和总统的克劳斯（Vaclav Klaus）作为芝加哥学派科班出身的经济学家，对「社会市场经济」、「福利市场经济」这类说法嗤之以鼻，多次声称他要搞「不带任何限制词的市场经济」、「百分之百的资本主义」。但在民主的捷克，任何统治者都得看选民的脸色办事，而捷克百姓只会嫌你权力太大，却很难让你的责任变小。剧变以后他们要更多的自由，却不接受更少的福利。结果，在克劳斯执政的八年间，捷克以全欧最高的就业保障和「退休金增长比工资快」而著名，克劳斯本人则被外国媒体称为「欧洲最大的社会民主主义者」&lt;sup id="fnref:16">&lt;a href="#fn:16" class="footnote-ref" role="doc-noteref">16&lt;/a>&lt;/sup>。
其实克劳斯怎么会信仰社会民主主义？但他确实一方面以「平均分配，还资于民」的方式实行「激进自由主义」的私有化，另一方面又奉行高税收、高福利的社会民主政策。以至于1995年美国著名经济学家、「休克疗法」（Shock Therapy）之父萨克斯（Jeffrey Sachs）访问捷克时，两位新自由主义者发生了一场有趣的争论：萨克斯建议克劳斯学习「亚洲虎」，摆脱福利包袱促使经济起飞；克劳斯断然拒绝这种「亚洲思想」，声称高税收、高福利政策体现了「欧洲文明」，改变这种社会政策并使之「降低到那些亚洲国家的水平」是不能允许的&lt;sup id="fnref:17">&lt;a href="#fn:17" class="footnote-ref" role="doc-noteref">17&lt;/a>&lt;/sup>。当然，民主国家的选民也可能选择高自由而不是高福利。但那也是国民的选择，而非统治者的选择。&lt;/p>
&lt;p>与此相反，苏联的福利也许不少，但那并非因为被统治者有权要求，而是因为统治者由于各种原因而「喜欢」搞福利；倘若他不喜欢了，就可以不搞。苏联历史上很长时期，绝大多数人口（农民）不但没有什么福利，甚至在1921年、1930年和1946年前后还因「人祸」多次发生饿死几百万人的饥荒。这样的情形如果发生在瑞典乃至在并非福利国家的其他宪政国度（例如美国），统治者必然被追究责任；但在苏联，这丝毫不影响斯大林的威权，因为给不给你福利乃至管不管你死活，这是他的权力、他的喜好，而非他的责任。至于他可能有（也可能没有）的「福利爱好」（或曰「社会主义爱好」）本身是否有理，是否可取，那是另一回事。&lt;/p>
&lt;p>所以同样是搞「福利」，瑞典政府搞是尽责，斯大林搞则是弄权（要赞扬的话可以说他是「善意弄权」，但反正不是尽责）。并非只有宪政政府才搞福利，但承担「福利责任」的确只在宪政之下才可能。因此，&lt;mark>如果把「福利国家」不是当作统治者的个人爱好，而是看作一种使政府承担福利责任的制度安排，那的确只有民主国家才有可能是「福利国家」——尽管并非所有民主国家都会选择福利国家这种制度安排。而专制制度下可能有「喜欢福利」的专制者，但不可能有承担福利责任的国家。&lt;/mark>&lt;/p>
&lt;p>这并不是说高福利一定就是好制度。笔者曾遇到一位法国新自由主义学者，他对该国的农业保护政策批评甚厉。但中国同行问他：政府这样搞是不是为了追求「政绩工程」？他却一脸茫然。法国人听不懂「政绩工程」、「形象工程」这类词汇。政府都要追求政绩，只是他们只能追求讨好老百姓的政绩，而不是讨好上级的政绩，我们从后者来理解的这个贬义词因而也就没法给他们翻译。法国对农民的保护也许确实过份而且有不少弊病，但政府的确是在农民的要求下这样做。你可以说这些要求不合理，却不能说政府为了讨好上级制造「政绩」而坑害农民。而后一种做法即便打造福于农民的旗号，实际上与「福利国家」应该是毫不相干的。所谓「福利国家之弊」也不可能是这种性质的弊病。&lt;/p>
&lt;h2 id="民主国家福利有高低但不会有负福利">民主国家福利有高低，但不会有「负福利」
&lt;/h2>&lt;p>&lt;mark>「福利国家」中的二次分配必须是正调节，而不能是负调节，亦即必须缩小而不是扩大贫富差距。这也容易理解：福利政策既然是老百姓要求于政府、而不一定是统治者喜好的，就必然具有这个特点。国民中贫多富少固然会使「多数决定」产生的福利立法有利于穷人&lt;/mark>（如果批评者认为「长远地看」未必如此，至少当下应当如此）。即便国家已是「中产社会」，真正的穷人很少，而且假定人们是「经济人」，并无强烈的慈善动机，那么按罗尔斯（John Rawls）的论证，人们对自己地位的不确定性也会使他们倾向于选择一种「有利于最弱者」的安排。&lt;/p>
&lt;p>对这种逻辑唯一的挑战可能是近年来为论证NGO（即民间公益部门）的必要性而提出的对「特殊弱势者」的「福利失灵」理论。根据这种理论，那种一般人确信自己不可能遇到的境况（如罹患艾滋病之类特殊病症），或特别弱小的族群，或根本无法提出诉求的动物，处于「无知之幕」外，出于民主选择的福利国家就可能难以对之提供足够的保护，因此需要另有NGO。但是一般来讲，这种「特殊弱势者」与人们无法肯定自己不会遇到如老弱、失业、生病等的「一般弱势者」相比数量很小。上述分析并不影响民主福利制度总体上的正调节功能。&lt;/p>
&lt;p>因此，民主国家的任何福利政策都会对初始分配后的贫富差距多少起到「缩小」的调节作用。从数值分析角度看，就是二次分配后的基尼系数（Gini coefficient）要比初始分配后的基尼系数小。区别只在于有的安排是「高福利」，调节力度大，有的安排是「低福利」，调节力度小，乃至近于「自由放任」。但是反向的调节，理论上在民主国家是不可能的，而实际上也是如此。表1显示，高福利的北欧诸国在二次分配后基尼系数大幅下降，瑞典、芬兰都下降一半左右，英、法、德等西欧国家也下降较多，而美国则下降最少，这被认为近于「自由放任」了。但无论下降多少，这些国家都没有出现因二次分配反而扩大基尼系数的「负调节」现象。&lt;/p>
&lt;p>表1 1960至1980年间主要民主国家二次分配前后的家庭收入基尼系数变化&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>国家&lt;/th>
&lt;th>美国&lt;/th>
&lt;th>法国&lt;/th>
&lt;th>英国&lt;/th>
&lt;th>德国&lt;/th>
&lt;th>挪威&lt;/th>
&lt;th>芬兰&lt;/th>
&lt;th>瑞典&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>二次分配前&lt;/td>
&lt;td>0.340&lt;/td>
&lt;td>0.500&lt;/td>
&lt;td>0.380&lt;/td>
&lt;td>0.450&lt;/td>
&lt;td>0.350&lt;/td>
&lt;td>0.460&lt;/td>
&lt;td>0.390&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>二次分配后&lt;/td>
&lt;td>0.324&lt;/td>
&lt;td>0.309&lt;/td>
&lt;td>0.276&lt;/td>
&lt;td>0.262&lt;/td>
&lt;td>0.238&lt;/td>
&lt;td>0.225&lt;/td>
&lt;td>0.202&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>资料来源：Felix Paukert,“Income Distribution at Different Levels of Development: A Survey of Evidence”, International Labour Review 108, issue 2/3 (1973): 97-126；科佩（Walter Korpi）著，刘玉安摘译：〈从比较的角度看瑞典福利国家的发展〉，《当代世界社会主义问题》，1993年第2期，页57；向文华：《斯堪的纳维亚民主社会主义研究》（北京：中央编译出版社，1999），页135。&lt;/p>
&lt;p>但是，如果所谓「福利」并非出于民主选择，而是基于统治者的喜好，负调节就绝非不可设想。因为既然是「皇恩」，当然首先就会降临在皇上喜欢的人、用得的人，即权贵和有特定身份者身上。芸芸众生如果能够分沾也不可能与之相比；而那些最弱势的失业者，即皇上讨厌的「盲流」，受惩罚还来不及呢，怎么敢讨要「福利」？三百五十多年前的黄宗羲就曾在《明夷待访录．原法》中指出那时的「福利」是「利不欲其遗于下，福必欲其敛于上」&lt;sup id="fnref:18">&lt;a href="#fn:18" class="footnote-ref" role="doc-noteref">18&lt;/a>&lt;/sup>！这就是一种以国家强制力量「劫贫济富」给特权者提供福利的安排。反映在数值分析上，就是二次分配后的基尼系数不降反升。&lt;/p>
&lt;p>古代经济史虽然因数据缺乏难以计算基尼系数，但上述道理是显而易见的。例如中国过去皇上根本不领工资，不仅「从摇篮到坟墓」都是国家财政包下来的，三千佳丽、九重宫室、百里苑囿、万顷陵园也都是国家权力「二次分配」的结果。皇室之外，各地的「朱门酒肉臭，路有冻死骨」也都源于这种机制——了解历史传统的人都知道所谓「朱门」就是权贵之门，并非民间富人或地主所能僭有。这样的分配自然不是「自由放任」，但这是「福利国家」吗？&lt;/p>
&lt;p>这里要说的是何为「二次分配」？一般来说，民间经济关系（交易、雇佣、租佃、自给自足等）中的分配，或者按马克思的说法，「劳动产品、能力和活动进行私人交换」造成的分配就是所谓「初始分配」，而国家权力进行的强制性分配（赋税及各种「保障」、「待遇」等），亦即马克思所说的「以统治和服从关系（自然发生的或政治性的）为基础的分配」&lt;sup id="fnref:19">&lt;a href="#fn:19" class="footnote-ref" role="doc-noteref">19&lt;/a>&lt;/sup>，称为「二次分配」。在民间经济发达的社会，以上分析是没有歧义的。但在民间经济不发达的状态下又如何？最近王绍光著文说：计划经济时代是没有「二次分配」的，因为国家的「分配」已经很平等了，所以不需要「二次分配」&lt;sup id="fnref:20">&lt;a href="#fn:20" class="footnote-ref" role="doc-noteref">20&lt;/a>&lt;/sup>。这个说法意在为中国旧体制缺少正调节机制辩护。但此说在逻辑上显然会导致混乱：假如我们设想对一个市场经济进行「社会主义改造」，逐渐增加高税收、高福利的比重——亦即公认为「二次分配」的比重，那么在逻辑上当「二次分配」率达100%时（所有的收入全部被征收），这个经济就完全国有化或「社会主义」化了。如果说完全没有二次分配而只有100%的初始分配，那就是彻底的「自由放任」，与「计划经济」不是恰好相反吗？所以，如果说完全的计划经济只有一种分配机制的话，那恰恰就是只有「二次分配」，而不是只有初始分配。&lt;/p>
&lt;p>但实际上「完全的计划经济」几乎是没有可能出现的（战争时期的供给制可能近似），现实中的计划经济仍然有两层分配机制：一是个人可支配的名义工资或收入；二是等级化的「福利」，即住房、用车、医疗、仆役、休养、食物特供等形形色色的「待遇」。计划经济下的工资尽管也是国家发放的，不完全同于民间经济中的初始分配，但它的消费毕竟要通过「私人交换」，可以说是一种「准初始分配」，而福利待遇则是完全的二次分配。&lt;/p>
&lt;p>计划经济年代中国的这种初始分配并不平等，如毛泽东所言「有八级工资制」，他称之为「资产阶级法权」。可是谁都知道，那时更严重得多的不平等并不是什么八级工资，而恰恰是那种「二次分配」。数值分析表明，1978年中国城市内部按官方统计的货币收入，其分配的基尼系数为0.164，农村内部也仅为0.227，应当说「分化」很小。但主要由于「福利」因素的悬殊，城乡合计的基尼系数就达0.331&lt;sup id="fnref:21">&lt;a href="#fn:21" class="footnote-ref" role="doc-noteref">21&lt;/a>&lt;/sup>。与表1所示相比，仅此一项「再分配」就比任何发达国家再分配后的「分化」更严重。如果再考虑城市内部的「负福利」（如毛泽东说的「城市老爷 生部」、前生部副部长殷大奎说的「公费医疗支出80%用于领导干部」等），那就更不得了。&lt;/p>
&lt;p>而这种&lt;mark>「福利特权化，公共物品非公共化」，就是一种典型的「负福利」，因为它不是缩小、而是严重扩大了以名义工资来显示的不平等。民主国家福利有高低，但不可能有「负福利」，他们也不讨论这个问题。但是专制国家如果不引入「负福利」概念，就没法进行最基本的分析。&lt;/mark>&lt;/p>
&lt;h2 id="关于负福利的比较分析以医疗为例">关于负福利的比较分析：以医疗为例
&lt;/h2>&lt;p>以医疗福利为例，英国的公费医疗是全覆盖的，当然属于福利国家政策。美国对多数人口只实行商业性医疗保险（自己出钱保自己），而联邦与州财政部门进行转移支付的福利性医疗保险（Medicare与Medicaid）只覆盖老人与穷人。由于福利性医保覆盖率低，所以美国与多数欧洲国家相比是公认的低福利国家。但是，美国已有的福利所覆盖的确实是弱势群体，所以其分配还是有正调节功能。&lt;/p>
&lt;p>而在中国，过去占人口大多数的弱势群体农民并无医疗福利，近两年情况有所改善，「新型农村合作医疗」取得了一些成绩。其中江苏省是推行「新农合」的排头兵，2007年参合率达95%，居全国首位，各项农村首。该年「新农合」覆盖4,300万农民，人均筹资76元，超过国家规定许多。但就是这个省份，仍有约664万人未覆盖。而另一方面，该省城镇居民医疗保险制度覆盖1,088万人，人均筹资150至550元；城镇职工基本医疗保险制度覆盖1,434万人，人均筹资1,200至1,500元；而全额公费医疗待遇覆盖人口（即某级以上官员）仅14.4万人，人均筹资却达4,200至6,000元&lt;sup id="fnref:22">&lt;a href="#fn:22" class="footnote-ref" role="doc-noteref">22&lt;/a>&lt;/sup>。按这组数据，该省某级以上官员占有的医疗福利资源可达农民的80倍。官员的初始分配收入也高于农民，但绝没有高出那么多。所以这种二次分配的「负福利」性质是很明显的。&lt;/p>
&lt;p>当然即便如此，笔者仍然认为&lt;mark>「新农合」（尤其是江苏省的那种「新农合」）是值得称赞的一大进步。&lt;/mark>因为与过去全部福利资源都在少数人中分配、农民完全被排斥在外的状态相比，&lt;mark>如今江苏农民不仅开始享有福利，而且还比全国平均水平高。虽然总体上还远未脱离负福利状态，但负福利的程度已经比过去降低。&lt;/mark>不过，这种状态长远地看固然可以说是向福利国家迈进，就当前而言，毋宁说首先是在向被称为「自由放任」的低福利国家靠近了。&lt;mark>负福利程度的减少不是意味 向「零福利」接近吗？而只有达到零福利这一临界点，正调节才开始起步，「自由放任还是福利国家？」才开始成为真问题。&lt;/mark>&lt;/p>
&lt;p>另一个可资比较的案例是1994年民主化以前南非在压迫黑人的种族主义制度下的福利安排。笔者以前曾提到那时的南非有「黑人各尽所能，白人按需分配」的「种族社会主义」特征。单就白人而言，那是个几乎类同北欧的高福利体制，尤其是「穷白人」受到很好的照顾；但是黑人则处于「既无自由又无福利」的境地。由于初始分配就是黑贫白富而且差别悬殊，二次分配又是白人锦上添花，黑人「有雪无炭」，这种「福利」在宏观上就成了一种扩大而不是缩小不平等的反向调节，可称之为「负福利」。民主国家只有高福利和低福利之分，是不可能有「负福利」的。但是旧南非和中国这样的体制下「负福利」就是个严重问题。&lt;/p>
&lt;p>改变负福利的方式有渐进和激进之别。渐进方式是通过逐渐增加最下层的福利而控制上层的福利，减少反向调节的力度，或者说是从「负高福利」变成「负低福利」，逐渐变成「零福利」（不一定是无福利，但福利分配与初始分配同比例给予，不平等既未增加也未减少，调节效果近于零），再进一步变成「正福利」，这时才有西方民主国家意义上的「高福利」和「低福利」之别。中国这些年的福利改革正处于「零福利」前的渐变过程。以上述江苏为例：过去最底层的农民完全自费看病，一般国家职工比农民初始收入就高，却还有基本水平的公费医疗，而高官初始收入更高，又享有无限制全额公费医疗，这就是「负高福利」。现在农民有了「新农合」，比职工医疗保险水平仍低，比高官的医疗待遇更低，但总是有胜于无，与过去相比，就是从「负高福利」变成「负低福利」，仍然是「负」，但负得少了，离「零福利」的临界点近了，这还是进步，也可以说是渐进吧。&lt;/p>
&lt;p>这种状况也相当于旧南非在种族隔离末期的情况。当时由于黑人的抗争、国际的压力和白人开明力量的推动，南非的福利也由白人专享变成在覆盖白人的基础上也向黑人渗透。到1980年代中期，南非社会总支出（即国家财政的福利和公共服务支出）的约40%被用于占人口百分之十几的白人，而43%用于占人口绝大多数的黑人，白人还是占很大便宜，不过黑人也多少有了点福利，也是从「负高福利」变成「负低福利」了。&lt;/p>
&lt;p>但是1994 年以后，南非的政治格局发生了根本变化。曼德拉（Nelson R. Mandela）—姆贝基（Thabo Mbeki）时代虽然没有像津巴布韦那样从产权和初始分配上剥夺白人，但二次分配的变化却很激进。南非的福利体制一下子就由向白人倾斜变成明显向黑人倾斜。到1990年代后期，社会支出用于黑人的比重从43%上升到80%，而用于白人的则从40%急降为不到10%&lt;sup id="fnref:23">&lt;a href="#fn:23" class="footnote-ref" role="doc-noteref">23&lt;/a>&lt;/sup>。这等于把原来在白人中 实行的那套福利移用到黑人身上，原先白人锦上添花，黑人「有雪无炭」，现在黑人得到雪中送炭，白人却「有锦无花」了，南非从「负福利」不经临界点直接进入了「正福利」，而且在很多方面是「高福利」了。当然，这样的彻底改变只有在民主化之后才有可能。&lt;/p>
&lt;p>因此我们可以区分两种「二次分配」：&lt;mark>先有公平的自由竞争，再用民主的二次分配减少竞争造成的结果不均，这叫「福利国家」；而先取消自由，代之以虚幻的「平均」，再以不民主的「特权福利」造成严重的等级分化，这就叫「负福利国家」。改革前的中国和种族隔离时代的南非，就是「负福利国家」的两个典型。&lt;/mark>&lt;/p>
&lt;p>负福利就是用强权「劫贫济富」，其不公正甚于「零福利」或「自由放任」。换言之，「负福利国家」与「福利国家」的区别，大于民主国家中「自由放任」与「福利国家」的区别。对于「负福利」严重的国家而言，能够实现「零福利」已经是向福利国家接近了一步。但问题在于：转轨时期如果在「权家通赢」的机制下出现不公平竞争，那就完全可能造成初始分配不平等的恶化，而「负福利」的不公平却未必可以缓解。在这种情况下回避「负福利」之弊来强调「自由放任」与「福利国家」的对立只能治丝益棼，甚至两者叠加可能造成恶性循环：因初始分配不平等而呼唤「二次分配」，而二次分配在强权之下却变成「负福利」，负福利在转轨过程中又加剧了初始分配不平等。权家通赢导致赢家通吃，以纠正赢家通吃为理由强化权力分配又反过来加剧了权家通赢。显然，这时如果回避政治体制改革，无论是以「福利」为理由压抑自由，还是以「自由」为说辞回避真正的福利诉求，都会出问题。&lt;/p>
&lt;p>因此，&lt;mark>在中国转型过程中我们必须特别注意「负福利」问题，而这是民主国家只会在「自由放任」与「福利国家」间进行辩论的经济学并不重视的。如果不能解决「福利特权化、公共物品非公共化」的问题，单纯增加公共品供应未必有助于改善不平等。&lt;/mark>拿前一阵子成为舆论热点的医疗改革来说，当初说医疗福利萎缩和过份市场化使人看不起病，出路似乎在于加大政府垄断；然而，不久就有权威消息披露：中国如今的公费医疗开支竟有80%花在领导干部身上，这样的「福利」，究竟是谁之福，谁之利？增加这样的「公共品」，能改善老百姓的医疗保障吗？&lt;/p>
&lt;p>又如近来房价太高，一些单位「恢复」盖「福利房」又引发争论。房地产商为维持高房价而反对住房福利，这和主张消灭「小产权房」一样固然是不合理的，可是现在所谓的「福利房」是否具有「负福利」性质呢？如下所言，发达国家那种廉租房制度过去在中国从未有过，中国改革前的住房制度很大程度上就是「负福利」性质的。今天即便国家的廉租房一时难产，如果民营企业或充分竞争领域的国营企业为职工盖福利房，应当是一件好事（当然这类企业通常只能量力而行），但如果垄断部门以其垄断性暴利来为「内部人」发高薪（如2012年江苏的「电力公司抄表工月薪万元」）已经引起争议，现在又以垄断性暴利为「内部人」搞住房之类的「高福利」，那的确是典型的「负福利」了。&lt;/p>
&lt;h2 id="百姓要求于政府还是官府要求于百姓主仆权责是否倒置">百姓要求于政府，还是官府要求于百姓？——「主仆」权责是否倒置
&lt;/h2>&lt;p>福利国家的「福利」必须是公民的权利、政府的责任，而不能反过来变成政府的权力、公民的责任。这意味：公民需要「政府保证就业」那是福利，而政府强迫你劳动就不是（如古拉格、奥斯威辛）。国家对穷人住房承担责任，以廉租房与福利房来改造贫民窟那是福利，而用铁腕「城管」拆掉穷人的「违章建筑」来「消灭贫民窟」，而且公然声明「不补偿，不安置，否则后患无穷」就更不是了。「想来就来，想走就走」（2003年「孙志刚事件」后天津市民政局提出的新救济原则）的流浪者救济是福利，强制性「收容遣送」（如当年孙志刚遭遇的）就不是。政府提供免费教育是福利，政府把无力掏钱供孩子上学的家长抓起来示众、审判（1990年代中国传媒多次报导过某些地方政府把所谓「违反义务教育法」、没有掏钱送孩子上学的农民抓来严惩的事情）就不是。国家提供养老保险是福利，国家把农民束缚在土地上令其自耕终老而不许留在城 「添麻烦」就不是。&lt;/p>
&lt;p>然而，在这方面权责倒置的错误屡见不鲜。例如有人以「社会保障不能私有化」为理由剥夺农民地权，这是毫无道理的。因为「社会保障不能私有化」这句话如果能成立，它只能是说提供保障的责任不能私有化（不能让老百姓自己保障自己而国家不负责任），而享受保障的权利当然属于每个公民（而不是属于「公家」），因此这种权利当然是「私有化」的。公家买单给百姓看病是社会保障，如果反过来，是政府弄权让百姓承担责任来保障「公家」，那叫社会福利吗？过去农民自己耕田养老，这「保障」责任就已经「私有化」了（实际就是说没有社会保障），政府不仅不买单，还反过来禁止农民处理自己的土地，这样做即便有某种理由（方便圈地、有利于国土整治、有利于农民的长远利益等），与社会保障有何关系？如果说有，不就是「负保障」吗？在无人买单的情况下，有地权的农民如果无钱治病，万不得已他还有「卖地救命」的一条路，现在你把他们这最后的路也给堵死，却说农民反而有了「保障」，这不是奇谈怪论吗？&lt;/p>
&lt;p>当然现代福利制度也有某些个人责任要求，例如在「国家—企业—个人三方统筹」的保障模式下，个人的那份保险金属于强制性交纳责任。但这只能是公家责任的一种补充。如果国家、企业都一毛不拔，只是弄权强迫你自己买单治病，即便这出于好心，与「福利」保障也是不搭界的。当然，国家本身不会生钱，政府买单最后还是来自纳税人的钱包，但&lt;mark>在「无代表不纳税」的民主体制下，作为纳税人的公民最终还是权利的主体，是公民要求政府用这些钱为咱们提供服务，这些钱该不该征、征来怎么用，咱们是有权说话、有权监督的&lt;/mark>，不是皇上要咱们「耕田奉上」为他纳粮当差。可见这一点最后还是归结为：福利国家首先必须是民主国家。&lt;/p>
&lt;p>&lt;mark>显然，形成这样的权责关系应当说是福利国家的基础。&lt;/mark>事实上，中外历史上专制时代国家也有所谓的「济贫」措施。但那时的「济贫」常常是强制性的收容、管制甚至劳改，与其说「济贫」，不如说是「惩贫」。如公益制度史上英国十八世纪以前有所谓「旧济贫法时代」。1349年英王颁布《劳工条例》（Ordinance of Labourers），规定当局应当捕捉流浪汉，禁止民间对非残疾的乞丐给予慈善帮助。1531年英国颁布更严厉的禁乞法令，不仅规定对流浪汉要强制收容劳教，而且抓住健康的乞丐要在市场上当众施以鞭刑。这就是所谓的「血腥立法」。但与此同时，政府也承担了一些责任。1536年的《亨利济贫法》（Henrician Poor Law）就规定一方面要惩罚有劳动能力的流浪者，另一方面要对老弱病残者给予帮助&lt;sup id="fnref:24">&lt;a href="#fn:24" class="footnote-ref" role="doc-noteref">24&lt;/a>&lt;/sup>。1601年的《伊丽莎白济贫法》（Elizabethan Poor Law）在这两方面都予以强调，并且开始倾向后者，英国从那时起有了法定的济贫税和国家办的济贫院。很多人因此把现代福利制度溯源于它。但实际上，公益制度史上的伊丽莎白时代仍然属于「旧济贫法时代」，当局对弱势者弄权常常突破限制，而对弱势者承担的责任则不能追索，往往口惠而实不至。&lt;/p>
&lt;p>1834年，英国在宪政民主体制相对发展后实行了福利改革，颁布了《新济贫法》（Poor Law Amendment Act），不再允许随意强制收容、拘禁流浪汉和乞丐，而政府的济贫责任则逐渐法定化。尤其是「院内救济」（穷人可以申请进入济贫院）在这一时期大为发展。走投无路的穷人都可以要求国家给饭吃，如果有人饿死，官员要被追究责任。可以说，这时弱势者有了「流浪权」，而当权者开始尽救助责任。但是，这时的权责还并不完全对应。如虽然政府不再有权随意「收容」穷人，但穷人一旦申请进入济贫院，其自由就受到许多限制，而且入院等于宣告自己无产，根据当时的选举权财产资格制度也就被剥夺了选举权等政治权利。同时，政府的责任仅限于济贫院内救济，对于居家的穷人并不承担责任。而且当时政府还尽量降低院内救济标准，使受救济者难以长期面对院内的恶劣生活，以迫使他们尽快出去找工作&lt;sup id="fnref:25">&lt;a href="#fn:25" class="footnote-ref" role="doc-noteref">25&lt;/a>&lt;/sup>。&lt;/p>
&lt;p>只有&lt;mark>到了十九世纪后期，英国实现了无财产资格限制的普选权，在比较完善的民主制度下，「为自由而限权」与「为福利而问责」的进程都在发展。此后英国（乃至其他民主国家）尽管一直有「自由放任」与「福利国家」的争论与「群己权界」的左右游移，但是再发达的「福利国家」也不能滥权，再潇洒的「自由放任」政府也不能无责。&lt;/mark>1908年，乔治（David L. George）的自由党政府推出国家福利养老金制度，它不但把政府责任扩大到济贫院以外的整个社会，英国公民凡收入低于31英镑10先令者都有资格领取养老金，而且规定严格保护领取者的经济政治权利：任何人不得因领取养老金而被剥夺选举权和宪法保护的其他基本权益&lt;sup id="fnref:26">&lt;a href="#fn:26" class="footnote-ref" role="doc-noteref">26&lt;/a>&lt;/sup>。这时的英国还不是今天所说的「福利国家」，但已经有了建立福利国家的基础。&lt;/p>
&lt;p>相反，德国魏玛共和时期有《志愿工作法》，到纳粹时代变成《义务劳动法》。自愿奉献的权利变成了国家强制履行的义务。1934年更发展为《国民劳动秩序法》，禁止罢工，被强制「奉献」者每天须从事军事训练与劳动服务，集体生活一如军营，平时为「义务劳动」的工人，战时即为「保国家」的战士&lt;sup id="fnref:27">&lt;a href="#fn:27" class="footnote-ref" role="doc-noteref">27&lt;/a>&lt;/sup>。后来，第三帝国即以此体制为基础发动战争。可见上述权责关系一旦倒置，福利国家就不再是福利国家，而变成「负福利国家」，或坦普尔所说的「强权国家」了。&lt;/p>
&lt;h2 id="切莫错把杭州作汴州">切莫「错把杭州作汴州」
&lt;/h2>&lt;p>以上关于「福利国家」的三个标准，归根结底就是一个：福利国家必须首先是民主国家。福利国家一般税率较高，尤其是对富人征收的、具有转移支付性质的累进税高。但是这个「定理」的逆定理，即「凡高税率，或者具有抑富性质的累进税率的就是福利国家」则不能成立。高税率国家未必就是福利国家容易理解：否则任何横征暴敛的国家都可以叫福利国家了。那么为什么具有抑富税率的国家也未必是福利国家呢？道理很简单：因为「抑富」未必就是为了济贫——请注意，这讲的并非抑富能不能济贫。一些主张自由放任的经济学家常常论证抑富并不能真正达到济贫，并以此批评福利国家，对此可以再讨论。但是，在宪政民主制度「无代表（公民）不纳税」和「无代表（财政）不支付」的规则下，抑富至少不可能是为权贵而「与民争利」。&lt;/p>
&lt;p>然而，如果没有上述规则，权贵藉「抑富」而「与民争利」是完全可能的。中国古代的法家就一方面说「民富则淫」，主张「重租税以困辱之」&lt;sup id="fnref:28">&lt;a href="#fn:28" class="footnote-ref" role="doc-noteref">28&lt;/a>&lt;/sup> ；
另一方面又认为「贫弱者，非侈即惰也」，坚决反对救助他们。于是从汉武帝「告缗遍天下」，到明末崇祯帝的加派政策宣称「弗以累贫不能自存者，素封是诛」&lt;sup id="fnref:29">&lt;a href="#fn:29" class="footnote-ref" role="doc-noteref">29&lt;/a>&lt;/sup>
，多次弄到 「商贾中家以上大抵破」&lt;sup id="fnref:30">&lt;a href="#fn:30" class="footnote-ref" role="doc-noteref">30&lt;/a>&lt;/sup>
，「豪民巨族铲削殆尽」 &lt;sup id="fnref:31">&lt;a href="#fn:31" class="footnote-ref" role="doc-noteref">31&lt;/a>&lt;/sup> 。
但是贫民不但没有得到什么福利，反而陷入绝境，以至于官逼民反，天下大乱。马克思也曾指出：封建制度的经济特征是「通过如任意征税、没收、特权、官僚制度加于工商业的干扰等等办法来捉弄财产」&lt;sup id="fnref:32">&lt;a href="#fn:32" class="footnote-ref" role="doc-noteref">32&lt;/a>&lt;/sup>
。任何人也不会认为这就是「福利国家」。&lt;/p>
&lt;p>在宪政民主国家，福利争论是在「正福利」的前提下进行的。左派或者社会主义者（宪政条件下当然是民主社会主义者）主张高福利，右派或者自由主义者（这里主要指经济自由主义者或所谓「自由放任主义」者）主张低福利。但是对于负福利，自由主义者和社会民主主义者是不可能产生争论的，不管自由主义者还是社会民主主义者都不会赞成负福利，而且他们的主张都可以抵制负福利。假如你是自由主义者，你是反对高福利的，那么你在负福利条件下就应该首先反对当官的享受福利，农民享受的本来就鸡毛蒜皮一点，有什么可反的？福利本来就非常低，而且比西方任何最低的福利国家还要低，你反什么？如果你真是自由放任主义者，在这种背景下就得反对特权者的福利。或者你也可以反对以「负福利」为导向的税收，这有什么？中世纪那种「加之于工商业的重税」不是连马克思都反对吗？&lt;/p>
&lt;p>但如果你是社会民主主义者呢，你呼吁福利，当然就得为最弱势的人要求福利，而且是作为问责，而不是作为皇恩来乞求；当然也不可能为高官呼吁福利。假如左派成功地增加了底层福利，假如右派成功地遏制了权贵的福利，那不就是共同促使「负福利」朝 「正福利」方向改变吗？有什么可争吵的？这样推进到一定时期就会逐渐变成「零福利」，再进一步发展就会变成「正福利」。到了这个时候，福利高一点、低一点就成为真问题了。在这之前「高低福利之争」前提都没有，就是假问题。&lt;/p>
&lt;p>不过，&lt;mark>现在有一个最糟糕的现象，就是那些反对福利的人其实往往都是针对最穷的老百姓，都是说老百姓不能要求这、不能要求那，而拿当官的高福利没辙。可是那些主张要搞高福利的人却反对制约权力，这样就没法避免福利一旦搞了就是当官的先得。&lt;/mark>比如现在的保障性住房。本来保障性住房制度在西方也是有争议的，包括笔者过去讲的美国的福利房社区被视为贫民窟的问题，这是美国经常讨论的。&lt;/p>
&lt;p>但是在中国恰恰相反，严重的问题是保障性住房现在的两个特征：「经适房优先公务员，廉租房不给农民工」，我们现在绝大部分「保障房」是所谓经济适用房而优先分给官员。保障房中分量很小的廉租房也是给有城市户籍的人盖的，而城市户籍的困难户现在没有多少。没有多少也不是中国的「优越性」，因为全世界的城市贫民，尤其是城市化阶段的城市贫民主要都是由乡村来的新移民组成的，不光是中国。只不过我们和他们的区别就是：他们承认这些新移民是城市贫民，我们不承认，我们说他们是「农民工」，是「外地人」。如果只是要保障老市民，其实西方也没有多少老市民需要你保的。任何一个国家居住在所谓的「贫民窟」的人和住得不好的人基本都是在城市化过程中新进城的人。如果所谓「保障性住房」不是针对他们的，你搞它干什么？不就是负福利吗？搞出来都是给官员的，西方不管是自由主义者还是社会民主主义者哪个人能赞同这种做法？&lt;/p>
&lt;p>所以，所谓「福利房变成贫民窟」根本就不是中国的问题。而中国的问题很简单，我们左、右派也应该针对中国问题朝上述所讲的两个方向努力，尽管不能一步到位，但是你至少不能让它变本加厉。如果是反福利的右派，我就要提出经适房绝不能优先给公务员，反过来如果我是左派，就要提出廉租房要优先给农民工，否则你说你是自由主义者或者社会民主主义者？你什么都不是。&lt;/p>
&lt;h2 id="既要马儿跑又要马儿不吃草作为一种要价策略">「既要马儿跑，又要马儿不吃草」：作为一种要价策略
&lt;/h2>&lt;p>关于西方福利的问题这至少在实行宪政以前是不能否认的。也可以简单谈谈。最近西方发生债务危机，左派和右派就争论起责任来。左派说是因为经济太「自由」，尤其是金融太「自由」了，就出现「次贷」；右派说是福利太高，结果搞出个债务窟窿盖不住了。其实「自由放任」与「福利国家」各有弊病，但如今这种债务危机，无论「高税收、高福利」的左派主张还是「低税收、低福利」的右派主张，单独实行都是不可能造成的。只有在民主国家与专制国家共同参与全球化游戏的情况下，民主国家老百姓喜欢左派给他们增福利却不喜欢增税，喜欢右派给他们减税却不喜欢减福利，就这么「既要马儿跑，又要马儿不吃草」，怎么能没有债务窟窿？而专制国家恰恰相反，皇上喜欢左派给他扩大权力却不喜欢追问他的责任，喜欢右派给他推卸责任却不喜欢限制他的权力。这马儿狂吃山珍海味，但说不跑就不跑（跑一步大家就得谢恩），结果是自由福利双不足，横征暴敛造成民众低消费，经济严重依赖「外需」，正好让民主国家在全球化游戏中透支我们，把他们的债务窟窿做得更大，终于出现今天的结果。&lt;/p>
&lt;p>所以&lt;mark>国人要把感恩型福利观变成问责型福利观。&lt;/mark>如果不问责，「皇恩」还是落到皇上喜欢的人手里。如果通过问责而形成福利，而这个福利是穷人有权要求的，当然就落到穷人头上了。所以穷人缺的就是这种权利。&lt;mark>在中国作为自由主义者，我们不能反对穷人的权利。我们可以反对特权者的福利，但是我们不能否认穷人的福利诉求。至少在实行宪政以前我们是不能否认的。&lt;/mark>&lt;/p>
&lt;p>至于有了宪政以后，情况就有所不同，因为宪政和非宪政最大的区别就在于前者体现了权力和责任的统一。所谓「宪政」，就是统治者和被统治者达成一个契约，我授予你多少权力，你给我提供多少责任，在这种情况下，如果我是一个自由放任论者，我就会担心政府权力过大怎么办，我就不愿意给政府授那么大的权力，因此我也就不能去要求政府给我承担太大的责任。反过来讲，如果我是个社会民主主义者，我希望政府承担很多责任，我当然就得给他多授一点权力。&lt;/p>
&lt;p>可是我们现在没有这个机制，政府的权力并非我们授予，它本来就有无限的权力，但却不承担任何责任（不是说没有任何公益，但那是「皇恩」），是不能问责的。现在我们开始有一点问责意识，但却是向下看齐，而权力却向上看齐。我们现在一讲责任就要和西方比，你看西方也在提高退休年龄（降低政府养老责任），所以我们当然也要强制性提高。其实这种责任比较本来就很虚假。西方多数国家的养老福利不只是年龄问题，更重要的是覆盖率和平等性，他们的国家养老责任基本是覆盖全体国民而且标准一致的。可是我们的国家养老责任才覆盖了多少？覆盖的又分三六九等，国家对穷人、对农民究竟承担了几分养老责任？为什么只拿年龄说事和西方比较来为政府卸责？&lt;/p>
&lt;p>但更重要的是：为什么只和西方比责任，不和西方比权力？一讲权力就说我们和西方不同，他们搞「资本主义」，讲「有限政府」，我们是「社会主义」，只讲「领导一切」，不能讲权力制衡。可是讲到责任怎么就要向西方看齐？「资本主义」无力提供的保障，「社会主义」也不能提供？如果是这样，你的「主义」优越性何在？难道就在于可以任意「拿大家」？&lt;/p>
&lt;p>他们的政府权力有限，责任自然应该有限；你的政府权力无限，责任为什么就要有限？人家的政府能像你这样不经过议会讨论随意横征暴敛？能像你这样除了征重税，还可以垄断土地搞土地财政？能有那么强大的国企垄断「与民争利」？更严重的是，西方政府的权力能大到像你这样不仅横征暴敛，而且把权力伸进老百姓的家庭，限制老百姓生孩子、用几十年的强制性独生子女政策把老百姓「养儿防老」的传统给破坏掉？权力大到可以破坏养儿防老，责任小到可以推卸政府养老，这又是什么「主义」？&lt;/p>
&lt;p>所以，现在一个最大的问题，就是我们的政府有「社会主义的权力」（其实是「超社会主义」的权力），但却只想承担「资本主义的责任」，甚至连资本主义的责任都不愿承担。而西方相反，他们的政府只有「资本主义的权力」，但是人民却要其承担「社会主义的责任」（甚至是「共产主义的责任」──福利制度是面向穷人、「按需分配」，而不是奖励劳模、「按劳分配」的）。民主制度下老百姓喜欢「既要马儿跑，又要马儿不吃草」，造成现在希腊这样的困境。可是我们的困境与他们恰好相反。我们既然面临和他们相反的问题，我们的左派和右派就不能像他们那样去提问题了。&lt;/p>
&lt;p>因此我们这两个方面都要努力：一个是限制政府权力，一个是追问政府责任。福利一定要问责的，福利不是皇恩，而是我们理当追索的政府责任。&lt;/p>
&lt;p>这里笔者要强调的是：&lt;mark>问责型福利观既是宪政条件下的正常福利观，也是非宪政条件下的人们追求宪政的一个路径。很多国家的宪政就是因为老百姓不断的问责问出来的，包括统治者接受限制权力，也是因为它承担不起老百姓的无限问责，才不得不接受权力的限制。&lt;/mark>东欧那些国家，就是因为老百姓强调你既然有无限的权力，就必须承担无限的责任，「从摇篮到坟墓」，这责任你就不准推卸。办不到你就把权力限了。&lt;/p>
&lt;p>&lt;mark>「既要马儿跑，又要马儿不吃草」作为现实目标，自由、福利都追求最高，肯定是不行的。但是在既无自由又无福利的情况下作为限权问责的要价策略，则是非常重要的。&lt;/mark>在希腊，现在最大的问题就是民主制搞了几十年、上百年以后，老百姓真的想「既要马儿跑，又要马儿不吃草」。可是当年的波兰，老百姓高明之处就是把「既要马儿跑，又要马儿不吃草」作为要价的策略。当时这个国家还没有实行民主制度，政府不是供老百姓骑的马，而是骑在人头上的马，既要吃山珍海味，而且想不跑就不跑，它跑你就得感恩，不跑你也没有办法。对这种状况，最简单的办法就是我要求你既要少吃，又要多跑，最有效的压力就是我「既要马儿跑，又要马儿不吃草」。做不到不要紧，这是一个讨价还价的压力空间，这个提法的实际意义就是要求你要跟我谈判，到底我给你吃多少，你可以给我跑多少，最终的结果就是「既要马儿跑，又要马儿不吃草」肯定做不到，但是你也不可能骑在我头上，山珍海味都吃就是不跑，&lt;mark>最终我们达成一个权责对应的契约，那就是宪政了。&lt;/mark>&lt;/p>
&lt;p>宪政条件下公众可以选择各种契约，政府建立在契约基础上。比如所谓的「多党制」其实说白了就是这么一回事，等于在权责问题上是招标的：有个人说权责对应的契约，那就是宪政了。我可以给你更多的福利，条件是你给我更多的权力；另外一个人说我福利不可能给你那么多，但是我也不需要你给我那么多权力，你可以有更多的自由。看你选哪一个吧，如果选定了哪个，就不要说什么了，就像招投标。比如你选了自由党，你就不可能向它要高福利，这本来就是它的竞选纲领，当然它也承诺不对你搞高税收。既然你选了和它立契约，你当然就得接受。如果你选了社会党呢？你当然可以提高福利问责，这也是它的竞选承诺，但是它征高税收你也得接受，是不是？立了契约的嘛。所以在波兰剧变以前，老百姓福利问责是没有边际的，剧变以后马上就有了边际。这其实和征税一样，以前英法革命都是因为国王征税老百姓不愿意造成的，实行宪政以后，由民选代表组成议会征税，其实议会征税比国王多得多，但是老百姓就愿意，这和笔者刚才讲的道理是一样的。&lt;/p>
&lt;p>注释&lt;/p>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>〈和平奖是中西方新碰撞的缩影：七位中国知名学者谈2010年诺贝尔和平奖〉，《环球时报》，2010年10月20日。&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:2">
&lt;p>〈和平奖是中西方新碰撞的缩影：七位中国知名学者谈2010年诺贝尔和平奖〉，《环球时报》，2010年10月20日。&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:3">
&lt;p>〈和平奖是中西方新碰撞的缩影：七位中国知名学者谈2010年诺贝尔和平奖〉，《环球时报》，2010年10月20日。&amp;#160;&lt;a href="#fnref:3" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:4">
&lt;p>〈和平奖是中西方新碰撞的缩影：七位中国知名学者谈2010年诺贝尔和平奖〉，《环球时报》，2010年10月20日。&amp;#160;&lt;a href="#fnref:4" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:5">
&lt;p>参见吴迪：〈独特的中国式招商标语〉（2010年2月2日），FT中文网，www.ftchinese.com/story/001031108。&amp;#160;&lt;a href="#fnref:5" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:6">
&lt;p>米勒（David Miller）、波格丹诺（Vernon Bogdanor）编，中国问题研究所、南亚发展研究中心、中国农村发展信托投资公司组织翻译：《布莱克维尔政治学百科全书》（北京：中国政法大学出版社，1992），页796-97；伊特韦尔（John Eatwell）、米尔盖特（Murray Milgate）、纽曼（Peter K. Newman）编：《新帕尔格雷夫经济学大辞典》，第四卷（北京：经济科学出版社，1992），页968；林万亿：《当代社会工作：理论与方法》（台北：五南图书公司，2002），页28-29。&amp;#160;&lt;a href="#fnref:6" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:7">
&lt;p>Henry Pelling, The Labour Governments, 1945-51 (London: Macmillan, 1984),117.&amp;#160;&lt;a href="#fnref:7" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:8">
&lt;p>Bill Jordan, Rethinking Welfare (London: Basil Blackwell, 1987), 98-100.&amp;#160;&lt;a href="#fnref:8" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:9">
&lt;p>David Edgerton, Warfare State: Britain, 1920-1970 (Cambridge; New York: Cambridge University Press, 2006).&amp;#160;&lt;a href="#fnref:9" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:10">
&lt;p>参见〈汪洋：必须破除人民幸福是党和政府恩赐的错误认识〉（2012年5月9日），中国网络电视台网站，http://news.cntv.cn/china/20120509/109464.shtml。&amp;#160;&lt;a href="#fnref:10" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:11">
&lt;p>谭嗣同：《仁学》，第三十一篇。&amp;#160;&lt;a href="#fnref:11" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:12">
&lt;p>参见〈省领导为洪灾遇难同胞默哀〉，《广州日报》，2010年9月26日，http://gzdaily.dayoo.com/html/2010-09/26/content_1141033.htm&amp;#160;&lt;a href="#fnref:12" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:13">
&lt;p>参见〈〔粤西〕灾情最新报导之三：洪灾遇难人数增至71人〉（2010年9月25日），南方网广东发展论坛，http://bbs.gd.gov.cn/thread-620312-1-1.html&amp;#160;&lt;a href="#fnref:13" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:14">
&lt;p>参见百度词条「为了六十一个阶级兄弟」，百度百科，http://baike.baidu.com/view/1367750.htm&amp;#160;&lt;a href="#fnref:14" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:15">
&lt;p>李敬斋：《跨越时空的真情》（北京：中华工商联合出版社，1997），页283-86。&amp;#160;&lt;a href="#fnref:15" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:16">
&lt;p>引自金雁、秦晖：《十年沧桑：东欧诸国的经济社会转轨与思想变迁》（上海：上海三联书店，2004），页123。&amp;#160;&lt;a href="#fnref:16" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:17">
&lt;p>“Nechceme dělat‘asijští tygři’”, Lidové Noviny (Prague), 20 October 1995.&amp;#160;&lt;a href="#fnref:17" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:18">
&lt;p>黄宗羲：《明夷待访录．原法》。&amp;#160;&lt;a href="#fnref:18" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:19">
&lt;p>马克思（Karl Marx）：〈政治经济学批判（1857-1858年草稿）〉，载中共中央马克思恩格斯列宁斯大林著作编译局译：《马克思恩格斯全集》，中文第一版，第四十六卷，上册（北京：人民出版社），页105。&amp;#160;&lt;a href="#fnref:19" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:20">
&lt;p>王绍光：〈更多地在一次分配上下功夫〉，《人民论坛》，2011年第22期，页33。&amp;#160;&lt;a href="#fnref:20" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:21">
&lt;p>姚先国：《两极分化：福音还是灾难？》（北京：学苑出版社；天津：天津新华书店，1989），页38-39。&amp;#160;&lt;a href="#fnref:21" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:22">
&lt;p>姜锡梅：〈统筹城乡生事业发展——以江苏省为例〉，载中国（海南）改革发展研究院编：《民生之路：惠及13亿人的基本公共服务》（北京：中国经济出版社，2008），页289-95。&amp;#160;&lt;a href="#fnref:22" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:23">
&lt;p>Haroon Bhorat and Ravi Kanbur,“Introduction: Poverty and Well-being in Post-Apartheid South Africa”, in Poverty and Policy in Post-Apartheid South Africa, ed. Haroon Bhorat and Ravi Kanbur (Cape Town: Human Sciences Research Council, 2006), 1-17.&amp;#160;&lt;a href="#fnref:23" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:24">
&lt;p>Walter I. Trattner, From Poor Law to Welfare State: A History of Social Welfare in America (New York: Free Press; London: Collier Macmillan, 1989), 165.&amp;#160;&lt;a href="#fnref:24" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:25">
&lt;p>丁建定、杨凤娟：《英国社会保障制度的发展》（北京：中国劳动社会保障出版社，2004），页7-8；30-32。&amp;#160;&lt;a href="#fnref:25" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:26">
&lt;p>丁建定、杨凤娟：《英国社会保障制度的发展》（北京：中国劳动社会保障出版社，2004），页7-8；30-32。&amp;#160;&lt;a href="#fnref:26" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:27">
&lt;p>和春雷等：《当代德国社会保障制度》（北京：法律出版社，2001），页54-55。&amp;#160;&lt;a href="#fnref:27" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:28">
&lt;p>《汉书》，卷二十四下，〈食货志〉。&amp;#160;&lt;a href="#fnref:28" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:29">
&lt;p>《河南通志》（康熙），卷四十六。&amp;#160;&lt;a href="#fnref:29" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:30">
&lt;p>《汉书》，卷二十四下，〈食货志〉。&amp;#160;&lt;a href="#fnref:30" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:31">
&lt;p>吴宽：《匏翁家藏集》，卷五八，〈莫处士传〉。&amp;#160;&lt;a href="#fnref:31" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;li id="fn:32">
&lt;p>参见马克思（Karl Marx）：〈道德化的批评和批评化的道德〉，载《马克斯恩格斯全集》，中文第一版，第四卷，页330。&amp;#160;&lt;a href="#fnref:32" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>中国语境下的大撕裂</title><link>https://cld4h.github.io/blog/zh-cn/p/%E4%B8%AD%E5%9B%BD%E8%AF%AD%E5%A2%83%E4%B8%8B%E7%9A%84%E5%A4%A7%E6%92%95%E8%A3%82/</link><pubDate>Thu, 03 Mar 2022 10:08:00 +0800</pubDate><guid>https://cld4h.github.io/blog/zh-cn/p/%E4%B8%AD%E5%9B%BD%E8%AF%AD%E5%A2%83%E4%B8%8B%E7%9A%84%E5%A4%A7%E6%92%95%E8%A3%82/</guid><description>&lt;img src="https://cld4h.github.io/blog/hwf.jpg" alt="Featured image of post 中国语境下的大撕裂" />&lt;p>【编者按：本文首发台湾《思想》杂志，2021年第4期。贺卫方，北京大学法学教授，全国外国法制史学会副会长。研究和教学领域包括法理学、法制史以及比较法学等。主要著作和译作包括《法边余墨》（2015三版）、《逍遥法外》（2013）、《石河子劄记》（2016）、《我们法律人》（2019）等。】&lt;/p>
&lt;p>把全世界都搅得沸沸扬扬的美国大选终于尘埃落定，拜登宣誓就职，竭尽全力谋求连任的特朗普——又名川普，这个姓氏的翻译很麻烦，容我用中国大陆通译——黯然离开首都华盛顿。回顾这一段时间里网上的各种争论和撕裂，一时间竟有点不知从何说起的感觉。&lt;/p>
&lt;p>有好事者曾以对特朗普的态度为标准，将中国知识界分为「挺川」和「黑川」两大阵营，虽然我在选战期间发表言论并不多，但还是被明确地划分到「黑川」行列。当然，这对我而言并不冤枉，因为在为数不多的发言中，自己已经明确表达了特别希望民主党能够赢得本次选举的期盼。而且，我对于特朗普的负面印象可谓由来已久。早在2017年1月20日特朗普就职典礼的当天，我就在自己的微信朋友圈里写下了这样的短评：&lt;/p>
&lt;p>晚上看了CNN特朗普就职典礼全程直播，坦率地说，这是一位令人失望的人物。他张扬而自卑，肢体语言显得缺乏教养，表情上甚至有一种厌恶所有这一切的神态。直到他宣誓之前，我都担心他是否会突然站起来拂袖而去。副总统Pence以及身边人们的任务仿佛是在全力劝说他：「求求你，配合一下吧，很快就结束了。」至于演讲的内容，也真是乏善可陈，充斥著空头承诺、民粹动员、封闭幻想，是我看过的美国总统就职演讲里最黯淡无光的一个。我很怀疑他能否完成自己的四年任期。&lt;/p>
&lt;p>这则言论在最近的讨论中被挺川人士截频展示出来，作为罪证。有趣的是，即便是在我多达五千关注者的朋友圈里，当时的这则评论并没有受到多少批评性回应，反而是大多都是赞成的留言。现在想来，在当时中国政府的观察中，与特朗普打擂台竞选的民主党候选人克林顿在她国务卿任职以及竞选期间表现出对中国的强硬立场已是昭然若揭，反而作为商人和所谓「政治素人」的特朗普，却令人产生一种无事不可能（nothing is impossible）的可交易想像。所以，当时的知识界和其他民间人士，内心里希望克林顿当选者更多也未可知。&lt;/p>
&lt;p>四年的时间过去了，特朗普在中国朝野两方面的印象已经发生了很大的逆转。由于美国政府对中国在贸易平衡、南海主权、香港、台湾以及新疆等一系列问题上都采取了激烈的对抗立场，捕获了越来越多的中国人的欢心。这些「苦秦久矣」的人们是多么喜欢这位对于中共及中国政府下得狠手的美国总统，多么希望他能够再来四年；相应的，他们对特朗普的竞争者民主党及其候选人拜登就不免百般诋毁，怒其必争了。美国华人尤其是法轮功系统的媒体，那可真叫：一片花心唱川谱（普），漫天骤雨浇拜灯（登），反差何其极端！&lt;/p>
&lt;p>这场由美国大选引发的争端和撕裂是如此激烈而惨重，以往为中国的自由、宪政以及人权而并肩抗争的同道们竟分作泾渭分明的两派，这是半个世纪以来最严重的裂变。不独此也，粗略观察，过去认为属于自由派知识分子的阵营中，居然是「挺川派」占据了多数。不久前，一群挺川学者还专门推出名为《川普主义》（副标题：保守传统价值 重塑美利坚荣耀）的出版物，以为其自命的「保守主义者」的舆论阵地，成群结队，声势不小。&lt;/p>
&lt;p>这里，不妨结合相关争论的三个焦点，把自己的一些观点加以阐述或重申，当然也是一种反思。&lt;/p>
&lt;ol>
&lt;li>于美国的两党政治。西方近代型政党制度从起源之日开始，便是不同利益的组合和竞争。特定政党维护本党所代表的利益，同时也承认其他政党存在的正当性，并在竞争中寻求妥协。因为只是作为局部利益的代言人，所以英文里使用了以part为词根的party一词指称政党。这样的政党理念也伴随著美国立国以后的整个历史。最初是偏于维护联邦与偏于维护州权及公民个人权利的两个政党之间的斗争。在过去超过一个半世纪里，进入到现代两党制度的稳定期，两党之间逐渐形成了对于一些重大社会政策性相对确定的分歧，诸如税收倾向、政府角色、平权运动、堕胎权利、移民政策之类。在分歧之外，两党在诸如民主政治、私有财产保护、司法独立、新闻自由等更重大的价值方面却有著深刻而广泛的共识，二者之间正是在这种既有共识也有冲突的过程中推进著社会稳定地前行。&lt;/li>
&lt;/ol>
&lt;p>但是在中文媒体所出现的这场争论中，一些支持特朗普的人们却把共和党和民主党之争说成正义与邪恶之间的战争，尤其是抓住某些极端主张，以偏概全，抹黑整个民主党。另一方面，又把共和党神圣化，甚至肉麻地把特朗普说成是「天选之子」，一个世俗总统俨然变成拯救美国甚至世界的救星，真是对这些言必称民主者的大讽刺，就基督徒而言，这种对于一个活人的崇拜更是一个大讽刺。&lt;/p>
&lt;p>中文网上那么多对于美国左派的攻讦跟中国人的经验有关，那就是，一听到左派，就把它想像为中国语境下的左派。我在回应一位力挺特朗普的朋友时说：&lt;/p>
&lt;p>在一个健全的西方民主、宪政、法治体制下，在资本主义的正轨中，保守派和自由派形成了相互平衡的两翼，在距离马克思很久之前英国就有辉格党，也有托利党，在美国有共和党也有民主党，这真正如鸟之两翼，车之两轮，缺一不可。钟摆效应下，社会的各个领域都会周期性的有所调整。但是，近年来国内颇有一些学者把希望全部寄托在西方保守主义的一端，又把西方左派等同于马克思左派，对前者赞美不已，对后者不屑一顾，这分明是把杭州当汴州，扭曲了西方左右的真实谱系，也难以对中国起到对症下药的效果。中国缺乏西方的右派，也缺乏西方的左派。毛泽东曾说他喜欢跟共和党交往，也不是偶然。我曾到费城参观宪政纪念馆，其中有个测试器，让你选择各种问题，例如税收、堕胎、持枪、联邦与州关系等等，我测试的结果，居然是稍微偏向于民主党的。我这个中国右派，到了美国，居然迷失了政治方向！&lt;/p>
&lt;p>但是，那位朋友在回应中仍然表达对于西方左派的极度反感，回复我说：&lt;/p>
&lt;p>作为灯塔国的美国，已经建立的联邦共和体制也并非确保无虞，极权主义如同病毒一般会在政权和社会中长期存在，因其诉诸于人性固有的恶。西方左派长期以来在政治正确上已经走得太远，在大学、媒体中成为绝对主流，甚至不许别人表达异议……在这种情势下，平分秋色、势均力敌是无法达到的。西方社会的颓势和许多危机与此有关。中国左派当然更加不堪，抱权力粗腿玩得风生水起，但有一点他们在意识形态层面与西方左派是相通的——主张社会主义，否定市场经济，批判资本主义，抱紧马克思主义等。&lt;/p>
&lt;p>这样的回复表明了就是要把西方左派等同于社会主义，这是太强烈的偏见，也是对民主党主张的严重扭曲。尽管难以说服，我还是作了进一步的回应：&lt;/p>
&lt;p>其实，美国的情况并不像您所忧虑的那样，似乎马克思左派在大行其道。桑德斯最近在民主党初选中的遭遇表明，民主党的主流并不接受那种太靠近社会主义的极左主张，拜登就代表著一种稳健持中的左派观念。从美国过去这半个多世纪的政治走势看，也没有出现一派独大的情况，民主党、共和党之间的交替还是有著比较平衡的步调的。1920-30年代，美国尚且没有走向社会主义，在苏俄阵营解体、冷战结束之后的今天，主流美国人更不会容许美国「接过列宁的旗帜」，这一点真的无需担忧。……从福利国家的角度看，美国是西方世界最不福利的，比欧洲尤其是北欧国家差距甚远。精英大学和主流媒体里左派似乎占据了主导地位（历史上一直如此），但还有非精英大学和Fox News呢。有意思的是，例如哈佛法学院的教授们偏左，但法学院的毕业生却未必那么整体地偏向左派，右翼精英——例如现任国务卿蓬佩奥——也在所多有。您说如今右派难以平分秋色、势均力敌，但是上次大选选票计算结果不是证明从全国范围内看，双方之间差距甚微么？况且如今参议院在共和党手中，最高法院大法官中保守派占据多数，您放心，两派还是比较平衡的。对了，我私心希望下次总统选举，民主党能够胜出，主要考虑到最高法院的构成，现在保守派太多了。如果特朗普再干一届，估计那位女大法官金斯伯格绝对熬不过去了。&lt;/p>
&lt;p>我一语成谶，上文是2020年5月写的，金斯伯格大法官连特朗普的一届任期都没有熬过去，9月18日就病逝了，特朗普得以提名并任命保守派联邦法官巴瑞特为新晋大法官。能够在一个任期里任命三位联邦最高法院大法官，也成为特朗普为美国保守派作出的最重要的政治贡献之一。好在这几位保守派大法官在此后涉及到大选的诉讼中表现出的并不是唯特朗普马首是瞻，而是卓越的专业和独立风范。&lt;/p>
&lt;ol start="2">
&lt;li>基督教与美国宪政。在这次争论中，中国的一些基督徒以及似乎皈依了基督教的学者因为特朗普不断地宣称自己的基督教福音派信仰而欢欣鼓舞，进而对其排斥穆斯林等非基督教国家移民的主张赞赏有加，并且表现出一种强烈的信念，即美利坚合众国的宪政以及保守主义哲学的根基正在于基督教新教的信仰，不仅如此，对于其他国家而言，也只有确立了这种基督教信仰，才可能建立宪政体系。这一点，在前面提到的那本书《川普主义》的作者群里，俨然变成一种共识。&lt;/li>
&lt;/ol>
&lt;p>从大学三年级开始，我个人关注基督教及其与西方法治关系的历史已经四十年，自己的本科和硕士学位论文的主题都是中世纪教会法及其对世俗法的影响。我当然知道，欧洲的宪政体制与基督教（包括天主教）之间所具有的深刻关联。例如，中世纪欧洲流行的教会权力与世俗权力之间的两分乃是近代宪政分权体制的历史渊源之一，同时也正是这种强调「上帝的归上帝，凯撒的归凯撒」的传统成为近代宪政中政教分离的源头活水。对于美国的立宪国父们而言，他们之所以要通过宪法第一修正案规定不得确立国教的准则，也是因为他们看到了在欧洲以及北美殖民地时代的宗教迫害，因而对世俗权力与宗教信仰结合在一起所产生的危害有极大的忧虑。&lt;/p>
&lt;p>至于说到美国宪政体制，尤其是权力分立、联邦制以及宪法所确立的各种维护自由与人权的准则，有些属于国父们的天才创造，更多的则是悠久的西方文明演进成果，基督教只是宪法的渊源之一。其他重要的根基要素包括前基督教时代的希腊政治哲学、罗马法，以及英国法律史上所逐渐形成的司法独立和法律职业化等等。虽然由于大法官具有僧侣身份，英国的衡平法渗透了一些教会法的立法和原则，但整体而言，美国所继承的英国法中仍然以世俗的成分为主导。约翰．亚当斯（John Adams）说得最真切：「让我们研究自然法，研究英国宪法的精神，阅读远古时代的历史，思考希腊和罗马的伟大范例，追思我们自己不列颠祖先的行为，他们为捍卫我们人类与生俱来的权利抵抗外来的以及内部的暴君及篡权者。」&lt;/p>
&lt;p>不仅如此，在美国的种族以及文化越来越多元化的今天，作为一部适用于如此繁杂移民组成国度的宪法，必须具有超越基督教的包容性。在过去的一个多世纪里，作为自由乐土的新大陆成为世界各地人们的向往之地，纽约港前面的自由女神像见证了多少不同信仰和肤色的人们进入这个国度，他们有南美洲或爱尔兰的天主教徒、受纳粹迫害的犹太人、印度或印尼的穆斯林、中国或越南的佛教徒或无神论者，凡此种种，他们中的许多取得了美国的公民身份，却无须改变自己的信仰。这些移民的子女中，甘迺迪、奥巴马成了美国总统，布兰代斯（Louis D. Brandeis）成为第一位犹太裔大法官（金斯伯格是首位女性犹太裔大法官），国会议员、联邦法官、行政当局高官中各种族裔缤纷多彩，如今的美国，谁敢公然宣称WASP（即白人—盎格鲁—撒克逊—新教徒）才是主流？&lt;/p>
&lt;p>还有，在20世纪，一些基督教并不占信仰主流甚至很少基督徒的国家里也建立起运行良好的宪政和法治体制，日本就是一个绝好的例证。尽管麦克亚瑟主导的现行日本宪法具有美国宪法相当的影响，但是，一方面，这种影响的内容本身并非与基督教信仰相关联，另一方面，支撑当代日本宪政的根基观念也并非完全是西方舶来品，更有前明治时代超过七个世纪中所形成的「统」「治」分离以及幕藩体制下的地方自治传统。另外，台湾在过去三十多年里从威权向民主体制的成功转型也是另一个鲜活的证明。无视西方宪政跟基督教信仰及教会之间的关联固然不符合历史，但夸大宗教的作用，却足以导致一个令人绝望的结论：中国的宪政梦必将是「此恨绵绵无绝期」。&lt;/p>
&lt;ol start="3">
&lt;li>中美关系恶化：原因与未来。在中美关系方面，特朗普时代意味著过去延续超过四十年那种接触、拥抱以期改变的政策的终结。无论是行政当局，还是参众两院，都不断地推出各种强硬举措，步步紧逼，令中国当局穷于应付，难以招架。中美关系如此断崖式的恶化不禁让许多追求中国政治转型而不断受挫的国人感到欢欣鼓舞，他们非常期盼这样的打击能够延续下去，而且不断加大，并且很自然地担心一旦特朗普不能连任，在他任期里已经风生水起的这番大事业将前功尽弃，一切又回到此前的那种混沌无望的情形。&lt;/li>
&lt;/ol>
&lt;p>全面评价近年来中美关系恶化的效果超出了本文的范围，这里只是指出一个吊诡的事实：随著特朗普时代美国政府对中国打击力度的加大，在中国内部所发生的却是人权状况的持续恶化。修改宪法取消国家主席的任期限制，建立一个地位超越并压制司法权的监察委员会，对国内活跃律师群体的更为严厉打压，执政党对民间组织和企业控制的强化，教育以及新闻领域严重倒退，对于全民实施无孔不入的数位化监控，港版国安法的出台，新疆等地发生的针对穆斯林的行动，凡此种种，可谓罄竹难书。&lt;/p>
&lt;p>当然，所有这些不能归咎于特朗普以及美国政府，毋宁说是中国内在逻辑的一种展示。也可以说，导致美国政府对华政策逆转最关键的推动者，不是美国方面，而是中国当局。包括美国在内的西方国家长期奉行的类似「怀柔羁縻」的策略完全失效，转而使用大棒甚至炮舰也就成为必然。一个根本性的困难在于，怀柔也好，大棒也罢，当一国内部没有形成一种足以制衡威权的体制性的（institutional）以及社会化的力量，外来压力所带来的经常是一种反向效果。尤其是对象国体量远远超过如伊朗、朝鲜的情况下，指望外部的种种制裁和号召就能引发国内的变革就更是一厢情愿了。&lt;/p>
&lt;p>另一方面，多少可以安抚中国的那些特朗普拥趸的是，拜登上任后，虽然推翻了特朗普在内政外交方面的许多政令，但是涉及中国的各种施压政策却得到了延续。新任国务卿以及国家安全顾问、防长等都表达了维持对华强硬路线的明确态度。而且，与特朗普不一样的是，拜登当局更强调在对华政策方面与欧洲以及传统盟国之间的协调作业，同时又注重制裁中国的时候以「手术刀」而非「大砍刀」所带来的更为精确的打击。这样的延续与调整并重的战略与策略前景如何当然还有待观察，至少可以让中国党政当局不必再抱某种不切实际的幻想。&lt;/p>
&lt;p>剩下的，就看我们中国人自己的了。孟子说得对：「夫人必自侮，然后人侮之；家必自毁，而后人毁之；国必自伐，而后人伐之。」反过来的道理是，国必自救，而后人救之。&lt;/p></description></item><item><title>中文电子书籍资源</title><link>https://cld4h.github.io/blog/zh-cn/p/%E4%B8%AD%E6%96%87%E7%94%B5%E5%AD%90%E4%B9%A6%E7%B1%8D%E8%B5%84%E6%BA%90/</link><pubDate>Wed, 02 Mar 2022 14:25:21 +0800</pubDate><guid>https://cld4h.github.io/blog/zh-cn/p/%E4%B8%AD%E6%96%87%E7%94%B5%E5%AD%90%E4%B9%A6%E7%B1%8D%E8%B5%84%E6%BA%90/</guid><description>&lt;img src="https://cld4h.github.io/blog/book.jpg" alt="Featured image of post 中文电子书籍资源" />&lt;mark>
本文仅整理了一些中文电子书籍资源获取方式，来源于library genesis论坛中的一个帖子。
我并不完全推荐其中的全部内容，尤其是涉及微信、xx网盘等非自由网络服务的内容。
&lt;/mark>
&lt;h2 id="好读">好读
&lt;/h2>&lt;p>&lt;a class="link" href="http://www.haodoo.net/" target="_blank" rel="noopener"
>好读&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>好讀網站是推廣中文電子書的公益網站，是不約而來的一群讀友，為自己也為大家，從2001年建站迄今不斷努力不斷貢獻的成果。好讀網站免費提供您的是：&lt;/p>
&lt;ol>
&lt;li>好讀中文直式閱讀軟體&lt;/li>
&lt;li>好讀製書程式 mPDB&lt;/li>
&lt;li>好讀書櫃﹙整理校正過的好書﹚&lt;/li>
&lt;/ol>
&lt;p>註：整理校正過的書還是會有失誤，要靠讀友經年累月的指正勘誤，品質才能越來越好。&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://cld4h.github.io/blog/haodoo-web.png"
loading="lazy"
alt="好读 网页"
>&lt;/p>
&lt;h2 id="中国哲学书电子化计划">中国哲学书电子化计划
&lt;/h2>&lt;p>&lt;a class="link" href="https://ctext.org/zhs" target="_blank" rel="noopener"
>中国哲学书电子化计划&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>中国哲学书电子化计划是一个线上开放电子图书馆，为中外学者提供中国历代传世文献，力图超越印刷媒体限制，通过电子科技探索新方式与古代文献进行沟通。收藏的文本已超过三万部著作，并有五十亿字之多，故为历代中文文献资料库最大者。&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://cld4h.github.io/blog/ctext-web.png"
loading="lazy"
alt="中国哲学书电子化计划 网页"
>&lt;/p>
&lt;h2 id="三秋书屋">三秋书屋
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.sanqiu.cc/" target="_blank" rel="noopener"
>三秋书屋&lt;/a> 提供各类epub+mobi+azw3电子书的网盘下载链接&lt;/p>
&lt;p>支持阿里云盘+天翼云盘+城通网盘下载链接&lt;/p>
&lt;p>&lt;img src="https://cld4h.github.io/blog/sanqiu-web.png"
loading="lazy"
alt="三秋书屋 网页"
>&lt;/p>
&lt;p>&lt;img src="https://cld4h.github.io/blog/sanqiu.jpg"
loading="lazy"
alt="公众号"
>&lt;/p>
&lt;h2 id="so-read">So Read
&lt;/h2>&lt;p>&lt;a class="link" href="https://sobooks.cc/" target="_blank" rel="noopener"
>So Read&lt;/a>&lt;/p>
&lt;p>epub格式电子书&lt;/p>
&lt;p>支持蓝奏网盘+城通网盘+备份网盘下载链接&lt;/p>
&lt;p>需要关注公众号获取「暗号」下载&lt;/p>
&lt;p>&lt;img src="https://cld4h.github.io/blog/soread-web.png"
loading="lazy"
alt="So Read 网页"
>&lt;/p>
&lt;p>&lt;img src="https://sobooks.cc/qrcode/gzh.jpg"
loading="lazy"
alt="公众号"
>&lt;/p>
&lt;h2 id="其他资源和工具等">其他资源和工具等
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.jiumodiary.com/" target="_blank" rel="noopener"
>鸠摩搜索&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://cnkgraph.com/Book" target="_blank" rel="noopener"
>古籍知识图谱检索&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://bookfere.com/" target="_blank" rel="noopener"
>书伴&amp;ndash;kindle使用技巧(不提供资源下载)&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://www.pkulaw.cn/" target="_blank" rel="noopener"
>北大法宝&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://cn.imslp.org/wiki/Main_Page" target="_blank" rel="noopener"
>国际乐谱库&lt;/a>&lt;/p>
&lt;h2 id="附原帖中全部链接">附原帖中全部链接
&lt;/h2>&lt;p>&lt;a class="link" href="http://www.iamtxt.com/e/member/login/log.html" target="_blank" rel="noopener"
>http://www.iamtxt.com/e/member/login/log.html&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://ebooks.lib.ntu.edu.tw/Home/ListBooks" target="_blank" rel="noopener"
>http://ebooks.lib.ntu.edu.tw/Home/ListBooks&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://cn.imslp.org/wiki/Main_Page" target="_blank" rel="noopener"
>https://cn.imslp.org/wiki/Main_Page&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://sou-yun.cn/eBookIndex.aspx" target="_blank" rel="noopener"
>https://sou-yun.cn/eBookIndex.aspx&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://bbs.gxsd.com.cn/forum.php" target="_blank" rel="noopener"
>http://bbs.gxsd.com.cn/forum.php&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.ituring.com.cn/book" target="_blank" rel="noopener"
>https://www.ituring.com.cn/book&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://ishare.iask.sina.com.cn/" target="_blank" rel="noopener"
>http://ishare.iask.sina.com.cn/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://ebook.lorefree.com/" target="_blank" rel="noopener"
>https://ebook.lorefree.com/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://cn.epubee.com/books/" target="_blank" rel="noopener"
>http://cn.epubee.com/books/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.xiaobaipan.com/" target="_blank" rel="noopener"
>https://www.xiaobaipan.com/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://forum.readfree.me/" target="_blank" rel="noopener"
>https://forum.readfree.me/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://bookfere.com/ebook" target="_blank" rel="noopener"
>https://bookfere.com/ebook&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://book.shuyuzhe.com/" target="_blank" rel="noopener"
>https://book.shuyuzhe.com/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://www.ireadweek.com/" target="_blank" rel="noopener"
>http://www.ireadweek.com/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://book.mybanshu.win/" target="_blank" rel="noopener"
>http://book.mybanshu.win/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://book.chaoxing.com/" target="_blank" rel="noopener"
>http://book.chaoxing.com/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://www.rufengso.net/" target="_blank" rel="noopener"
>http://www.rufengso.net/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.owllook.net/" target="_blank" rel="noopener"
>https://www.owllook.net/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.soepub.com/" target="_blank" rel="noopener"
>https://www.soepub.com/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.zqbook.top/" target="_blank" rel="noopener"
>https://www.zqbook.top/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.kgbook.com/" target="_blank" rel="noopener"
>https://www.kgbook.com/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://www.book118.com/" target="_blank" rel="noopener"
>http://www.book118.com/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://www.guoxue.com/" target="_blank" rel="noopener"
>http://www.guoxue.com/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://bestcbooks.com/" target="_blank" rel="noopener"
>http://bestcbooks.com/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://www.pdfbook.cn/" target="_blank" rel="noopener"
>http://www.pdfbook.cn/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.cn-ki.net/" target="_blank" rel="noopener"
>https://www.cn-ki.net/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://www.pkulaw.cn/" target="_blank" rel="noopener"
>http://www.pkulaw.cn/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://ctext.org/zhs" target="_blank" rel="noopener"
>https://ctext.org/zhs&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://ctext.org/zhs" target="_blank" rel="noopener"
>https://ctext.org/zhs&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://ebookbb.com/" target="_blank" rel="noopener"
>https://ebookbb.com/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://www.iread.cf/" target="_blank" rel="noopener"
>http://www.iread.cf/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://sobooks.cc/" target="_blank" rel="noopener"
>https://sobooks.cc/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.d4j.cn/" target="_blank" rel="noopener"
>https://www.d4j.cn/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://haodoo.net/" target="_blank" rel="noopener"
>http://haodoo.net/&lt;/a>&lt;/p></description></item><item><title>尝试去理解我爸</title><link>https://cld4h.github.io/blog/zh-cn/p/%E5%B0%9D%E8%AF%95%E5%8E%BB%E7%90%86%E8%A7%A3%E6%88%91%E7%88%B8/</link><pubDate>Tue, 22 Feb 2022 09:20:15 +0800</pubDate><guid>https://cld4h.github.io/blog/zh-cn/p/%E5%B0%9D%E8%AF%95%E5%8E%BB%E7%90%86%E8%A7%A3%E6%88%91%E7%88%B8/</guid><description>&lt;img src="https://cld4h.github.io/blog/smoking-ban.png" alt="Featured image of post 尝试去理解我爸" />&lt;p>在讲故事之前，有一个背景需要交代清楚：因为意识形态的不同，我和我爸已经很难去讨论一个问题了。
我想要和他探讨些什么，但往往结局是我爸用他那大大的嗓门、用对待阶级敌人的语气呵斥我，
这种时候，我感觉好像痛失了一个亲人，悲从中来，泣不成声。&lt;/p>
&lt;p>其实讲白一点，我感觉我爸从来也不想知道更不好奇自己的孩子有哪些想法，以及为什么会产生这些想法。
他需要我做的只是恭听他的训教罢了。&lt;/p>
&lt;p>（但是我还是想试图和他沟通，于是有了下面的故事）&lt;/p>
&lt;p>昨天晚上和我爸出去散步，路遇有人抽烟，我们两个都很厌恶抽烟的，于是就开始了讨论。&lt;/p>
&lt;p>我认为中国禁烟遥遥无期，因为我国政府本身&lt;strong>就是&lt;/strong>烟草企业：政府亲自向自己的国民推销烟草；而控烟的具体工作却推给了类似「北京市控制吸烟协会」这类的NGO。&lt;/p>
&lt;p>比如，「无烟北京」，也就是「北京市控制吸烟协会」才是事实上北京市的控烟组织（那个什么爱国卫生运动委员会根本是摆设，里面甚至还有烟草局的人），但它能做的也只是开一个吸烟投诉的平台、运行公众号、定期组织志愿者宣传一下而已。&lt;/p>
&lt;p>鉴于中国青少年的吸烟率这20年来一直在上升（&lt;a class="link" href="https://web.archive.org/web/20220222015843/http://zqb.cyol.com/html/2019-11/22/nw.D110000zgqnb_20191122_4-07.htm" target="_blank" rel="noopener"
>中青报&lt;/a>，&lt;a class="link" href="https://web.archive.org/web/20200529070318/https://www.chinacdc.cn/gwxx/201811/t20181121_197428.html" target="_blank" rel="noopener"
>中国疾控中心&lt;/a>），我对中国控烟持悲观态度。&lt;/p>
&lt;p>当然，我爸不是这么认为的，他认为「总会慢慢变好的」。&lt;/p>
&lt;p>（可能就像我们家角落里的油污一样，不用擦，慢慢地就变好了）&lt;/p>
&lt;p>他跟我举了德国的例子，大概二十年前左右他去德国时，公共场所还有人在抽烟，后来在一些公共场所设立了吸烟区，只能在吸烟区抽烟，再后来公共场所就全面禁烟了。我爸重点在与强调过程是一点点循序渐进的，「总会慢慢变好的」。他不排斥从德国借鉴，但他认为德国之所以控烟不错是因为德国比我们发展得早，所以我们以后也会变好，只是时间问题，不能着急。&lt;/p>
&lt;p>之后我表达了对新西兰立法禁止任何法律生效时低于14岁的新西兰人终身购买烟草制品的赞许和羡慕，
我觉得中国虽然不可能也这么做，但可以先在一些地方（尤其是所谓的「文明城区」）先搞一搞试点。
于是我爸开始说我「极端」。&lt;/p>
&lt;p>这时就要注意了：我爸说的是 &lt;strong>我&lt;/strong> 极端，并不是说 &lt;strong>新西兰这项严格的控烟立法&lt;/strong> 极端，针对的并不是 &lt;strong>立法禁烟这件事&lt;/strong> 本身，
而是 &lt;strong>我这个人&lt;/strong> 以及我看待事物的角度（不够全面）。&lt;/p>
&lt;p>而此时我错误地理解了「极端」所指的对象，以为我爸不认同新西兰这项立法，于是提出疑问：「你不认同新西兰这项立法吗？」&lt;/p>
&lt;p>然后就捅马蜂窝了。&lt;/p>
&lt;p>我爸开始急赤白脸地呵斥我，说我将自己的观点强加给他、给他扣帽子、跟我说话很费劲等等一大堆。&lt;/p>
&lt;p>此时我完全插不上话，只有听呵的份。&lt;/p>
&lt;p>我不死心于就事论事的讨论就此终结，于是赶忙跟他赔礼，说我完全没有强加观点给他的意思，
只是想询问清楚他对于新西兰这项立法本身的态度。&lt;/p>
&lt;p>他说，他没有态度，既没有支持也没有反对。他不是新西兰人，没去过新西兰，也不了解新西兰，所以不能支持也不能反对。&lt;/p>
&lt;p>于是我才开始询问之前他说的「极端」从何而来。&lt;/p>
&lt;p>他说，就像机器生产零件总会有次品一样，总会有人要抽烟，严格立法禁止吸烟后如何执法是个问题。&lt;/p>
&lt;p>他说，立法禁止抽烟之后「你们」又会说侵犯人权和自由。&lt;/p>
&lt;p>然后他神来一笔，举了加拿大卡车司机示威和美国关塔那摩监狱的例子，说（西方政客和媒体）双重标准，说人不能双标。&lt;/p>
&lt;p>他说，抽烟的人不是教育就能够起作用的，立法完全禁止抽烟并不能解决问题，就像有法律在还会有人犯罪一样。&lt;/p>
&lt;p>我说不能因为有人会违法就说立法没用呀，于是又捅马蜂窝了，我爸又说我给他强加一个观点，我又是一通道歉。&lt;/p>
&lt;p>关于「自由」以及「双标」的话题以后有机会我会专门再写，这个对于我爸太敏感，
连反对吸烟这件我们都认同的事都能吵成这样，我也不抱希望能和我爸讨论这个。&lt;/p>
&lt;p>其实我爸说了一大堆，但又什么也没说。我的感觉他对于新西兰这项严格控烟立法的态度是消极的，
而且如果有人建议在中国也这么试点搞一搞，他大概也不会感到振奋。&lt;/p>
&lt;p>他最后又教育我，要全面地考虑问题：「换做是你，你怎么做」「你坐在那个位置上你行吗」&lt;/p>
&lt;p>&amp;hellip;&amp;hellip;&lt;/p>
&lt;p>我是没有站在统治者角度思考问题的习惯，我更愿意实际一点，先做好一个公民。&lt;/p></description></item><item><title>不用微信</title><link>https://cld4h.github.io/blog/zh-cn/p/%E4%B8%8D%E7%94%A8%E5%BE%AE%E4%BF%A1/</link><pubDate>Wed, 16 Feb 2022 21:29:37 +0800</pubDate><guid>https://cld4h.github.io/blog/zh-cn/p/%E4%B8%8D%E7%94%A8%E5%BE%AE%E4%BF%A1/</guid><description>&lt;img src="https://cld4h.github.io/blog/wx404.png" alt="Featured image of post 不用微信" />&lt;h2 id="微信不是自由软件">微信不是自由软件
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.gnu.org/philosophy/" target="_blank" rel="noopener"
>自由软件&lt;/a>意味着其用户拥有自由（这无关价格）。&lt;/p>
&lt;p>具体而言，包括四大自由：&lt;/p>
&lt;ol start="0">
&lt;li>自由运行软件&lt;/li>
&lt;li>自由学习和修改软件源代码&lt;/li>
&lt;li>自由再发布软件拷贝&lt;/li>
&lt;li>自由发布修改后的软件版本。&lt;/li>
&lt;/ol>
&lt;p>显然，对于微信的客户端程序来说，用户不具备这四大自由中的任何一项。&lt;/p>
&lt;p>这里着重要说一下自由之〇，用户并不能够自由运行微信的客户端程序：&lt;/p>
&lt;p>比如，北京大学法学院教授贺卫方先生六度遭遇封号，注册二十几天的微信号“宁海舟”(old-crane)显示无法正常登录，且又是永久封号。&lt;/p>
&lt;p>&lt;img src="https://cld4h.github.io/blog/hwf.jpg"
loading="lazy"
alt="贺卫方控诉腾讯肆意封号书"
>&lt;/p>
&lt;p>微信离要求最低的自由之〇尚且差距甚远；更不必奢望其具有自由之一、二、三。&lt;/p>
&lt;p>四大自由并不是无理的要求。因为只有满足了四大自由，用户才有可能掌控程序；否则，用户只可能被程序所掌控。&lt;/p>
&lt;p>关于为什么要使用自由软件，Richard Stallman在&lt;a class="link" href="https://www.gnu.org/philosophy/free-software-even-more-important.html" target="_blank" rel="noopener"
>这篇文章&lt;/a>中已经阐述得十分详尽了。可以说微信几乎具有&lt;a class="link" href="https://www.gnu.org/proprietary/" target="_blank" rel="noopener"
>专有软件所能具有的全部恶意功能&lt;/a>。&lt;/p>
&lt;p>比如，微信官方宣称它们不会查看用户的聊天内容。这就是个天大的笑话！&lt;/p>
&lt;p>微信中内置有后门审查用户发送的链接。当然，微信宣称是为了用户的「安全」。
（嗯。对腾讯而言，淘宝、今日头条的链接算得上是「有害内容」啦，的确不「安全」🤔）&lt;/p>
&lt;p>而且，会被审查的消息可不只是用户发到微信后台服务器的内容：微信的审查系统是做在APP本地的。
&lt;del>如果你发送以&lt;code>https://youtube.com&lt;/code>开头的链接，
就会发现即使你自己想要长按复制这个链接的文本内容，
微信似乎也不同意：那个「复制」的按钮凭空消失了！&lt;/del>
我曾经发送以&lt;code>https://youtube.com&lt;/code>开头的链接到一个&amp;lt;6人的群里，
视频内容是&lt;a class="link" href="https://www.youtube.com/channel/UCMUnInmOkrWN4gof9KlhNmQ" target="_blank" rel="noopener"
>老高與小茉&lt;/a>的一期脑洞。
发送之后我发现根本无法复制链接的文本。
同时我又发了一些其他链接，发现能够正常复制文本。
当然，在我写这篇文章时，想要重复实验来验证这个审查机制确实存在，
但这回又正常了。&lt;/p>
&lt;p>油管当然有很多邪恶行为，但如果你说访问&lt;code>youtube.com&lt;/code>是所谓「违法」的话，那就是在搞笑了：&lt;/p>
&lt;p>请先把喉舌闭上吧！ &lt;a class="link" href="https://www.youtube.com/c/cctv" target="_blank" rel="noopener"
>https://www.youtube.com/c/cctv&lt;/a>&lt;/p>
&lt;h2 id="微信在推广中心化的网络服务">微信在推广中心化的网络服务
&lt;/h2>&lt;p>微信的网络服务是中心化的，而中心化的网络结构是糟糕的。&lt;/p>
&lt;p>首先，它很脆弱。中心化网络中，如果中心节点出了问题，整个网络都会瘫痪。只要时间够长，出问题就是必然事件。事实上，微信已经有过大面积故障的情况发生了，将来也一定会再次发生的。我是认为把重要的东西放在微信上是极其愚蠢的。而事实上我们有大量的社交、金钱等依托于这个脆弱的平台。
包括支付宝等也是一样的。不管它宣传说自己什么「两地三中心」、「三地五中心」&amp;hellip;哪怕「三百地五百中心」，只要有个中心，这个网络结构都可以被”一勺烩”，我特别喜欢引用《庄子·胠箧》里的这个譬喻：&lt;/p>
&lt;blockquote>
&lt;p>将为胠箧、探囊、发匮之盗而为守备，则必摄缄縢、固扃鐍；此世俗之所谓知也。然而巨盗至，则负匮、揭箧、担囊而趋；唯恐缄縢扃鐍之不固也。然则乡之所谓知者，不乃为大盗积者也？&lt;/p>&lt;/blockquote>
&lt;p>中心化网络下所谓的「安全」，到头来终将是为他人作嫁衣裳。&lt;/p>
&lt;p>另外，中心化网络势必会产生垄断。当然这一点是微信所乐见的，但对于除了微信掌控者之外的其他所有人来说，都不是个好事。&lt;/p>
&lt;h2 id="微信不是端到端加密的即时通信服务">微信不是端到端加密的即时通信服务
&lt;/h2>&lt;p>这里的「端到端加密」，意思是只有发送者和接受者能够看到消息的明文，其他任何人即便拿到数据也都是加密后的密文，无法知晓通信的内容。&lt;/p>
&lt;p>显然，微信能够进行那么多肆无忌惮的审查操作，不可能提供端到端加密的功能。&lt;/p>
&lt;p>其实采用端到端加密的一个重要目的，也就是为了避免类似微信这种审查行为。&lt;/p>
&lt;h2 id="替代方案有哪些">替代方案有哪些？
&lt;/h2>&lt;p>非自由软件、中心化、非端到端加密这三项设计上的缺陷是微信如此糟糕的根本原因；而严苛的互联网审查制度只是个放大镜，让人们更清楚地看到其危害。&lt;/p>
&lt;p>一个好的微信替代品必须是一个自由的、去中心化、支持端到端加密的即时通讯协议，并且客户端和服务端软件要是自由软件。&lt;/p>
&lt;p>因此，类似于Line、WhatsApp、KakaoTalk之类的软件首先要被淘汰。它们和微信的区别可能仅仅是审查行为没有那么明显罢了，本质上是一样的。&lt;/p>
&lt;p>有人可能会说Telegram好一些；它的确有自由软件的客户端，但它的服务仍是中心化的，服务端仍然是专有软件，并且不支持端到端加密。&lt;/p>
&lt;h2 id="xmpp">XMPP
&lt;/h2>&lt;p>&lt;a class="link" href="https://xmpp.org/" target="_blank" rel="noopener"
>XMPP&lt;/a>是真正能够替代微信的东西。它其实只是一套开放的标准，定义了即时通信应用该如何工作，仅此而已。就像电子邮件和Web网页一样──我们有各式各样的电子邮箱服务提供者、各式各样的email客户端，形形色色的网站、也有各种浏览器──XMPP协议也有各种服务端和客户端的实现。&lt;/p>
&lt;p>对于客户端软件：&lt;/p>
&lt;p>在Android上，可以使用&lt;a class="link" href="https://conversations.im/" target="_blank" rel="noopener"
>Conversations&lt;/a>&lt;/p>
&lt;p>在iOS上，可以使用&lt;a class="link" href="https://monal.im/" target="_blank" rel="noopener"
>Monal&lt;/a>或&lt;a class="link" href="https://siskin.im" target="_blank" rel="noopener"
>Siskin&lt;/a>&lt;/p>
&lt;p>甚至在浏览器上，也可以使用&lt;a class="link" href="https://conversejs.org/" target="_blank" rel="noopener"
>Converse&lt;/a>&lt;/p>
&lt;p>在&lt;a class="link" href="https://xmpp.org/software/clients/" target="_blank" rel="noopener"
>这里你还能找到更多出色的XMPP客户端&lt;/a>&lt;/p>
&lt;p>对于服务端：&lt;/p>
&lt;p>类似于电子邮箱──有人选择付费服务，有人选择免费服务，有人选择自己搭建服务──XMPP也有各式各样的服务提供者，你也可以自己搭建一个自己的XMPP服务器。&lt;/p>
&lt;p>在&lt;a class="link" href="https://conversations.im/" target="_blank" rel="noopener"
>Conversations&lt;/a>提供的&lt;a class="link" href="https://compliance.conversations.im/" target="_blank" rel="noopener"
>兼容性测试页面&lt;/a>上，可以找到目前因特网上公开的XMPP服务器，如&lt;a class="link" href="https://compliance.conversations.im/test/xep0384/" target="_blank" rel="noopener"
>这个连接&lt;/a>显示了各个服务器是否实现了OMEMO(端到端加密)。&lt;/p>
&lt;p>你也可以参考&lt;a class="link" href="https://xmpp.org/software/servers/" target="_blank" rel="noopener"
>这里列出的服务端软件&lt;/a>自己搭一个XMPP服务器。我使用的是&lt;a class="link" href="https://prosody.im/" target="_blank" rel="noopener"
>Prosody IM&lt;/a>，简单高效，非常好用。&lt;/p>
&lt;h2 id="matrix">Matrix
&lt;/h2>&lt;p>&lt;a class="link" href="https://matrix.org" target="_blank" rel="noopener"
>Matrix&lt;/a> 也是一个满足自由软件、去中心化、端到端加密要求的即时通信协议。同样有许许多多的客户端实现。但它的服务端目前主要使用的是Synapse，也是自由软件，不过它的服务端运行时消耗的计算资源相当多，我曾在自己的小vps中尝试运行过Synapse，程序经常崩溃，CPU占用也相当大（也可能是因为当时还不太完善），于是后来我就没有再尝试了。&lt;/p>
&lt;p>不过总体而言客户端的体验可能比XMPP要更友好一些。&lt;/p></description></item><item><title>关于</title><link>https://cld4h.github.io/blog/zh-cn/%E5%85%B3%E4%BA%8E/</link><pubDate>Sun, 13 Feb 2022 00:00:00 +0000</pubDate><guid>https://cld4h.github.io/blog/zh-cn/%E5%85%B3%E4%BA%8E/</guid><description>&lt;p>嗨！&lt;/p>
&lt;h2 id="我喜欢的东西">我喜欢的东西
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://www.gnu.org/philosophy/" target="_blank" rel="noopener"
>自由软件&lt;/a>&lt;/li>
&lt;li>自给自足&lt;/li>
&lt;li>DIY和维修&lt;/li>
&lt;li>钢琴和音乐 🎹&lt;/li>
&lt;/ul>
&lt;h2 id="我讨厌的东西">我讨厌的东西
&lt;/h2>&lt;ul>
&lt;li>抽烟 🚭&lt;/li>
&lt;/ul>
&lt;h2 id="rss-订阅链接">rss 订阅链接
&lt;/h2>&lt;p>注意：&lt;strong>不同&lt;/strong>语言下有&lt;strong>不同&lt;/strong>的文章，全部订阅以接收完整内容&lt;/p>
&lt;p>&lt;a class="link" href="https://cld4h.github.io/blog/zh-cn/index.xml" >English&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://cld4h.github.io/blog/zh-tw/index.xml" >中文正體&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://cld4h.github.io/blog/zh-cn/index.xml" >中文简体&lt;/a>&lt;/p>
&lt;h3 id="xmpp">xmpp
&lt;/h3>&lt;p>我的xmpp联系方式是&lt;/p>
&lt;p>&lt;a class="link" href="xmpp:cld4h@disroot.org" >xmpp:cld4h@disroot.org&lt;/a>&lt;/p></description></item><item><title>Mass Surveillance</title><link>https://cld4h.github.io/blog/zh-cn/p/mass-surveillance/</link><pubDate>Thu, 29 Apr 2021 08:25:00 +0800</pubDate><guid>https://cld4h.github.io/blog/zh-cn/p/mass-surveillance/</guid><description>&lt;img src="https://cld4h.github.io/blog/img2.jpg" alt="Featured image of post Mass Surveillance" />&lt;h2 id="什么是mass-surveillance">什么是&amp;quot;Mass Surveillance&amp;quot;
&lt;/h2>&lt;p>&lt;a class="link" href="https://en.wikipedia.org/wiki/Mass_surveillance" target="_blank" rel="noopener"
>参见&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>Mass surveillance is the intricate surveillance of an entire or a substantial fraction of a population in order to monitor that group of citizens.&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>大规模监控（英语：Mass surveillance，也称为大规模监视或大规模监听）是一种针对全体人口或大多数人口的复杂监控，其目的是掌握民众的行为。&lt;/p>&lt;/blockquote>
&lt;h2 id="我的观点">我的观点
&lt;/h2>&lt;p>现今，无论是政府还是科技巨头都在想方设法掌握民众生活中的每一个细节。它们或以「保障安全」为目的，或以「高效」、「便利」为目的，但无论目的是什么，大规模监控这种手段都是邪恶的，它严重地侵害了公民的隐私权。因此大规模监控应当被人唾弃。&lt;/p>
&lt;p>正如马丁・路德・金的这句名言:&lt;/p>
&lt;blockquote>
&lt;p>手段代表了在形成之中的理想和进行之中的目的，人们无法通过邪恶的手段来达到美好的目的。因为手段是种子，目的是树。&lt;/p>&lt;/blockquote>
&lt;p>常常有人代表自己或者代表中国人说类似「我们不在乎隐私」这类话，
借用 Edward Snowden 的类比就能明白它们真正的意思:&lt;/p>
&lt;blockquote>
&lt;p>辩称自己不在乎隐私因为自己没什么需要藏着的，无异于说自己不在乎言论自由因为自己没什么要说的。&lt;/p>&lt;/blockquote></description></item><item><title>Archlinux 安装</title><link>https://cld4h.github.io/blog/zh-cn/p/archlinux-%E5%AE%89%E8%A3%85/</link><pubDate>Tue, 24 Sep 2019 15:31:24 +0800</pubDate><guid>https://cld4h.github.io/blog/zh-cn/p/archlinux-%E5%AE%89%E8%A3%85/</guid><description>&lt;img src="https://archlinux.org/static/logos/archlinux-logo-dark-scalable.518881f04ca9.svg" alt="Featured image of post Archlinux 安装" />&lt;mark>
注意：本篇文章中提到的内容可能存在过时问题，另外有很多软件我已不再使用或反对使用，请小心！
&lt;/mark>
&lt;p>参考：
&lt;a class="link" href="http://valleycat.org/linux/arch-usb.html" target="_blank" rel="noopener"
>http://valleycat.org/linux/arch-usb.html&lt;/a>&lt;/p>
&lt;h2 id="准备过程">准备过程
&lt;/h2>&lt;ul>
&lt;li>下载iso&lt;/li>
&lt;/ul>
&lt;p>进入 &lt;a class="link" href="https://www.archlinux.org/download/" target="_blank" rel="noopener"
>https://www.archlinux.org/download/&lt;/a> 找到最近的镜像源下载iso即可&lt;/p>
&lt;ul>
&lt;li>刷入U盘&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://wiki.archlinux.org/index.php/USB_flash_installation_media" target="_blank" rel="noopener"
>参见&lt;/a>&lt;/p>
&lt;p>运行下述命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl"> dd &lt;span class="nv">bs&lt;/span>&lt;span class="o">=&lt;/span>4M &lt;span class="k">if&lt;/span>&lt;span class="o">=&lt;/span>path/to/archlinux.iso &lt;span class="nv">of&lt;/span>&lt;span class="o">=&lt;/span>/dev/sdx &lt;span class="nv">status&lt;/span>&lt;span class="o">=&lt;/span>progress &lt;span class="nv">oflag&lt;/span>&lt;span class="o">=&lt;/span>sync
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>启动进入Live CD&lt;/li>
&lt;/ul>
&lt;h3 id="调整live-archlinux-root-分区的大小">调整Live archlinux root 分区的大小
&lt;/h3>&lt;p>&lt;a class="link" href="https://www.ostechnix.com/adjust-size-root-partition-live-arch-linux/" target="_blank" rel="noopener"
>参见&lt;/a>&lt;/p>
&lt;p>启动时按下 &lt;strong>e&lt;/strong> 或 tab 键以修改内核参数&lt;/p>
&lt;p>在 &lt;code>linux=...initrd=...&lt;/code> 后添加 &lt;code>cow_spacesize=1G&lt;/code>&lt;/p>
&lt;p>如果没有在启动时修改内核参数，可以在启动后执行下述命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">mount -o remount,size&lt;span class="o">=&lt;/span>1G /run/archiso/cowspace
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>cow 是 Copy On Write 的缩写，额外的空间使用的是内存&lt;/p>
&lt;h2 id="开始安装无桌面环境等">开始安装（无桌面环境等）
&lt;/h2>&lt;h3 id="验证系统启动模式uefibios">验证系统启动模式：UEFI/BIOS
&lt;/h3>&lt;p>查看 &lt;code>/sys/firmware/efi/efivars&lt;/code> 文件夹中的内容&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">ls /sys/firmware/efi/efivars
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>若有返回文件列表，则证明是在UEFI模式下
(或通过 &lt;code>efivar -l&lt;/code> 命令也可查看)&lt;/p>
&lt;h3 id="连接网络">连接网络
&lt;/h3>&lt;p>通过 &lt;code>ip link&lt;/code> 查看连接情况&lt;/p>
&lt;p>镜像默认启动时启动了 &lt;code>dhcpcd&lt;/code> 服务&lt;/p>
&lt;p>通过 &lt;code>ping www.baidu.coom&lt;/code> 确认能上网&lt;/p>
&lt;h3 id="设置系统时间与ntp服务器同步">设置系统时间与NTP服务器同步
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">timedatectl set-ntp &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>通过 &lt;code>timedatectl status&lt;/code> 命令检查服务状态&lt;/p>
&lt;h3 id="磁盘分区">磁盘分区
&lt;/h3>&lt;p>先 &lt;code>lsblk&lt;/code> 一下确定磁盘名&lt;/p>
&lt;p>通过 &lt;code>gdisk /dev/sdX&lt;/code> xzyy 全盘清空&lt;/p>
&lt;p>通过 &lt;code>cgdisk&lt;/code> 进行分区&lt;/p>
&lt;p>下表中的分区方式支持BIOS和UEFI&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>编码&lt;/th>
&lt;th>文件系统类型&lt;/th>
&lt;th>分区大小&lt;/th>
&lt;th>设备名(示例)&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>ef02&lt;/td>
&lt;td>BIOS System&lt;/td>
&lt;td>10MiB&lt;/td>
&lt;td>/dev/sda1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ef00&lt;/td>
&lt;td>EFI System&lt;/td>
&lt;td>500MiB&lt;/td>
&lt;td>/dev/sda2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>8300&lt;/td>
&lt;td>Linux File System&lt;/td>
&lt;td>剩余全部空间&lt;/td>
&lt;td>/dev/sda3&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>swap 不设固定分区，由 swap 文件方式设置&lt;/p>
&lt;p>格式化分区：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">mkfs.fat -F32 /dev/sda2 &lt;span class="c1">#EFI System&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkfs.ext4 /dev/sda3 &lt;span class="c1">#Linux File System&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>不对 &lt;code>/dev/sda1&lt;/code> 进行格式化&lt;/p>
&lt;p>挂载分区：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">mount /dev/sda3 /mnt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir /mnt/boot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mount /dev/sda2 /mnt/boot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="设置镜像源">设置镜像源
&lt;/h3>&lt;p>&lt;a class="link" href="https://www.archlinux.org/mirrorlist/?country=all&amp;amp;protocol=http&amp;amp;ip_version=6" target="_blank" rel="noopener"
>支持IPv6的镜像源&lt;/a>
&lt;a class="link" href="https://www.archlinux.org/mirrorlist/" target="_blank" rel="noopener"
>镜像源列表生成器&lt;/a>&lt;/p>
&lt;p>编辑 &lt;code>/etc/pacman.d/mirrorlist&lt;/code> 文件&lt;/p>
&lt;p>创建和编辑 &lt;code>/etc/pacman.d/mirrorlist&lt;/code> 文件之后，使用下面命令刷新镜像：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pacman -Syyu
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>传入两次 &lt;code>--refresh&lt;/code> 或 &lt;code>-y&lt;/code> 将强制更新所有软件包，即使系统认为它们已经是最新。&lt;/p>
&lt;p>&lt;strong>每次修改镜像之后都应该使用&lt;/strong>&lt;code>pacman -Syyu&lt;/code>&lt;/p>
&lt;p>&lt;a class="link" href="https://wiki.archlinux.org/index.php/Mirrors" target="_blank" rel="noopener"
>参考&lt;/a>&lt;/p>
&lt;h3 id="安装软件">安装软件
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pacstrap -i /mnt base base-devel vim ntfs-3g networkmanager shadowsocks-libev
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>-i&lt;/code> 选项表示&amp;quot;交互的(interactive)&amp;quot;&lt;/p>
&lt;h3 id="创建swap文件">创建swap文件
&lt;/h3>&lt;p>我没有固定设置swap分区，而是使用了swap文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo fallocate -l 1G /mnt/swapfile
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>If fallocate is not installed or if you get an error message saying fallocate failed: Operation not supported then you can use the following command to create the swap file:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo dd &lt;span class="k">if&lt;/span>&lt;span class="o">=&lt;/span>/dev/zero &lt;span class="nv">of&lt;/span>&lt;span class="o">=&lt;/span>/mnt/swapfile &lt;span class="nv">bs&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1024&lt;/span> &lt;span class="nv">count&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1048576&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>设置swapfile文件权限&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo chmod &lt;span class="m">600&lt;/span> /mnt/swapfile
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo mkswap /mnt/swapfile
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo swapon /mnt/swapfile
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>生成 &lt;code>/etc/fstab&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">genfstab -U /mnt &amp;gt;&amp;gt; /mnt/etc/fstab
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改 &lt;code>/etc/fstab&lt;/code> ，保证路径正确&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/swapfile none swap defaults 0 0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>验证 &lt;code>swap&lt;/code> 已挂载&lt;/p>
&lt;ol>
&lt;li>&lt;code>sudo swapon --show&lt;/code>&lt;/li>
&lt;li>&lt;code>sudo free -h&lt;/code>&lt;/li>
&lt;/ol>
&lt;h3 id="chroot">chroot
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">arch-chroot /mnt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="设置时区">设置时区
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>运行 &lt;code>hwclock&lt;/code> 以生成 &lt;code>/etc/adjtime&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">hwclock --systohc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="本地化">本地化
&lt;/h3>&lt;p>编辑 &lt;code>/etc/locale.gen&lt;/code> 文件，将 &lt;code>en_US.UTF-8 UTF-8&lt;/code> 取消注释
之后运行 &lt;code>locale-gen&lt;/code> 命令&lt;/p>
&lt;p>新建 &lt;code>/etc/locale.conf&lt;/code> 文件，将 &lt;code>LANG&lt;/code> 变量设置为对应值&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">LANG=en_US.UTF-8
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="网络配置">网络配置
&lt;/h3>&lt;p>编辑 &lt;code>/etc/hostname&lt;/code> 文件，起一个好听好记的名字
如 &lt;code>USB&lt;/code>&lt;/p>
&lt;p>编辑 &lt;code>/etc/hosts&lt;/code> 文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">127.0.0.1 localhost
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">::1 localhost
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.1.1 USB.localdomain USB
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="针对于将系统安装在-portable-usb-key上">针对于将系统安装在 portable USB key上
&lt;/h3>&lt;h4 id="ram-disk-image">RAM disk image
&lt;/h4>&lt;p>&lt;a class="link" href="http://valleycat.org/linux/arch-usb.html#RAM_disk" target="_blank" rel="noopener"
>参见&lt;/a>&lt;/p>
&lt;p>(不用看this paragraph)
In order to boot the Linux Kernel persistently off of a USB device, some adjustments may be necessary to the initial RAM disk image. We need to ensure that block device support is properly loaded before any attempt at loading the filesystem. This not always the way a RAM disk image is configured in a generic Linux installation, and I suspect this may be another one of the failure points in other Linux USB installations out there. To configure a custom RAM disk image, open &lt;code>/etc/mkinitcpio.conf&lt;/code> in an editor:&lt;/p>
&lt;p>Ensure the &lt;strong>block&lt;/strong> hook comes &lt;strong>before&lt;/strong> the &lt;strong>filesystems&lt;/strong> hook and &lt;strong>directly after&lt;/strong> the &lt;strong>udev&lt;/strong> hook like the following:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">HOOKS=(base udev block filesystems keyboard fsck)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now regenerate the initial RAM disk image with the changes made:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">mkinitcpio -p linux
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="network-interface-names">network interface names
&lt;/h4>&lt;p>Arch Linux&amp;rsquo;s basic service manager, systemd, assigns network interfaces predictable names based on the actual device hardware. This is great for just about any other type of install, but can pose some problems for the portable USB installation we&amp;rsquo;re going for. To ensure that the ethernet and wifi interfaces will always be respectively named &lt;em>eth0&lt;/em> and &lt;em>wlan0&lt;/em>, revert the Arch Linux USB back to traditional device naming:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">ln -s /dev/null /etc/udev/rules.d/80-net-setup-link.rules
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="journal-config">journal config
&lt;/h4>&lt;p>A default installation of Arch Linux is setup with systemd to continuously journal various information about current processes and write that data to storage on disk. For a persistent bootable installation on a flash memory device, however, we can change some options in &lt;code>journald.conf&lt;/code> to enable journal keeping entirely in RAM (thus reducing writes to the flash device). To control where journal data is stored, open &lt;code>/etc/systemd/journald.conf&lt;/code> in and editor, to switch journal data storage to RAM, set the storage variable to volatile by ensuring the following line is uncommented:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Storage=volatile
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As an additional precaution, to ensure the operating system doesn&amp;rsquo;t overfill RAM with journal data, set the max-use variable by adding the line:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">SystemMaxUse=16M
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="mount-options">mount options
&lt;/h4>&lt;p>Modern filesystems are able to record various metadata (last accessed, last modified, user rights, etc.) about their files. A default filesystem mount generally keeps track of as much as this information as possible. For a persistent bootable operating system on a flash memory device, however, we should limit some of this record keeping in order to reduce writes to the flash device. Using the &lt;code>noatime&lt;/code> mount option in fstab will disable the record keeping of file access times: no writes will occur when a file is read, only when it is modified.&lt;/p>
&lt;p>To disable record keeping of file access times for the bootable USB, open /etc/fstab in an editor, change the mount options from &lt;code>relatime&lt;/code> to &lt;code>noatime&lt;/code>.&lt;/p>
&lt;h3 id="root-密码">Root 密码
&lt;/h3>&lt;p>通过 &lt;code>passwd&lt;/code> 修改root密码&lt;/p>
&lt;h3 id="boot-loader">Boot loader
&lt;/h3>&lt;p>参考：
&lt;a class="link" href="http://valleycat.org/linux/arch-usb.html#bootloader" target="_blank" rel="noopener"
>BIOS and UEFI&lt;/a>&lt;/p>
&lt;ol>
&lt;li>确保 &lt;code>grub&lt;/code> 和 &lt;code>efibootmgr&lt;/code> 已安装&lt;/li>
&lt;li>确保 EFI 系统分区已经挂载（前面通过 &lt;code>mount /dev/sda2 /mnt/boot&lt;/code> 挂载，对于此时 (chroot 之后) 来说，挂载点为 &lt;code>/boot&lt;/code>），&lt;/li>
&lt;li>运行&lt;/li>
&lt;/ol>
&lt;p>同时安装两个启动项 &lt;a class="link" href="http://valleycat.org/linux/arch-usb.html#bootloader" target="_blank" rel="noopener"
>BIOS and UEFI&lt;/a>
Setup GRUB for MBR/BIOS booting mode:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">grub-install --target&lt;span class="o">=&lt;/span>i386-pc --boot-directory /boot /dev/sda
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Setup GRUB for UEFI booting mode:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">grub-install --target&lt;span class="o">=&lt;/span>x86_64-efi --efi-directory /boot --boot-directory /boot --removable
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;a class="link" href="https://wiki.archlinux.org/index.php/GRUB#Installation_2" target="_blank" rel="noopener"
>GRUB&lt;/a> wiki中推荐的安装指令(与前面UEFI安装类似)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">grub-install --target&lt;span class="o">=&lt;/span>x86_64-efi --efi-directory&lt;span class="o">=&lt;/span>/boot --bootloader-id&lt;span class="o">=&lt;/span>GRUB
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>可以安装 &lt;code>os-prober&lt;/code> 软件包并运行来检测其他OS&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo pacman -S os-prober
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">os-prober
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="5">
&lt;li>生成 &lt;code>grub.cfg&lt;/code> 配置文件&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">grub-mkconfig -o /boot/grub/grub.cfg
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="网络">网络
&lt;/h3>&lt;p>Install the ifplugd package to configure automatic IP leasing on ethernet devices:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pacman -S ifplugd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Download the packages to enable wifi support with a basic command line interface:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pacman -S iw wpa_supplicant dialog
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装 NetworkManager 并设置开机启动&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo pacman -S networkmanager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> NetworkManager
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="显卡">显卡
&lt;/h3>&lt;p>To support most common GPUs, install all four basic open source video drivers:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pacman -S xf86-video-ati xf86-video-intel xf86-video-nouveau xf86-video-vesa
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="触摸板">触摸板
&lt;/h3>&lt;p>Install support for standard notebook touchpads:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pacman -S xf86-input-synaptics
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在 &lt;code>.xinitrc&lt;/code> 文件中 &lt;code>exec&lt;/code> 前添加&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">synclient &lt;span class="nv">TapButton1&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">synclient &lt;span class="nv">TapButton2&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">synclient &lt;span class="nv">TapButton3&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">synclient &lt;span class="nv">VertScrollDelta&lt;/span>&lt;span class="o">=&lt;/span>-111
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="电池">电池
&lt;/h3>&lt;p>Install support for checking battery charge and state:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pacman -S acpi
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="针对于ssd的trim指令的优化">针对于SSD的TRIM指令的优化
&lt;/h3>&lt;p>将持续TRIM改为定时TRIM&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> fstrim.timer
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>参见
&lt;a class="link" href="https://www.digitalocean.com/community/tutorials/how-to-configure-periodic-trim-for-ssd-storage-on-linux-servers" target="_blank" rel="noopener"
>https://www.digitalocean.com/community/tutorials/how-to-configure-periodic-trim-for-ssd-storage-on-linux-servers&lt;/a>&lt;/p>
&lt;h3 id="创建用户">创建用户
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">useradd -m -G wheel,storage hao
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># useradd -m -g users -G wheel,storage -s /bin/bash hao&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>-m&lt;/code> 选项创建home目录
&lt;code>-g&lt;/code> 选项指定所在组
&lt;code>-G&lt;/code> 选项指定包含所创建用户的额外的组
&lt;code>-s&lt;/code> 选项指定用户所用的shell&lt;/p>
&lt;p>运行上面的没有注释的命令会创建一个用户 &lt;code>hao&lt;/code>(UID=1000) 和一个组 &lt;code>hao&lt;/code>(GID=1000)&lt;/p>
&lt;p>我们想把组 &lt;code>hao&lt;/code>(GID=1000) 删除，把用户 &lt;code>hao&lt;/code>(UID=1000) 更改到组 &lt;code>users&lt;/code> 下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">usermod -g users -G wheel,storage,power hao
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">groupdel hao
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其他的可用命令 &lt;code>useradd&lt;/code>,&lt;code>userdel&lt;/code>,&lt;code>groupadd&lt;/code>,&lt;code>groupdel&lt;/code>&lt;/p>
&lt;h4 id="编辑-etcsudoers">编辑 &lt;code>/etc/sudoers&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">EDITOR&lt;/span>&lt;span class="o">=&lt;/span>vim visudo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## User privilege specification
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root ALL=(ALL) ALL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## Uncomment to allow members of group wheel to exec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ute any command
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># %wheel ALL=(ALL) ALL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## Same thing without a password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># %wheel ALL=(ALL) NOPASSWD: ALL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">%wheel ALL=(ALL) NOPASSWD: ALL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## This keeps you from needing to reinsert your pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">words in each different terminal a wheel user uses s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">udo in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Defaults !tty_tickets
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="安装图形界面">安装图形界面
&lt;/h2>&lt;h3 id="安装-xorg-x">安装 X.org (X)
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pacman -S xorg-server xorg-xinit
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>输入 &lt;code>xinit&lt;/code> 或 &lt;code>startx&lt;/code> 后， X Server 会读取 &lt;code>$HOME/.xinitrc&lt;/code> 来查找如何启动
如，要启动 i3，则在&lt;code>$HOME/.xinitrc&lt;/code>中添加 &lt;code>exec i3&lt;/code>&lt;/p>
&lt;h3 id="安装-i3-等相关程序">安装 i3 等相关程序
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pacman -S i3 dmenu ttf-dejavu firefox alacritty ranger
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="中文字体">中文字体
&lt;/h3>&lt;p>环境变量 &lt;code>LANG=zh_CN.UTF-8&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;code>.bashrc&lt;/code>：每次&lt;strong>终端登录&lt;/strong>时读取并运用里面的设置。&lt;/li>
&lt;li>&lt;code>.xinitrc&lt;/code>：每次&lt;code>startx&lt;/code> &lt;strong>启动X界面&lt;/strong>时读取并运用里面的设置。&lt;/li>
&lt;li>&lt;code>.xprofile&lt;/code>：每次使用&lt;strong>gdm等图形登录&lt;/strong>时读取并运用里面的设置。&lt;/li>
&lt;/ul>
&lt;p>在 &lt;code>.xinitrc&lt;/code> 或 &lt;code>.xprofile&lt;/code>中添加下面三行内容&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">LANG&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">zh_CN&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">UTF&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">LANGUAGE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">zh_CN&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">en_US&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">LC_CTYPE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">en_US&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">UTF&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装思源字体&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pacman -S adobe-source-han-sans-cn-fonts adobe-source-han-serif-cn-fonts
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="中文输入法搜狗拼音输入法">中文输入法&amp;mdash;&lt;del>搜狗拼音输入法&lt;/del>
&lt;/h3>&lt;p>&lt;mark>强烈反对使用搜狗拼音输入法，建议使用自由的rime输入法。前者不但可能存在后门；配置时还有很多坑。&lt;/mark>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo pacman -S fcitx fcitx-im fcitx-configtool
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>由于搜狗拼音输入法不在官方仓库中，我们可以用AUR，也可以添加非官方仓库[archlinuxcn]&lt;/p>
&lt;p>编辑 &lt;code>/etc/pacman.conf&lt;/code>，在所有仓库之后加入如下内容&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[archlinuxcn]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#SigLevel = Never
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Include = /etc/pacman.d/archlinuxcn.mirrorlist
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>编辑 &lt;code>/etc/pacman.d/archlinuxcn.mirrorlist&lt;/code> 文件
加入如下内容&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## 清华大学 (ipv4, ipv6, http, https)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 中国科学技术大学 (ipv4, ipv6, http, https)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Server = https://mirrors.ustc.edu.cn/archlinuxcn/$arch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## Our main server (ipv4, ipv6, http, https)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## Our main server located in Netherlands
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Server = https://repo.archlinuxcn.org/$arch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 浙江大学 (浙江杭州) (ipv4, ipv6, http, https)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## Added: 2017-06-05
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Server = https://mirrors.zju.edu.cn/archlinuxcn/$arch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>运行 &lt;code>sudo pacman -Syyu&lt;/code> 和 &lt;code>sudo pacman -S archlinuxcn-keyring&lt;/code>&lt;/p>
&lt;blockquote>
&lt;p>pacman 清除缓存
&lt;code>sudo pacman -Sc&lt;/code>&lt;/p>&lt;/blockquote>
&lt;p>&lt;a class="link" href="https://github.com/archlinuxcn/mirrorlist-repo" target="_blank" rel="noopener"
>更多源参见&lt;/a>&lt;/p>
&lt;p>&lt;del>安装搜狗拼音输入法&lt;/del>&lt;/p>
&lt;p>&lt;mark>！请不要安装搜狗拼音输入法！&lt;/mark>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># sudo pacman -S fcitx-sogoupinyin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pacman -S fcitx-rime
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在 &lt;code>~/.profile&lt;/code> 文件中加入下面几个环境变量：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">GTK_IM_MODULE&lt;/span>&lt;span class="o">=&lt;/span>fcitx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">QT_IM_MODULE&lt;/span>&lt;span class="o">=&lt;/span>fcitx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">XMODIFIERS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;@im=fcitx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在 &lt;code>.xinitrc&lt;/code> 中添加&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">fcitx &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>或在 i3配置文件中添加 &lt;code>exec_always fcitx&lt;/code>&lt;/p>
&lt;h3 id="安装-virtualbox">安装 virtualbox
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo pacman -S linux-headers virtualbox virtualbox-guest-iso
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="修改键位">修改键位
&lt;/h3>&lt;h4 id="使用-xmodmap">使用 &lt;code>xmodmap&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">xmodmap -pke &amp;gt; ~/.xmodmap
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>xev&lt;/code> 可以查看keycode&lt;/p>
&lt;p>编辑上一步得到的 &lt;code>~/.xmodmap&lt;/code>文件，对应的keycode作修改
在文件开始处添加&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">clear control
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clear lock
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clear mod1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在文件结尾处添加&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">add control =Control_L Control_R
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">add mod1 = Alt_L
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>执行 xmodmap &lt;code>~/.xmodmap&lt;/code>&lt;/p>
&lt;h3 id="安装无道词典">安装无道词典
&lt;/h3>&lt;mark>
我现在使用的是另一个程序：&lt;a href="https://github.com/TimothyYe/ydict">ydict&lt;/a>
&lt;/mark>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo pacman -S python python-pip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pip install bs4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pip install lxml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>注意，无道词典与variety冲突时，只需要pip uninstall 冲突的包即可&lt;/strong>&lt;/p>
&lt;h3 id="配置neovim">配置neovim
&lt;/h3>&lt;p>将&lt;code>.config/nvim/init.vim&lt;/code> 软链接到 &lt;code>~/.vimrc&lt;/code>
编辑&lt;code>~/.vimrc&lt;/code>
使用&lt;code>vim-plug&lt;/code>工具管理vim插件
在vim中通过&lt;code>:PlugInstall&lt;/code>安装插件&lt;a class="link" href="https://github.com/junegunn/vim-plug/wiki/tutorial#installing-plugins" target="_blank" rel="noopener"
>参考&lt;/a>&lt;/p>
&lt;h4 id="ultisnips-需要python支持">UltiSnips 需要python支持
&lt;/h4>&lt;p>由于UltiSnips需要python支持，当启动neovim时，若没有pynvim包，则会报错：&lt;/p>
&lt;blockquote>
&lt;p>UltiSnips: the Python version from g:UltiSnipsUsePythonVersion (3) is not available.&lt;/p>&lt;/blockquote>
&lt;p>解决方案：pip安装pynvim&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo pip install -U pynvim
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="美化主题">美化主题
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># for GTK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pacman -S lxappearance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># for qt5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pacman -S qt5ct
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>更换桌面壁纸&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">pacman&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">S&lt;/span> &lt;span class="n">feh&lt;/span> &lt;span class="n">variety&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>终端半透明&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo pacman -S compton
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>alacritty: &lt;code>.config/alacritty/config.yml&lt;/code> 设置 &lt;code>opacity&lt;/code>&lt;/p></description></item><item><title>Android crack</title><link>https://cld4h.github.io/blog/zh-cn/p/android-crack/</link><pubDate>Tue, 18 Jun 2019 00:00:00 +0000</pubDate><guid>https://cld4h.github.io/blog/zh-cn/p/android-crack/</guid><description>&lt;img src="https://cld4h.github.io/blog/zh-cn/p/android-crack/smali.png" alt="Featured image of post Android crack" />&lt;div class="sect1">
&lt;h2 id="_目标">目标&lt;/h2>
&lt;div class="sectionbody">
&lt;div class="olist arabic">
&lt;ol class="arabic">
&lt;li>
&lt;p>软件破解&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div>
&lt;div class="paragraph">
&lt;p>使用 &lt;code>apktool&lt;/code> 及 &lt;code>dex2jar&lt;/code> 逆向 &lt;code>crackme2.apk&lt;/code> ，寻找到爆破点，修改注册逻辑代码，使注册机制失效，使用 &lt;code>apkTool&lt;/code> 重新打包生成apk，要求新的apk对任意字符成功注册。（可使用工具： &lt;code>apktool&lt;/code> 、 &lt;code>BakSmali&lt;/code> 、 &lt;code>dex2jar&lt;/code> 、 &lt;code>jd-gui&lt;/code> ）。&lt;/p>
&lt;/div>
&lt;div class="olist arabic">
&lt;ol class="arabic" start="2">
&lt;li>
&lt;p>注册机开发&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div>
&lt;div class="paragraph">
&lt;p>逆向示例程序 &lt;code>crackme.apk&lt;/code> ，根据 &lt;code>dex2jar&lt;/code> 和 &lt;code>JD-GUI&lt;/code> 工具，查看java源码，分析注册机制，写出注册机程序。&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="sect1">
&lt;h2 id="_环境说明">环境说明&lt;/h2>
&lt;div class="sectionbody">
&lt;table class="tableblock frame-all grid-all stretch">
&lt;colgroup>
&lt;col style="width: 50%;"/>
&lt;col style="width: 50%;"/>
&lt;/colgroup>
&lt;tbody>
&lt;tr>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">工具&lt;/p>&lt;/td>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">版本&lt;/p>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">apktool&lt;/p>&lt;/td>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">v2.4.0 with smali v2.2.6 and baksmali v2.2.6&lt;/p>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">OpenJDK&lt;/p>&lt;/td>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">1.8.0_212&lt;/p>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">dex2jar&lt;/p>&lt;/td>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">2.0&lt;/p>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">jd-gui&lt;/p>&lt;/td>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">1.5.2&lt;/p>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">Android Studio&lt;/p>&lt;/td>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">Android Studio 3.4.1&lt;/p>
&lt;p class="tableblock">Build #AI-183.6156.11.34.5522156, built on May 2, 2019&lt;/p>
&lt;p class="tableblock">JRE: 1.8.0_152-release-1343-b16-5323222 amd64&lt;/p>
&lt;p class="tableblock">JVM: OpenJDK 64-Bit Server VM by JetBrains s.r.o&lt;/p>
&lt;p class="tableblock">Linux 5.1.8-arch1-1-ARCH&lt;/p>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">AVD 虚拟机&lt;/p>&lt;/td>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">Nexus 5X API 28 x86&lt;/p>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">ADB&lt;/p>&lt;/td>
&lt;td class="tableblock halign-left valign-top">&lt;p class="tableblock">Android Debug Bridge version 1.0.41
Version 28.0.3-5475833&lt;/p>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/div>
&lt;/div>
&lt;div class="sect1">
&lt;h2 id="_软件破解">软件破解&lt;/h2>
&lt;div class="sectionbody">
&lt;div class="sect2">
&lt;h3 id="_反编译过程说明">反编译过程说明&lt;/h3>
&lt;div class="paragraph">
&lt;p>使用 &lt;code>apktool&lt;/code> 进行反编译，执行：&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>apktool d crackme2.apk&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>得到 &lt;code>crackme2&lt;/code> 目录，查看其中文件及目录结构：&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>cd crackme2
tree . &amp;gt; t.txt&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>输出的 &lt;code>t.txt&lt;/code> 中内容如下：&lt;/p>
&lt;/div>
&lt;div class="listingblock">
&lt;div class="title">t.txt&lt;/div>
&lt;div class="content">
&lt;pre>.
├── AndroidManifest.xml
├── apktool.yml
├── original
│   ├── AndroidManifest.xml
│   └── META-INF
│   ├── CERT.RSA
│   ├── CERT.SF
│   └── MANIFEST.MF
├── res
│   ├── drawable-hdpi-v4
│   │   └── icon.png
│   ├── drawable-ldpi-v4
│   │   └── icon.png
│   ├── drawable-mdpi-v4
│   │   └── icon.png
│   ├── layout
│   │   └── main.xml
│   └── values
│   ├── ids.xml
│   ├── public.xml
│   └── strings.xml
├── smali
│   └── com
│   └── lohan
│   └── crackme0a
│   ├── Main.smali
│   ├── R$attr.smali
│   ├── R$drawable.smali
│   ├── R$id.smali
│   ├── R$layout.smali
│   ├── R$string.smali
│   └── R.smali
└── t.txt
12 directories, 21 files&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>当使用 &lt;code>apktool&lt;/code> 工具反编译 apk 文件后，会在反编译工程目录下生成一个 &lt;code>smali&lt;/code> 目录，其中保存了所有反编译出的 &lt;code>smali&lt;/code> 文件，这些文件的功能是根据程序包的层次结构生成相应的目录。在 Android 应用程序中，在程序编译前的所有 Java 类都会在编译后的相应目录下生成独立的 &lt;code>smali&lt;/code> 文件，无论是普通类、抽象类、接口类或者内部类，在反编译后的代码中都以独立的 &lt;code>.smali&lt;/code> 格式文件存放。每个 &lt;code>.smali&lt;/code> 格式文件都由若干代码语句组成，所有的代码语句都遵循了严格的语法规范。&lt;/p>
&lt;/div>
&lt;/div>
&lt;div class="sect2">
&lt;h3 id="_smali文件格式信息说明">smali文件格式信息说明&lt;/h3>
&lt;div class="paragraph">
&lt;p>通常来说， &lt;code>.smali&lt;/code> 格式文件的前3行代码描述了当前类的一些信息，具体格式如下所示：&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>.class &amp;lt;访问权限&amp;gt; [修饰关键字] &amp;lt;类名&amp;gt;
.super &amp;lt;父类名&amp;gt;
.source &amp;lt;源文件名&amp;gt;&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>例如在 &lt;code>Main.smali&lt;/code> 文件中，前三行为&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>.class public Lcom/lohan/crackme0a/Main;
.super Landroid/app/Activity;
.source &amp;#34;Main.java&amp;#34;&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>第一行代码中的 &lt;code>.class&lt;/code> 指令指定了当前类的类名。类名开头的字符“L”遵循了 Dalvik VM 字节码的约定规则，表示后面跟随的字符串为一个类&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>第二行代码中的 &lt;code>.super&lt;/code> 指令设置了当前的父类，本实例 &lt;code>Lcom/lohan/crackme0a/Main&lt;/code> 的父类是 &lt;code>Landroid/app/Activity&lt;/code>&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>第三行代码中的 &lt;code>.source&lt;/code> 指令设置了当前类的源文件名。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>前三行代码后的代码部分就是整个类的主题部分，一个Android程序类可以由多个字段或方法组成。在 &lt;code>smali&lt;/code> 文件中，使用 &lt;code>.field&lt;/code> 指令来声明字段。这里字段有静态字段和实例字段两种。具体说明如下所示。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>静态字段的声明格式如下：&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre># static fields
.field &amp;lt;访问权限&amp;gt; static [修饰关键字] &amp;lt;字段名&amp;gt;:&amp;lt;字段类型&amp;gt;&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>当 &lt;code>baksmali&lt;/code> 生成 &lt;code>smali&lt;/code> 文件时，会在静态字段声明的起始处添加 &lt;code>static fields&lt;/code> 注释。我们可以发现，在 &lt;code>smali&lt;/code> 文件中的注释与 Dalvik VM 中的语法一样，都是以“#”开头。在 &lt;code>.field&lt;/code> 指令后会紧跟着“访问权限”指令，这里的访问权限可以是 &lt;code>public&lt;/code> 、 &lt;code>private&lt;/code> 、 &lt;code>protected&lt;/code> 。“修饰关键字”描述了字段的其他属性，例如 &lt;code>synthetic&lt;/code> 。指令的最后是 “字段名”和“字段类型”，使用冒号进行分隔，语法与 Dalvik VM 一样。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>实例字段的声明与静态字段类似，只是少了 &lt;code>static&lt;/code> 关键字， 其具体格式如下：&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre># instance fields
.field &amp;lt;访问权限&amp;gt; [修饰关键字] &amp;lt;字段名&amp;gt;:&amp;lt;字段类型&amp;gt;&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>直接方法的声明格式如下所示：&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre># direct methods
.method &amp;lt;访问权限&amp;gt; [修饰关键字] &amp;lt;方法原型&amp;gt;
&amp;lt;.locals&amp;gt;
[.parameter]
[.prologue]
[.line]
&amp;lt;代码体&amp;gt;
.end method&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="olist arabic">
&lt;ol class="arabic">
&lt;li>
&lt;p>&lt;code>direct methods&lt;/code> 是 &lt;code>baksmali&lt;/code> 添加的注释，访问权限和修饰关键字与字段的描述相同，方法原型描述了方法的名称、参数与返回值&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.locals&lt;/code> 指定了使用的局部变量的个数。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.parameter&lt;/code> 指定了方法的参数，与Dalvik VM语法中使用的 &lt;code>.parameters&lt;/code> 指定的参数个数不同，每个 &lt;code>.parameter&lt;/code> 指令表明使用一个参数，假如在方法中使用了3个参数，那么就会出现3条 &lt;code>.parameter&lt;/code> 指令。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.prologue&lt;/code> 指定了代码的开始处，混淆过的代码可能去除了该指令。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.line&lt;/code> 指定了该处指令在源代码中的行号，同理，混淆过的代码可能去除了行号信息。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div>
&lt;div class="paragraph">
&lt;p>声明虚方法的格式与声明直接方法的相同，只是起始处的注释为 &lt;code>virtual methods&lt;/code> 而已。如果某一个类实现了接口，则会在 &lt;code>smali&lt;/code> 文件中使用 &lt;code>.implements&lt;/code> 指令来声明，具体声明格式如下所示&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre># interfaces
. implements &amp;lt;接口名&amp;gt;&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>&lt;code>.implements&lt;/code> 是接口关键字，其后的接口名是 &lt;code>DexClassDef&lt;/code> 结构中 &lt;code>interfacesOff&lt;/code> 字段指定的内容。
当一个类使用了注解时，会在 &lt;code>smali&lt;/code> 文件中使用 &lt;code>.annotation&lt;/code> 指令进行声明，声明注解的语法格式如下所示：&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre># annotations
.annotation [注解属性] &amp;lt;注解类名&amp;gt;
[注解字段 = 值]
.end annotation&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>在 Android 程序中，注解的作用范围可以是类、方法或字段。如果注解作用范围是类，则 &lt;code>.annotation&lt;/code> 指令会直接在 &lt;code>smali&lt;/code> 文件中定义。如果是方法或字段，则会在方法或字段定义中包含 &lt;code>.annotation&lt;/code> 指令。&lt;/p>
&lt;/div>
&lt;div class="admonitionblock tip">
&lt;table>
&lt;tbody>&lt;tr>
&lt;td class="icon">
&lt;div class="title">Tip&lt;/div>
&lt;/td>
&lt;td class="content">
更多 &lt;code>smali&lt;/code> 相关知识，可参阅 Gabor Paller 所写的《Dalvik opcodes》一文。 &lt;a href="http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html">链接&lt;/a>
&lt;/td>
&lt;/tr>
&lt;/tbody>&lt;/table>
&lt;/div>
&lt;/div>
&lt;div class="sect2">
&lt;h3 id="_修改破解过程说明">修改破解过程说明&lt;/h3>
&lt;div class="paragraph">
&lt;p>回到我们的 &lt;code>crackme2.apk&lt;/code> 实例，直接分析 &lt;code>smali&lt;/code> 指令不太方便，我们先通过 &lt;code>dex2jar&lt;/code> 工具反编译出源码，方便理解程序运行的逻辑。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>先解压apk&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>unzip crackme2.apk&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>在解压出的文件中找到 &lt;code>classes.dex&lt;/code> 文件，进行反编译。&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>d2j-dex2jar.sh classes.dex&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>生成 &lt;code>classes-dex2jar.jar&lt;/code> 文件，用 &lt;code>jd-gui&lt;/code> 工具打开后可以看到 &lt;code>com.lohan.crackme0a&lt;/code> 包。打开 &lt;code>Main.class&lt;/code> ，可看到其中的 &lt;code>onClick()&lt;/code> 函数&lt;/p>
&lt;/div>
&lt;div class="imageblock">
&lt;div class="content">
&lt;img src="./src.png" alt="onClick函数"/>
&lt;/div>
&lt;div class="title">Figure 1. onClick()函数&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>破解的方法一目了然：只要我们不让程序进入到图中 &lt;code>if&lt;/code> 分支内部即可。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>破解的关键在于 &lt;code>if-nez&lt;/code> 指令。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>打开 &lt;code>smali/com/lohan/crackme0a/Main.smali&lt;/code> 文件，搜索 &lt;code>if-nez&lt;/code> 指令&lt;/p>
&lt;/div>
&lt;div class="imageblock">
&lt;div class="content">
&lt;img src="./smali.png" alt="Main.smali代码"/>
&lt;/div>
&lt;div class="title">Figure 2. Main.smali 代码&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>将光标选中高亮的代码行改成 &lt;code>goto :cond_0&lt;/code> ，这样整个破解代码工作就完成了。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>当修改完 &lt;code>smali&lt;/code> 文件的代码后，接下来就可以将修改后的文件重新编译并打包成apk文件。编译apk文件的命令格式为：&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>apktool b[uild] [options] [&amp;lt;app_path&amp;gt;] -o [&amp;lt;out_file&amp;gt;]&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>执行：&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>apktool b crackme2/ -o crackme2-unsigned.apk&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>因为现在编译生成的 &lt;code>crackme2-unsigned.apk&lt;/code> 格式还没有签名，所以不能进行安装并测试，接下来需要对 apk 文件进行签名。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>签名的方法有很多种。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>可以通过 &lt;code>signapk.jar&lt;/code> 进行签名。 &lt;code>signapk.jar&lt;/code> 工具是Android源码目录下的 &lt;code>build/tools/signapk/Signapk.java&lt;/code> 文件中实现的，源码编译后可以在 &lt;code>out/host/linux-x86/framework&lt;/code> 目录中找到。使用 &lt;code>signapk.jar&lt;/code> 签名时需要提供签名文件，可以使用 Android 源码中提供的签名文件 &lt;code>testkey .pk8&lt;/code> 和 &lt;code>testkey.x509.pem&lt;/code> 这两个文件位于Android源码的 &lt;code>build/target/product/security&lt;/code> 目录中。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>也可以通过 &lt;code>jarsigner&lt;/code> 进行签名。
可以使用 &lt;code>keytool&lt;/code> 生成自签名证书，命令如下：&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>keytool -genkey -alias android.keystore -keyalg RSA -validity 20000 -keystore android.keystore&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>然后使用 &lt;code>jarsigner&lt;/code> 对 apk 进行签名，命令&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>jarsigner -verbose -keystore android.keystore -signedjar crackme2-selfsigned.apk crackme2-unsigned.apk android.keystore&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>打开 Android Studio 中的AVD Manager， 启动Android虚拟机。
通过 &lt;code>adb devices&lt;/code> 确认设备可用，通过 &lt;code>adb install crackme2-selfsigned.apk&lt;/code> 安装&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>打开app，验证破解成功。&lt;/p>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./yz-1.png" alt="输入任意字符串"/>
&lt;/div>
&lt;div class="title">Figure 3. 输入任意字符串&lt;/div>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./yz-2.png" alt="验证成功"/>
&lt;/div>
&lt;div class="title">Figure 4. 验证成功&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="sect1">
&lt;h2 id="_注册机开发">注册机开发&lt;/h2>
&lt;div class="sectionbody">
&lt;div class="sect2">
&lt;h3 id="_软件破解_2">软件破解&lt;/h3>
&lt;div class="paragraph">
&lt;p>类似之前的步骤，通过 &lt;code>unzip&lt;/code> 得到 dex 文件后通过 &lt;code>dex2jar&lt;/code> 工具得到 jar 包，在 &lt;code>jd-gui&lt;/code> 中查看反编译得到的源码。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>通过搜索特定的字符串找到关键函数。比如，我通过搜索 &lt;code>Registerd successfully\nPlease write Tutorial How Found key?!&lt;/code> 字符串找到了函数 &lt;code>_check_code()&lt;/code> ，只有当 &lt;code>_check_code()&lt;/code> 返回真时才会有注册成功的消息提示。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>通过 &lt;code>apktool&lt;/code> 工具将 &lt;code>crackme.apk&lt;/code> 反编译，打开 &lt;code>crackme/smali/Com/zAWS/KeygenMe/main.smali&lt;/code> ，搜索 &lt;code>_check_code()&lt;/code> ，（1680行）。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>通过分析源码可以发现， &lt;code>_check_code&lt;/code> 函数中有4处返回 &lt;code>false&lt;/code> 最后一处返回 &lt;code>true&lt;/code>&lt;/p>
&lt;/div>
&lt;div class="imageblock">
&lt;div class="content">
&lt;img src="./checkcode.png" alt="_check_code()函数"/>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>对应 &lt;code>main.smali&lt;/code> 文件中第1809、1828、1857、1870行的 &lt;code>goto: goto_0&lt;/code> 指令。&lt;/p>
&lt;/div>
&lt;div class="imageblock">
&lt;div class="content">
&lt;img src="./goto-1.png" alt="goto-1"/>
&lt;/div>
&lt;/div>
&lt;div class="imageblock">
&lt;div class="content">
&lt;img src="./goto-2.png" alt="goto-2"/>
&lt;/div>
&lt;/div>
&lt;div class="imageblock">
&lt;div class="content">
&lt;img src="./goto-3.png" alt="goto-3"/>
&lt;/div>
&lt;/div>
&lt;div class="imageblock">
&lt;div class="content">
&lt;img src="./goto-4.png" alt="goto-4"/>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>前三个在执行 &lt;code>goto :goto_0&lt;/code> 之前均执行 &lt;code>move v0, v5&lt;/code> ，把 &lt;code>v5&lt;/code> 中的内容复制到 &lt;code>v0&lt;/code> ；而最后一个在执行 &lt;code>goto :goto_0&lt;/code> 之前执行的是 &lt;code>move v0, v6&lt;/code> ，把 &lt;code>v6&lt;/code> 中的内容复制到了 &lt;code>v0&lt;/code>&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>&lt;code>goto_0&lt;/code> 处的指令仅仅是返回 &lt;code>v0&lt;/code> 中的值。如图：&lt;/p>
&lt;/div>
&lt;div class="imageblock">
&lt;div class="content">
&lt;img src="./goto0.png" alt="goto0"/>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>所以我判断前三个 &lt;code>goto&lt;/code> 指令对应于 &lt;code>return false&lt;/code> ，最后的 &lt;code>goto&lt;/code> 指令对应于 &lt;code>return true&lt;/code>&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>查看 &lt;code>v5&lt;/code> 和 &lt;code>v6&lt;/code> 中的内容：&lt;/p>
&lt;/div>
&lt;div class="imageblock">
&lt;div class="content">
&lt;img src="./v5v6.png" alt="v5v6"/>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>根据上面的分析，我们有充分的理由认为将 &lt;code>v5&lt;/code> 中的内容改为 &lt;code>0x1&lt;/code> 后， &lt;code>_check_code&lt;/code> 函数将永远返回 &lt;code>true&lt;/code> ，进而达到注册成功的效果。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>通前面一样，作了更改后通过&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>apktool b crackme/ -o crackme-unsigned.apk&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>重新编译，再通过&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>jarsigner -verbose -keystore android.keystore -signedjar crackme-selfsigned.apk crackme-unsigned.apk android.keystore&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>进行自签名。通过&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>adb install crackme-selfsigned.apk&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>安装后运行验证&lt;/p>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./crackme-selfsigned.png" alt="破解成功"/>
&lt;/div>
&lt;div class="title">Figure 5. 破解成功&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="sect2">
&lt;h3 id="_注册机开发_2">注册机开发&lt;/h3>
&lt;div class="paragraph">
&lt;p>注册机开发实质上就是将前面提到的 &lt;code>_check_code()&lt;/code> 函数的机理分析清楚。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>错误的注册码会进入使程序在 &lt;code>_check_code()&lt;/code> 时进入前4个 &lt;code>if&lt;/code> 语句，折戟沉沙；我们要想办法是程序跳过前四个 &lt;code>if&lt;/code> 语句。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>下面我将从头至尾详细分析代码内容，分析的过程也是我思考和实验的过程。&lt;/p>
&lt;/div>
&lt;div class="sect3">
&lt;h4 id="_readfile_函数">&lt;code>_readfile()&lt;/code> 函数&lt;/h4>
&lt;div class="paragraph">
&lt;p>单看可能一头雾水，但联系后面的 &lt;code>_decrypt()&lt;/code> 函数——由于 &lt;code>_readfile()&lt;/code> 的结果传给了 &lt;code>_decrypt()&lt;/code> 进行解密，我们猜其中应该是密文。&lt;/p>
&lt;/div>
&lt;div class="listingblock">
&lt;div class="title">main.java&lt;/div>
&lt;div class="content">
&lt;pre class="prettyprint highlight">&lt;code data-lang="java">public static String _readfile() throws Exception {
File file = Common.File;
String str = (file = Common.File).getDirInternal();
main main1 = mostCurrent;
if (File.Exists(str, _file_name)) {// &lt;b class="conum">(1)&lt;/b>
File.TextReaderWrapper textReaderWrapper = new File.TextReaderWrapper();
File file1 = Common.File;
String str1 = (file1 = Common.File).getDirInternal();
main main2 = mostCurrent;
textReaderWrapper.Initialize((InputStream)File.OpenInput(str1, _file_name).getObject());// &lt;b class="conum">(2)&lt;/b>
str1 = textReaderWrapper.ReadLine();
textReaderWrapper.Close();
return str1;// &lt;b class="conum">(3)&lt;/b>
}
return &amp;#34;&amp;#34;;
}&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="colist arabic">
&lt;ol>
&lt;li>
&lt;p>读取 &lt;code>_file_name&lt;/code> 文件&lt;/p>
&lt;/li>
&lt;li>
&lt;p>打开 &lt;code>_file_name&lt;/code> 文件&lt;/p>
&lt;/li>
&lt;li>
&lt;p>以字符串的形式返回文件内容。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div>
&lt;div class="paragraph">
&lt;p>我们搜索 &lt;code>_file_name&lt;/code> ，发现其被赋值为 &lt;code>key.txt&lt;/code> ，后续步骤中我们会通过 &lt;code>adb shell&lt;/code> 来查看其中的内容。&lt;/p>
&lt;/div>
&lt;/div>
&lt;div class="sect3">
&lt;h4 id="_decrypt_函数和_encrypt_函数">&lt;code>_decrypt()&lt;/code> 函数和 &lt;code>_encrypt()&lt;/code> 函数&lt;/h4>
&lt;div class="paragraph">
&lt;p>&lt;code>_decrypt()&lt;/code> 函数，顾名思义是进行解密操作，解密的前提是加密，所以我们这里把加解密对照着看。由于反编译出的代码依赖于 &lt;code>B2A&lt;/code> 库，这里我放入我修改后的代码。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>先看加密函数：&lt;/p>
&lt;/div>
&lt;div class="listingblock">
&lt;div class="title">main.java&lt;/div>
&lt;div class="content">
&lt;pre class="prettyprint highlight">&lt;code data-lang="java">public static String _encrypt(String paramString1, String paramString2) throws Exception{
byte[] arrayOfByte2 = _bconv.HexToBytes(_made_key());
byte[] arrayOfByte1 = _bconv.StringToBytes(paramString1 + &amp;#34;zAWS!&amp;#34;, &amp;#34;UTF8&amp;#34;);
CipherWrapper.KeyGeneratorWrapper keyGeneratorWrapper = new CipherWrapper.KeyGeneratorWrapper();
CipherWrapper cipherWrapper = new CipherWrapper();
cipherWrapper.Initialize(&amp;#34;DES/ECB/NoPadding&amp;#34;);
keyGeneratorWrapper.Initialize(&amp;#34;DES&amp;#34;);
keyGeneratorWrapper.KeyFromBytes(arrayOfByte2);
arrayOfByte1 = cipherWrapper.Encrypt(arrayOfByte1, keyGeneratorWrapper.getKey(), false);
return bytesToHex(arrayOfByte1);// &lt;b class="conum">(1)&lt;/b>
}&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="colist arabic">
&lt;ol>
&lt;li>
&lt;p>与反编译的代码不同，原始程序中此处是将解密结果写入 &lt;code>key.txt&lt;/code> 文件，返回空串；在我的注册机中就没必要这么做了。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div>
&lt;div class="paragraph">
&lt;p>浏览代码可知加密操作使用了ECB模式的DES加密方案，这个方案的实现是需要第三方库的。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>在 &lt;code>anywheresoftware.b4a.agraham.encryption&lt;/code> 包中可以找到其中 &lt;code>CipherWrapper&lt;/code> 类的实现。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>简便起见，我们可以将这个类整个复制一份到我们的注册机项目中。具体过程很简单，注意修改包名及删除annotation即可。此处不再展示修改过后的内容。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>下面来看 &lt;code>_decrypt()&lt;/code> 函数&lt;/p>
&lt;/div>
&lt;div class="listingblock">
&lt;div class="title">main.java&lt;/div>
&lt;div class="content">
&lt;pre class="prettyprint highlight">&lt;code data-lang="java">public static String _decrypt(String paramString) throws Exception {
byte[] arrayOfByte2 = HexToBytes(_made_key());
byte[] arrayOfByte1 = HexToBytes(paramString);
CipherWrapper.KeyGeneratorWrapper keyGeneratorWrapper = new CipherWrapper.KeyGeneratorWrapper();
CipherWrapper cipherWrapper = new CipherWrapper();
cipherWrapper.Initialize(&amp;#34;DES/ECB/NoPadding&amp;#34;);
keyGeneratorWrapper.Initialize(&amp;#34;DES&amp;#34;);
keyGeneratorWrapper.KeyFromBytes(arrayOfByte2);
arrayOfByte1 = cipherWrapper.Decrypt(arrayOfByte1, keyGeneratorWrapper.getKey(), false);
return _bconv.StringFromBytes(arrayOfByte1, &amp;#34;UTF8&amp;#34;).substring(0, 11);// &lt;b class="conum">(1)&lt;/b>
}&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="colist arabic">
&lt;ol>
&lt;li>
&lt;p>返回值是长度为11的字符串&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div>
&lt;div class="admonitionblock tip">
&lt;table>
&lt;tbody>&lt;tr>
&lt;td class="icon">
&lt;div class="title">Tip&lt;/div>
&lt;/td>
&lt;td class="content">
正确解密后的结果应该是我们输入 &lt;code>Activate&lt;/code> 对话框的11位数（再经过一个简单重排列）
&lt;/td>
&lt;/tr>
&lt;/tbody>&lt;/table>
&lt;/div>
&lt;div class="paragraph">
&lt;p>比较加密，解密过程，发现两者均需要调用 &lt;code>_made_key()&lt;/code> 函数，因而我们需要分析 &lt;code>_made_key()&lt;/code> 函数&lt;/p>
&lt;/div>
&lt;/div>
&lt;div class="sect3">
&lt;h4 id="_made_key_函数">&lt;code>_made_key()&lt;/code> 函数&lt;/h4>
&lt;div class="listingblock">
&lt;div class="title">反编译结果&lt;/div>
&lt;div class="content">
&lt;pre class="prettyprint highlight">&lt;code data-lang="java">public static String _made_key() throws Exception {
main main1 = mostCurrent;
String str1 = _imei.substring(0, 2);
main main2 = mostCurrent;
String str2 = _imei;
main main3 = mostCurrent;
int i = _imei.length();
main3 = mostCurrent;
str2 = str2.substring(i - 2, _imei.length());
StringBuilder stringBuilder = (new StringBuilder()).append(str1);
main3 = mostCurrent;
return stringBuilder.append(_mac_address).append(str2).toString();
}&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="listingblock">
&lt;div class="title">修改后的代码&lt;/div>
&lt;div class="content">
&lt;pre class="prettyprint highlight">&lt;code data-lang="java">public static String _made_key() {
String str1 = IMEI_String.substring(0, 2);
String str2 = IMEI_String;
int i = IMEI_String.length();
str2 = str2.substring(i - 2, IMEI_String.length());
StringBuilder stringBuilder = (new StringBuilder()).append(str1);
return stringBuilder.append(MAC_String).append(str2).toString();
}&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>讲到这里，需要介绍一下我引入的两个全局变量：&lt;/p>
&lt;/div>
&lt;div class="listingblock">
&lt;div class="content">
&lt;pre class="prettyprint highlight">&lt;code data-lang="java">public static String IMEI_String;
public static String MAC_String;&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>顾名思义是IMEI标识和MAC地址，均为 &lt;code>String&lt;/code> 类型。两个重要参数的取值过程在下面会详细介绍。
除此之外，我还删去了莫名其妙的 &lt;code>mostCurrent&lt;/code> 赋值语句。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>分析和修改至此，我们需要暂且放慢脚步，验证一下我们所做的推断和所修改的代码都是正确的。下面我将以验证 &lt;code>_made_key()&lt;/code> 函数的正确性为例，介绍我所用的调试方法。&lt;/p>
&lt;/div>
&lt;/div>
&lt;div class="sect3">
&lt;h4 id="_验证工作打印字符串">验证工作：打印字符串&lt;/h4>
&lt;div class="paragraph">
&lt;p>前文提到， &lt;code>_encrypt()&lt;/code> 函数将计算结果写入了 &lt;code>key.txt&lt;/code> 文件。回想到老师上课所讲，Android 应用安装后资源文件、运行时所需的 lib库、启动加载的配置文件的存放路径是 &lt;code>/data/data/&amp;lt;包名&amp;gt;&lt;/code> 我们不禁思索：能不能通过 &lt;code>adb shell&lt;/code> 查看 &lt;code>key.txt&lt;/code> 中的内容呢？&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>打开 Android Studio 的 AVD Manager，启动虚拟机。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>在终端输入&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>adb root&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>以root权限启动adb shell，输入&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>adb shell&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>进入模拟器手机终端。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>切换目录到 &lt;code>/data/data/Com.zAWS.KeygenMe&lt;/code>&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>&lt;code>ls&lt;/code> 列出目录名发现有 &lt;code>files&lt;/code> 文件夹&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>进入后看到 &lt;code>key.txt&lt;/code> ，通过&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>cat key.txt&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>查看其中内容。&lt;/p>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./key.png" alt="key.txt文件"/>
&lt;/div>
&lt;div class="title">Figure 6. 查看key.txt文件(图是后截的，图中的内容其实就是我这台手机成功注册的key)&lt;/div>
&lt;/div>
&lt;div class="admonitionblock tip">
&lt;table>
&lt;tbody>&lt;tr>
&lt;td class="icon">
&lt;div class="title">Tip&lt;/div>
&lt;/td>
&lt;td class="content">
能不能利用同样的机制打印出我们想查看的字符串呢？
&lt;/td>
&lt;/tr>
&lt;/tbody>&lt;/table>
&lt;/div>
&lt;div class="paragraph">
&lt;p>查看 &lt;code>main.smali&lt;/code> 文件，找到 &lt;code>_encrypt()&lt;/code> 函数，其中调用 &lt;code>_write2file()&lt;/code> 函数的语句如下：&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>invoke-static {v0}, LCom/zAWS/KeygenMe/main;-&amp;gt;_write2file(Ljava/lang/String;)Ljava/lang/String;&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>该函数只接收一个参数（上面的 &lt;code>v0&lt;/code> ），该参数指定要打印的字符串。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>然而，如果我们仅仅利用上面一条语句是不够的。因为 &lt;code>_write2file()&lt;/code> 函数默认写入 &lt;code>_file_name&lt;/code> 文件。而 &lt;code>_file_name&lt;/code> 的值一直是 &lt;code>key.txt&lt;/code> 。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>因此我们需要更改 &lt;code>_file_name&lt;/code> 的值。具体方法也是找到 &lt;code>main.smali&lt;/code> 中的对应的语句分析其各参数和条用过程。最终得到了一个行之有效的方法：&lt;/p>
&lt;/div>
&lt;div class="listingblock">
&lt;div class="title">main.smali&lt;/div>
&lt;div class="content">
&lt;pre class="prettyprint highlight">&lt;code data-lang="smali"> #output _made_key -------------------------
const-string v6, &amp;#34;made_key.txt&amp;#34;
sput-object v6, LCom/zAWS/KeygenMe/main;-&amp;gt;_file_name:Ljava/lang/String;
invoke-static {v1}, LCom/zAWS/KeygenMe/main;-&amp;gt;_write2file(Ljava/lang/String;)Ljava/lang/String;
const-string v6, &amp;#34;key.txt&amp;#34;
sput-object v6, LCom/zAWS/KeygenMe/main;-&amp;gt;_file_name:Ljava/lang/String;
#output _made_key -------------------------&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>前两条命令将 &lt;code>_file_name&lt;/code> 改为 &lt;code>made_key.txt&lt;/code> ，调用 &lt;code>_write2file()&lt;/code> 后再将 &lt;code>_file_name&lt;/code> 改回 &lt;code>key.txt&lt;/code> 。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>注意，其中的 &lt;code>v6&lt;/code> 寄存器是我新增加的寄存器，所以需要将 &lt;code>.locals&lt;/code> 命令后参数加1。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>将上述代码添加到&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>invoke-static {}, LCom/zAWS/KeygenMe/main;-&amp;gt;_made_key()Ljava/lang/String;
move-result-object v1&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>之后即可打印 &lt;code>v1&lt;/code> 中的内容，查看 &lt;code>_made_key()&lt;/code> 调用结果。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>按照上述方法修改过main.smali后通过和前面软件破解一致的“重新打包、签名、安装”三步，即可运行软件查看 &lt;code>_made_key()&lt;/code> 调用结果。&lt;/p>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./made_key.png" alt="made_key结果"/>
&lt;/div>
&lt;div class="title">Figure 7. 查看 &lt;code>_made_key()&lt;/code> 调用结果&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>以上过程所叙述的调试方法就是我这次逆向过程的“瑞士军刀”，是保证我重新实现的函数与原程序中完全一致的关键所在。&lt;/p>
&lt;/div>
&lt;/div>
&lt;div class="sect3">
&lt;h4 id="_imei和mac的获取">IMEI和MAC的获取&lt;/h4>
&lt;div class="paragraph">
&lt;p>在原程序中，IMEI通过&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>_imei = (phoneId = mostCurrent._myphone).GetDeviceId();&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>获取；MAC通过&lt;/p>
&lt;/div>
&lt;div class="literalblock">
&lt;div class="content">
&lt;pre>_mac_address = (mostCurrent._mywifi.ABGetCurrentWifiInfo()).MacAddress;&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>获取。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>事实上，我们用户都熟知，可以通过拨号盘输入“*#06#”获取IMEI，可以通过查看WiFi信息来获取MAC码。&lt;/p>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./imei.png" alt="获取IMEI，结果为358240051111110" width="60"/>
&lt;/div>
&lt;div class="title">Figure 8. 获取IMEI，结果为358240051111110&lt;/div>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./mac.png" alt="获取MAC，结果为0215b2000000" width="60"/>
&lt;/div>
&lt;div class="title">Figure 9. 获取MAC，结果为0215b2000000&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>在我一开始的设计中，由用户手动将IMEI和MAC写入注册机，点击“Compute” 按钮后计算出结果显示在“RegCode”一栏。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>后面为了更自动化，我在程序中加入自动获取IMEI和MAC码的功能。&lt;/p>
&lt;/div>
&lt;div class="sect4">
&lt;h5 id="_小插曲">小插曲：&lt;/h5>
&lt;div class="paragraph">
&lt;p>在调试过程中，我发现原程序获得的MAC地址与模拟器实际显示的不一致&lt;/p>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./check-mac.png" alt="查看原程序获取到的MAC地址"/>
&lt;/div>
&lt;div class="title">Figure 10. 查看原程序获取到的MAC地址&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>程序获得的MAC地址是 &lt;code>02:00:00:00:00:00&lt;/code> 实际是 &lt;code>02:15:b2:00:00:00&lt;/code>&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>简而言之，原因是我的模拟器版本高于Android 6.0（M）由于Android 6.0 之后对于用户隐私的保护，将不再能通过 &lt;code>WifiManager&lt;/code> 获取MAC，获取到的MAC将是固定的： &lt;code>02:00:00:00:00:00&lt;/code> 。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>详细分析原程序获取MAC的过程可以看到它正是通过 &lt;code>WifiManager&lt;/code> 获取的MAC地址。&lt;/p>
&lt;/div>
&lt;div class="listingblock">
&lt;div class="title">ABWifi.java中的ABLoadWifi函数&lt;/div>
&lt;div class="content">
&lt;pre class="prettyprint highlight">&lt;code data-lang="java">WifiInfo wifiInfo = this.wifi.getConnectionInfo();// &lt;b class="conum">(1)&lt;/b>
String str1 = str2;
if (wifiInfo != null) {
this._CurrentWifiInfo.BSSID = wifiInfo.getBSSID();
this._CurrentWifiInfo.MacAddress = wifiInfo.getMacAddress();// &lt;b class="conum">(2)&lt;/b>
this._CurrentWifiInfo.FullString = wifiInfo.toString();
//...&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="colist arabic">
&lt;ol>
&lt;li>
&lt;p>&lt;code>wifi&lt;/code> 是 &lt;code>WifiManager&lt;/code> 对象&lt;/p>
&lt;/li>
&lt;li>
&lt;p>通过 &lt;code>WifiInfo&lt;/code> 的 &lt;code>getMacAddress()&lt;/code> 获取到MAC地址&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div>
&lt;div class="paragraph">
&lt;p>但这其实也简化了我编程的难度。我也只需要通过 &lt;code>WifiManager&lt;/code> 获取MAC即可，不用考虑更高版本的适配了。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>IMEI的获取方式较为类似，是通过 &lt;code>TelephonyManager&lt;/code> 的 &lt;code>getimei()&lt;/code> 或 &lt;code>getDeviceId()&lt;/code> 函数得到的。 &lt;code>getDeviceId()&lt;/code> 在Android 8.0 （O）及以上就被标明弃用了，改用 &lt;code>getimei()&lt;/code> 函数，不过在模拟器中，原程序能够获得正确的IMEI。&lt;/p>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./check-imei.png" alt="查看原程序获取到的IMEI地址" width="75%"/>
&lt;/div>
&lt;div class="title">Figure 11. 查看原程序获取到的IMEI地址&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="sect3">
&lt;h4 id="_calculate_codes_fix_imei_及_get_correct_code_函数">&lt;code>_calculate_codes()&lt;/code> ， &lt;code>_fix_imei()&lt;/code> 及 &lt;code>_get_correct_code()&lt;/code> 函数&lt;/h4>
&lt;div class="paragraph">
&lt;p>在 &lt;code>_check_code()&lt;/code> 函数中，出去前面分析过的 &lt;code>_decrypt()&lt;/code> 函数外，就是 &lt;code>_calculate_codes()&lt;/code> ， &lt;code>_fix_imei()&lt;/code> 及 &lt;code>_get_correct_code()&lt;/code> 函数构成了主要部分。分析过程与前文中 &lt;code>_made_key()&lt;/code> 函数的分析相同：先通过反编译的Java代码重新实现一遍对应的函数，再在原程序和注册机程序中输入相同的内容进行检验，原程序通过在smali代码中添加调试输出语句在 &lt;code>adb shell&lt;/code> 中进行字符串的查看，注册机输出到 &lt;code>RegCode&lt;/code> 右边的TextView中（当时截图时是TextView，现在我已经把这个改成了EditText方便复制，不过这些都是小细节了）,若输出一致，基本上可以判断重新实现的函数是正确的。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>下面进行具体分析：&lt;/p>
&lt;/div>
&lt;div class="sect4">
&lt;h5 id="_decrypt_和_encrypt_函数的分析检验">&lt;code>_decrypt()&lt;/code> 和 &lt;code>_encrypt()&lt;/code> 函数的分析检验。&lt;/h5>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./check-key-2.png" alt="check key 2" width="75%"/>
&lt;/div>
&lt;div class="title">Figure 12. &lt;code>_encrypt()&lt;/code> 函数，注册机检验输出的语句，输入为11个1&lt;/div>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./check-key.png" alt="check key" width="50%"/>
&lt;/div>
&lt;div class="title">Figure 13. &lt;code>_encrypt()&lt;/code> 函数输出对比&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>输出的内容是一致的。&lt;/p>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./check-decrypt-2.png" alt="check decrypt 2" width="75%"/>
&lt;/div>
&lt;div class="title">Figure 14. &lt;code>_decrypt()&lt;/code> 函数，注册机检验输出的语句，先加密在解密，加密输入为11个1&lt;/div>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./check-decrypt.png" alt="check decrypt" width="50%"/>
&lt;/div>
&lt;div class="title">Figure 15. &lt;code>_decrypt()&lt;/code> 函数输出&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>成功将输入的字符串（11个1）解密&lt;/p>
&lt;/div>
&lt;/div>
&lt;div class="sect4">
&lt;h5 id="_calculate_codes_和_fix_imei_的检验">&lt;code>_calculate_codes()&lt;/code> 和 &lt;code>_fix_imei()&lt;/code> 的检验&lt;/h5>
&lt;div class="paragraph">
&lt;p>（说一个细节：反编译出的代码中“calculate”一词拼写错误，我后续做了修改）&lt;/p>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./check-str1-2.png" alt="check str1 2" width="75%"/>
&lt;/div>
&lt;div class="title">Figure 16. &lt;code>_calculate_codes(_fix_imei(true))&lt;/code> 的结果（即 &lt;code>str1&lt;/code> ）注册机检验输出的语句&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>注意到我截图时加上了前面的 &lt;code>_array_p1&lt;/code> 初始化赋值语句，这很重要，否则计算失败。&lt;/p>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./check-str1.png" alt="check str1" width="50%"/>
&lt;/div>
&lt;div class="title">Figure 17. &lt;code>_calculate_codes(_fix_imei(true))&lt;/code> 的结果（即 &lt;code>str1&lt;/code> ）输出结果对比&lt;/div>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./check-str2-2.png" alt="check str2 2" width="75%"/>
&lt;/div>
&lt;div class="title">Figure 18. &lt;code>_calculate_codes(_fix_imei(false))&lt;/code> 的结果（即 &lt;code>str2&lt;/code> ）注册机检验输出的语句&lt;/div>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./check-str2.png" alt="check str2" width="50%"/>
&lt;/div>
&lt;div class="title">Figure 19. &lt;code>_calculate_codes(_fix_imei(false))&lt;/code> 的结果（即 &lt;code>str2&lt;/code> ）输出结果对比&lt;/div>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./check-key_from_imei_number-2.png" alt="{75-width}"/>
&lt;/div>
&lt;div class="title">Figure 20. key_from_imei_number检验&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>这个字符串容易被忽略，我在下面用 &lt;code>s_imei&lt;/code> 表示 &lt;code>_key_from_imei_number&lt;/code> 转成的字符串。&lt;/p>
&lt;/div>
&lt;div class="imageblock text-center">
&lt;div class="content">
&lt;img src="./check-key_from_imei_number.png" alt="check key from imei number" width="50%"/>
&lt;/div>
&lt;div class="title">Figure 21. key_from_imei_number检验&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="sect4">
&lt;h5 id="_get_correct_code_函数分析">&lt;code>_get_correct_code()&lt;/code> 函数分析&lt;/h5>
&lt;div class="listingblock">
&lt;div class="content">
&lt;pre class="prettyprint highlight">&lt;code data-lang="java">public static String _get_correct_code(String paramString){
String str1 = paramString.substring(0, 5);//0,1,2,3,4
String str2 = paramString.substring(paramString.length() - 5);//6,7,8,9,10
paramString = paramString.substring(5, 6);//5
return paramString + str2 + str1;//5,6,7,8,9,10,0,1,2,3,4
}&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>这个函数非常简单，一目了然，就是将输入的字符串（ &lt;code>str3&lt;/code> ,长度是11）从第六个字符（下标是5）开始一直到最后一个字符形成的子串拿到前面来，即：按照下标为5,6,7,8,9,10,0,1,2,3,4的顺序重新排列。&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="sect3">
&lt;h4 id="_收尾工作">收尾工作&lt;/h4>
&lt;div class="paragraph">
&lt;p>分析至此，我们的工作已经基本成功了。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>在 &lt;code>_check_code&lt;/code> 中的三个if条件告诉了我们如何组合几个字符串能满足成功注册的条件&lt;/p>
&lt;/div>
&lt;div class="listingblock">
&lt;div class="title">_check_code() 函数&lt;/div>
&lt;div class="content">
&lt;pre class="prettyprint highlight">&lt;code data-lang="java">if (!str3.substring(0, 1).equalsIgnoreCase(stringBuilderWrapper.Append(BA.NumberToString(_key_from_imei_number)).ToString().valueOf(stringBuilderWrapper)))
return false;
if (!str3.substring(1, 6).equalsIgnoreCase(str1))
return false;
if (!str3.substring(str3.length() - 5, str3.length()).equalsIgnoreCase(str2))
return false;&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="listingblock">
&lt;div class="title">最终我的注册机核心代码&lt;/div>
&lt;div class="content">
&lt;pre class="prettyprint highlight">&lt;code data-lang="java">String str1,str2,str3,s_imei;
str1 = _calculate_codes(_fix_imei(true));
str2 = _calculate_codes(_fix_imei(false));
s_imei = NumberToString(_key_from_imei_number);
str3 = s_imei+str1+str2;
str3 = _recombine_code(str3);
TW_RegCodeText.setText(str3);&lt;/code>&lt;/pre>
&lt;/div>
&lt;/div>
&lt;div class="paragraph">
&lt;p>其中 &lt;code>str3&lt;/code> 用以表示结果（即用户应输入的11位数字的注册码），其它的各变量和函数的含义在上面均以详细讲述过了。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>最后的效果是成功注册，小黄锁打开了。图我就不上了，因为和前面软件破解后的效果一样。&lt;/p>
&lt;/div>
&lt;div class="paragraph">
&lt;p>但我录了一个小视频， &lt;code>success.gif&lt;/code>&lt;/p>
&lt;/div>
&lt;div class="imageblock">
&lt;div class="content">
&lt;img src="./success.gif" alt="success.gif"/>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;div class="sect1">
&lt;h2 id="_文件夹内容说明">文件夹内容说明&lt;/h2>
&lt;div class="sectionbody">
&lt;div class="olist arabic">
&lt;ol class="arabic">
&lt;li>
&lt;p>&lt;code>crackme2-selfsigned.apk&lt;/code> 文件是第一题软件破解后自签名程序&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>Reg.apk&lt;/code> 文件是第二题的注册机程序&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>pic&lt;/code> 目录中包含本文中的所有图片&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>success.gif&lt;/code> 文件是注册机使用效果录屏&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>Reg&lt;/code> 目录下是注册机项目源码&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div>
&lt;/div>
&lt;/div></description></item><item><title>归档</title><link>https://cld4h.github.io/blog/zh-cn/archives/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://cld4h.github.io/blog/zh-cn/archives/</guid><description/></item><item><title>搜索</title><link>https://cld4h.github.io/blog/zh-cn/search/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://cld4h.github.io/blog/zh-cn/search/</guid><description/></item></channel></rss>
<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Fake-Ip on cld4h çš„åšå®¢</title><link>https://cld4h.github.io/blog/zh-cn/tags/fake-ip/</link><description>Recent content in Fake-Ip on cld4h çš„åšå®¢</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Wed, 04 May 2022 16:19:40 +0800</lastBuildDate><atom:link href="https://cld4h.github.io/blog/zh-cn/tags/fake-ip/index.xml" rel="self" type="application/rss+xml"/><item><title>Linux ä¸‹çš„ã€Œå…¨è¿‡ç¨‹ç¿»å¢™ã€</title><link>https://cld4h.github.io/blog/zh-cn/p/linux-%E4%B8%8B%E7%9A%84%E5%85%A8%E8%BF%87%E7%A8%8B%E7%BF%BB%E5%A2%99/</link><pubDate>Wed, 04 May 2022 16:19:40 +0800</pubDate><guid>https://cld4h.github.io/blog/zh-cn/p/linux-%E4%B8%8B%E7%9A%84%E5%85%A8%E8%BF%87%E7%A8%8B%E7%BF%BB%E5%A2%99/</guid><description>&lt;img src="https://cld4h.github.io/blog/p/the-ultimate-way-to-bypass-gfw-on-linux/iptables.webp" alt="Featured image of post Linux ä¸‹çš„ã€Œå…¨è¿‡ç¨‹ç¿»å¢™ã€" />&lt;p>æœ¬æ–‡å±•ç¤ºäº†åœ¨Linuxä¸‹ä½¿ç”¨clashå’Œiptablesæ­å»ºé€æ˜ä»£ç†è¿›è¡Œç¿»å¢™çš„æ­¥éª¤&lt;/p>
&lt;p>æˆ‘ä»¬ç”¨åˆ°äº†&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/Dreamacro/clash" target="_blank" rel="noopener"
>clash&lt;/a> ä½œä¸ºä»£ç†ç¨‹åº&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/tindy2013/subconverter" target="_blank" rel="noopener"
>online subconverter&lt;/a> å’Œ crontab æ¥å®šæœŸæ›´æ–°é…ç½®æ–‡ä»¶&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/ACL4SSR/ACL4SSR/tree/master" target="_blank" rel="noopener"
>ACL4SSR&lt;/a> æ¥æä¾›GFWå±è”½åŸŸåè§„åˆ™&lt;/li>
&lt;/ul>
&lt;p>ä½ å¯ä»¥ä» &lt;a class="link" href="https://gist.github.com/cld4h/9a03ec2f826a25be5ab974fdbc540de4" target="_blank" rel="noopener"
>github gist&lt;/a> æ¥ä¸‹è½½æœ¬æ–‡ä¸­æåˆ°çš„æ–‡ä»¶ã€‚&lt;/p>
&lt;p>é…ç½®æ‰€éœ€çš„å…¨éƒ¨æ–‡ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ clash-base-config.yaml ---ğŸŸ¢clashçš„åŸºç¡€é…ç½®ä»¥ä½¿å…¶å·¥ä½œåœ¨tproxyå’Œfake-ipæ¨¡å¼
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ clash.service ---ğŸŸ¢systemd é…ç½®æ–‡ä»¶
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ clean.sh ---ğŸŸ¢æ¸…ç†iptablesçš„è„šæœ¬
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ config.ini ---ğŸŸ¢subconverterçš„é…ç½®æ–‡ä»¶
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ iptables.sh ---ğŸŸ¢iptablesé…ç½®æ–‡ä»¶
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ update-config.sh ---ğŸŸ¡è®¢é˜…æ›´æ–°è„šæœ¬; é¡»å°†&amp;#34;XXXXXXXX&amp;#34;æ›¿æ¢æˆä½ çš„è®¢é˜…åœ°å€
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ config.yaml ---â­•clash é…ç½®æ–‡ä»¶, é¡»ä»update-config.shç”Ÿæˆ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”œâ”€â”€ README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â””â”€â”€ README.zh-cn.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ğŸŸ¢: æ— éœ€ä¿®æ”¹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ğŸŸ¡: éœ€è¦ä¿®æ”¹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â­•: éœ€è¦ç”Ÿæˆ
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å‚è€ƒ">å‚è€ƒ
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.sobyte.net/post/2022-02/clash-tproxy/" target="_blank" rel="noopener"
>clash-tproxy&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://git.breakpoint.cc/cgit/fw/tcprdr.git" target="_blank" rel="noopener"
>Transparent proxy demo code&lt;/a>&lt;/p>
&lt;h2 id="å‡†å¤‡æ¡ä»¶">å‡†å¤‡æ¡ä»¶
&lt;/h2>&lt;ul>
&lt;li>å®‰è£…å¥½çš„ &lt;code>clash&lt;/code> .(é»˜è®¤åœ¨ &lt;code>/usr/bin/clash&lt;/code> è·¯å¾„ä¸‹)&lt;/li>
&lt;li>iptables&lt;/li>
&lt;li>systemd ï¼ˆä½ å®Œå…¨å¯ä»¥ä½¿ç”¨å…¶ä»–çš„å¯åŠ¨ç¨‹åºï¼Œè¿™ä¸è¿‡åœ¨è¿™é‡Œæˆ‘åªå±•ç¤ºsystemdçš„é…ç½®è¿‡ç¨‹ï¼Œå› ä¸ºå¤§å¤šæ•°GNU/Linuxå‘è¡Œç‰ˆé»˜è®¤ä½¿ç”¨systemdï¼‰&lt;/li>
&lt;li>crontab&lt;/li>
&lt;/ul>
&lt;h2 id="æ­¥éª¤">æ­¥éª¤
&lt;/h2>&lt;h3 id="åˆ›å»ºä¸€ä¸ªåä¸ºclashçš„ç³»ç»Ÿç”¨æˆ·">åˆ›å»ºä¸€ä¸ªåä¸ºclashçš„ç³»ç»Ÿç”¨æˆ·
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">useradd -r -M -s /usr/sbin/nologin clash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”±äºæˆ‘ä»¬è¦åšå…¨å±€çš„é€æ˜ä»£ç†ï¼ˆä»£ç†ç½‘å¡ä¸Šçš„å…¨éƒ¨æµé‡ï¼‰ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦é¿å…ä»£ç†è½¯ä»¶å‘å‡ºçš„æµé‡å†æ¬¡è¿›å…¥ä»£ç†è½¯ä»¶å½¢æˆå›è·¯æ— é™å¾ªç¯ã€‚&lt;/p>
&lt;p>å› æ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ç”¨æˆ· &lt;code>clash&lt;/code> (åå­—å¯ä»¥æ˜¯ä»»æ„çš„ï¼Œä½†è¦ä¸€è‡´) æ¥è¿è¡Œä»£ç†è½¯ä»¶ã€‚
ä¹‹åé€šè¿‡iptablesçš„è§„åˆ™å°† &lt;code>clash&lt;/code> ç”¨æˆ·çš„æµé‡åˆ†ç¦»å‡ºæ¥ã€‚&lt;/p>
&lt;h3 id="åˆ›å»ºiptableså’Œè·¯ç”±è§„åˆ™">åˆ›å»ºiptableså’Œè·¯ç”±è§„åˆ™
&lt;/h3>&lt;p>åˆ›å»ºä¸€ä¸ªå†…å®¹æ˜¯iptableså‘½ä»¤çš„shellè„šæœ¬ &lt;code>/etc/clash/iptables.sh&lt;/code>.&lt;/p>
&lt;p>æ–‡ä»¶åŒ…å«ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š&lt;/p>
&lt;ol>
&lt;li>iptablesè§„åˆ™ç”¨äºåŠ«æŒDNSè¯·æ±‚æµé‡&lt;/li>
&lt;li>PREROUTING ä¸­ &lt;code>clash&lt;/code> é“¾çš„é…ç½®&lt;/li>
&lt;li>OUTPUT ä¸­ &lt;code>clash_local&lt;/code> é“¾çš„é…ç½®&lt;/li>
&lt;/ol>
&lt;p>iptables ç¤ºæ„å›¾:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ PREROUTING INPUT â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ /â”€â”€â”€\ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â” â”‚ / \ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”œâ”€â”€â”¤â–ºâ”‚rawâ”œâ”€â–ºâ”‚conntrackâ”œâ”€â–ºâ”‚mangleâ”œâ”€â–ºâ”‚natâ”œâ”€â”¼â”€â”€â”€â”€â”€â”€â–º&amp;lt;routing&amp;gt;â”€â”€â”€â”€â”€â”€â”¤â–ºâ”‚mangleâ”œâ”€â–ºâ”‚filterâ”œâ”€â”¤â–ºâ”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â”‚ \ / â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ \â”€â”¬â”€/ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚mangleâ—„â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ Network â”‚ â”‚ â””â”€â”€â”¬â”€â”€â”€â”˜ â”‚ â”‚ Local â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚Interfaceâ”‚ â”‚ â”‚ â”‚ FORWARD â”‚ Process â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”Œâ”€â”€â–¼â”€â”€â”€â” â”‚ /â”€â”€â”€\ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¤filterâ”‚ â”‚ / \ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚ &amp;lt;routing&amp;gt;â—„â”€â”¤ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â”‚ \ / â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ \â”€â”¬â”€/ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â” â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â”‚ â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â” â”‚ / \ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â” â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚â—„â”€â”¼â”€â”¤natâ”‚â—„â”€â”¤mangleâ”‚â—„â”œâ”€â”€â”€&amp;lt;reroute&amp;gt;â”€â”€â”€â”¼â”€â”¤filterâ”‚â—„â”€â”¤natâ”‚â—„â”€â”¤mangleâ”‚â—„â”€â”¤conntrackâ”‚â—„â”€â”¤rawâ”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚ \check/ â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ POSTROUTING OUTPUT â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>/etc/clash/iptables.sh&lt;/code> å†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/usr/bin/env bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># set -ex é€‰é¡¹è¯´æ˜:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -e å½“æœ‰å‘½ä»¤ä»¥é0å€¼é€€å‡ºæ—¶ç«‹åˆ»ç»“æŸæ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -x å½“å‘½ä»¤æ‰§è¡Œæ—¶æ‰“å°å‘½ä»¤åŠå…¶å‚æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> -ex
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ENABLE ipv4 forward&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sysctl -w net.ipv4.ip_forward&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ROUTE RULES&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip rule add fwmark &lt;span class="m">666&lt;/span> table &lt;span class="m">666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route add &lt;span class="nb">local&lt;/span> 0.0.0.0/0 table &lt;span class="m">666&lt;/span> dev lo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## hijack the dns query traffic ##&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è½¬å‘ä»å±€åŸŸç½‘æ”¶åˆ°çš„æ‰€æœ‰ DNS æŸ¥è¯¢æµé‡åˆ° 1053 ç«¯å£&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ­¤æ“ä½œä¼šå¯¼è‡´æ‰€æœ‰ DNS è¯·æ±‚å…¨éƒ¨è¿”å›è™šå‡ IP(fake ip 198.18.0.1/16)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -I PREROUTING -p udp --dport &lt;span class="m">53&lt;/span> -j REDIRECT --to &lt;span class="m">1053&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ipv6 åŒæ ·é…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -I PREROUTING -p udp --dport &lt;span class="m">53&lt;/span> -j REDIRECT --to &lt;span class="m">1053&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è½¬å‘ä»æ‰€æœ‰æœ¬æœºè¿›ç¨‹ï¼ˆé™¤å»uidä¸ºclashçš„è¿›ç¨‹ï¼‰æ”¶åˆ°çš„æ‰€æœ‰ DNS æŸ¥è¯¢æµé‡åˆ° 1053 ç«¯å£&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ­¤æ“ä½œä¼šå¯¼è‡´æ‰€æœ‰ DNS è¯·æ±‚å…¨éƒ¨è¿”å›è™šå‡ IP(fake ip 198.18.0.1/16)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -N clash_dns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -A OUTPUT -p udp --dport &lt;span class="m">53&lt;/span> -j clash_dns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -A clash_dns -m owner --uid-owner clash -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -A clash_dns -p udp -j REDIRECT --to-ports &lt;span class="m">1053&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ipv6 åŒæ ·é…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -N clash_dns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -A OUTPUT -p udp --dport &lt;span class="m">53&lt;/span> -j clash_dns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -A clash_dns -m owner --uid-owner clash -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -A clash_dns -p udp -j REDIRECT --to-ports &lt;span class="m">1053&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##############################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## config for `clash` chain ##&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##############################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># `clash` é“¾è´Ÿè´£åˆ©ç”¨tproxyå°†æµé‡è½¬å‘åˆ°clashçš„7893ç«¯å£&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -N clash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç›®æ ‡åœ°å€ä¸ºå±€åŸŸç½‘æˆ–ä¿ç•™åœ°å€çš„æµé‡è·³è¿‡å¤„ç†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¿ç•™åœ°å€å‚è€ƒ:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># https://zh.wikipedia.org/wiki/%E5%B7%B2%E5%88%86%E9%85%8D%E7%9A%84/8_IPv4%E5%9C%B0%E5%9D%80%E5%9D%97%E5%88%97%E8%A1%A8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># https://zh.wikipedia.org/wiki/%E4%B8%93%E7%94%A8%E7%BD%91%E7%BB%9C&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IANA - Local Identification&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 0.0.0.0/8 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IANA - Loopback&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 127.0.0.0/8 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IANA - Private Use&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 10.0.0.0/8 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 172.16.0.0/12 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 192.168.0.0/16 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IPv4 Link-Local Addresses&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 169.254.0.0/16 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Multicast&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 224.0.0.0/4 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Future Use&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -d 240.0.0.0/4 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å…¶ä»–æ‰€æœ‰æµé‡è½¬å‘åˆ° 7893 ç«¯å£ï¼Œå¹¶æ‰“ä¸Š mark&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -p tcp -j TPROXY --on-port &lt;span class="m">7893&lt;/span> --tproxy-mark &lt;span class="m">666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash -p udp -j TPROXY --on-port &lt;span class="m">7893&lt;/span> --tproxy-mark &lt;span class="m">666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å°† `clash` é“¾åŠ åœ¨PREROUTINGé“¾åé¢ä½¿å…¶ç”Ÿæ•ˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A PREROUTING -j clash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## config for `clash_local` chain ##&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># `clash_local` é“¾è´Ÿè´£å¤„ç†æœ¬æœºçš„æœ¬åœ°è¿›ç¨‹å‘å‡ºçš„æµé‡ï¼šç»™å‘å¾€å…¬ç½‘çš„æµé‡æ‰“ä¸Š666æ ‡è®°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (ä¹‹åä¼šrerouteç»™loè®¾å¤‡ï¼Œç„¶åä¼šåœ¨PREROUTINGä¸­çš„clashé“¾ä¸Šè½¬å‘åˆ°tproxy 7893ç«¯å£)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -N clash_local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># nerdctl å®¹å™¨æµé‡é‡æ–°è·¯ç”±&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#iptables -t mangle -A clash_local -i nerdctl2 -p udp -j MARK --set-mark 666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#iptables -t mangle -A clash_local -i nerdctl2 -p tcp -j MARK --set-mark 666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·³è¿‡å†…ç½‘æµé‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 0.0.0.0/8 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 127.0.0.0/8 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 10.0.0.0/8 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 172.16.0.0/12 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 192.168.0.0/16 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 169.254.0.0/16 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 224.0.0.0/4 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -d 240.0.0.0/4 -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¸ºæœ¬æœºå‘å‡ºçš„æµé‡æ‰“ mark&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># clash_local é“¾ä¼šä¸ºæœ¬æœºæµé‡æ‰“ mark, æ‰“è¿‡ mark çš„æµé‡ä¼šé‡æ–°å›åˆ°device loï¼Œå†ä»PREROUTINGå¼€å§‹èµ°æµç¨‹.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -p tcp -j MARK --set-mark &lt;span class="m">666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A clash_local -p udp -j MARK --set-mark &lt;span class="m">666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·³è¿‡æ¥è‡ªæœåŠ¡ç«¯å£çš„æµé‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># https web server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># iptables -t mangle -I OUTPUT -p tcp --sport 443 -j RETURN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># transmission&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># iptables -t mangle -I OUTPUT -p tcp --sport 51413 -j RETURN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è·³è¿‡ clash ç¨‹åºæœ¬èº«å‘å‡ºçš„æµé‡, é˜²æ­¢æ­»å¾ªç¯(clash ç¨‹åºéœ€è¦ä½¿ç”¨ &amp;#34;clash&amp;#34; ç”¨æˆ·å¯åŠ¨)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A OUTPUT -p tcp -m owner --uid-owner clash -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A OUTPUT -p udp -m owner --uid-owner clash -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å°† `clash_local` é“¾åŠ åœ¨ OUTPUT é“¾åé¢ä½¿å…¶ç”Ÿæ•ˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -A OUTPUT -j clash_local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#######################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## unimportant staff ##&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#######################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¿®å¤ ICMP(ping)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¿™å¹¶ä¸èƒ½ä¿è¯ ping ç»“æœæœ‰æ•ˆ(clash ç­‰ä¸æ”¯æŒè½¬å‘ ICMP), åªæ˜¯è®©å®ƒæœ‰è¿”å›ç»“æœè€Œå·²&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># --to-destination è®¾ç½®ä¸ºä¸€ä¸ªå¯è¾¾çš„åœ°å€å³å¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#sysctl -w net.ipv4.conf.all.route_localnet=1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#iptables -t nat -A PREROUTING -p icmp -d 198.18.0.0/16 -j DNAT --to-destination 127.0.0.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#iptables -t nat -A OUTPUT -p icmp -d 198.18.0.0/16 -j DNAT --to-destination 127.0.0.1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“æ‰§è¡Œå®Œä¸Šè¿°è„šæœ¬åï¼Œiptablesçš„çŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ PREROUTING rule1* INPUT â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â”‚ /â”€â”€â”€\ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”´â”€â” â”‚ / \ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”œâ”€â”€â”¤â–ºâ”‚rawâ”œâ”€â–ºâ”‚conntrackâ”œâ”€â–ºâ”‚mangleâ”œâ”€â–ºâ”‚natâ”œâ”€â”¼â”€â”€â”€â”€â”€â”€â–º&amp;lt;routing&amp;gt;â”€â”€â”€â”€â”€â”€â”¤â–ºâ”‚mangleâ”œâ”€â–ºâ”‚filterâ”œâ”€â”¤â–ºâ”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â”‚ \ / â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â”‚ \â”€â”¬â”€/ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”Œâ”€â”€â”´â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚clashâ”‚ â”‚ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚mangleâ—„â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ Network â”‚ â”‚ â””â”€â”€â”¬â”€â”€â”€â”˜ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Local â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚Interfaceâ”‚ â”‚ â”‚ â”‚ FORWARD â”‚clash_localâ”‚ â”‚ Process â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”Œâ”€â”€â–¼â”€â”€â”€â” â”‚ â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ /â”€â”€â”€\ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¤filterâ”‚ â”‚ â”‚ / \ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”œâ”€â”€â”€rule3* &amp;lt;routing&amp;gt;â—„â”€â”¤ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ \ / â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”œâ”€â”€â”€rule2* \â”€â”¬â”€/ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â” â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â”‚ â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â” â”‚ / \ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”´â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â” â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚â—„â”€â”¼â”€â”¤natâ”‚â—„â”€â”¤mangleâ”‚â—„â”œâ”€â”€â”€&amp;lt;reroute&amp;gt;â”€â”€â”€â”¼â”€â”¤filterâ”‚â—„â”€â”¤natâ”‚â—„â”€â”¤mangleâ”‚â—„â”€â”¤conntrackâ”‚â—„â”€â”¤rawâ”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚ \check/ â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”¬â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”‚ â”‚ â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ POSTROUTING â”‚ OUTPUT â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â” â”‚ â”‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚clash_dnsâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *rule1: iptables -t nat -I PREROUTING -p udp --dport 53 -j REDIRECT --to 1053
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *rule2: iptables -t mangle -A OUTPUT -p tcp -m owner --uid-owner clash -j RETURN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *rule3: iptables -t mangle -A OUTPUT -p udp -m owner --uid-owner clash -j RETURN
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç ”ç©¶ä¸€ä¸‹ &lt;code>iptables.sh&lt;/code> ä¸­çš„è·¯ç”±è§„åˆ™:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">ip rule add fwmark &lt;span class="m">666&lt;/span> table &lt;span class="m">666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route add &lt;span class="nb">local&lt;/span> 0.0.0.0/0 table &lt;span class="m">666&lt;/span> dev lo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>ip rule&lt;/code> ç”¨äºæ§åˆ¶ç­–ç•¥è·¯ç”±æ•°æ®åº“ï¼Œç®¡ç†ç­–ç•¥è·¯ç”±çš„è·¯ç”±é€‰æ‹©ç®—æ³•&lt;/p>
&lt;p>è¿™é‡Œ &lt;code>ip rule&lt;/code> å‘½ä»¤è®©å†…æ ¸å¯¹æ ‡è®°æœ‰666çš„æ•°æ®åŒ…æŸ¥æ‰¾666å·è·¯ç”±è¡¨&lt;/p>
&lt;p>&lt;a class="link" href="http://linux-ip.net/html/tools-ip-rule.html" target="_blank" rel="noopener"
>ip rule å‚è€ƒæ–‡æ¡£&lt;/a>&lt;/p>
&lt;p>&lt;code>ip route&lt;/code> å‘½ä»¤åœ¨666å·è·¯ç”±è¡¨ä¸­æ·»åŠ äº†ä¸€æ¡åˆ°loè®¾å¤‡çš„é»˜è®¤è·¯ç”±&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code>ip route show table 666&lt;/code> æ¥æŸ¥çœ‹ &lt;code>ip route add local 0.0.0.0/0 table 666 dev lo&lt;/code> æ·»åŠ çš„è·¯ç”±é¡¹&lt;/p>
&lt;p>æŸ¥çœ‹è·¯ç”±è¡¨ç¼–å·å’Œåç§°çš„æ˜ å°„ï¼š
&lt;code>cat /etc/iproute2/rt_tables&lt;/code>&lt;/p>
&lt;h3 id="åˆ›å»ºè§„åˆ™æ¸…ç†è„šæœ¬">åˆ›å»ºè§„åˆ™æ¸…ç†è„šæœ¬
&lt;/h3>&lt;p>åœ¨é€€å‡ºclashåéœ€æ¸…é™¤è®¾å®šçš„è§„åˆ™&lt;/p>
&lt;p>&lt;code>-D&lt;/code> æˆ– &lt;code>--delete&lt;/code>:&lt;/p>
&lt;p>ä»æ‰€é€‰é“¾ä¸­åˆ æ‰ä¸€æ¡æˆ–å¤šæ¡è§„åˆ™ã€‚
å¯ä»¥æŒ‡å®šè¦åˆ é™¤çš„è§„åˆ™å·ï¼›æˆ–æŒ‡å®šè§„åˆ™å†…å®¹ï¼ˆå°† &lt;code>-A&lt;/code>ã€&lt;code>-I&lt;/code> æ›¿æ¢æˆ &lt;code>-D&lt;/code> å³å¯ï¼‰&lt;/p>
&lt;p>&lt;code>-F&lt;/code> or &lt;code>--flush&lt;/code>:&lt;/p>
&lt;p>åˆ·æ–°æ‰€é€‰é“¾ï¼Œç›¸å½“äºé€æ¡æ¸…é™¤é“¾ä¸Šçš„æ‰€æœ‰è§„åˆ™&lt;/p>
&lt;p>&lt;code>-X&lt;/code> or &lt;code>--delete-chain&lt;/code>:&lt;/p>
&lt;p>åˆ é™¤ç”¨æˆ·å®šä¹‰çš„é“¾&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/usr/bin/env bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> -ex
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip rule del fwmark &lt;span class="m">666&lt;/span> table &lt;span class="m">666&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route del &lt;span class="nb">local&lt;/span> 0.0.0.0/0 table &lt;span class="m">666&lt;/span> dev lo &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -D PREROUTING -p udp --dport &lt;span class="m">53&lt;/span> -j REDIRECT --to &lt;span class="m">1053&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -D PREROUTING -p udp --dport &lt;span class="m">53&lt;/span> -j REDIRECT --to &lt;span class="m">1053&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -D OUTPUT -p udp --dport &lt;span class="m">53&lt;/span> -j clash_dns &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -D OUTPUT -p udp --dport &lt;span class="m">53&lt;/span> -j clash_dns &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -F clash_dns &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t nat -X clash_dns &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -F clash_dns &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip6tables -t nat -X clash_dns &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#iptables -t nat -D PREROUTING -p icmp -d 198.18.0.0/16 -j DNAT --to-destination 127.0.0.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#iptables -t nat -D OUTPUT -p icmp -d 198.18.0.0/16 -j DNAT --to-destination 127.0.0.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -D PREROUTING -j clash &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -F clash &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -X clash &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -D OUTPUT -p tcp -m owner --uid-owner clash -j RETURN &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -D OUTPUT -p udp -m owner --uid-owner clash -j RETURN &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -D OUTPUT -j clash_local &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -F clash_local &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -t mangle -X clash_local &lt;span class="o">||&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä¿®æ­£ping">ä¿®æ­£ping
&lt;/h3>&lt;p>fake-ip æ¨¡å¼çš„ä¸€ä¸ªä¸»è¦ç¼ºç‚¹æ˜¯æ— æ³•ping&lt;/p>
&lt;p>å‰é¢ &lt;code>iptables.sh&lt;/code> ä¸­å°†æ‰€æœ‰pingè¯·æ±‚é‡å®šå‘åˆ°127.0.0.1 çš„æ“ä½œæ˜¯æ©è€³ç›—é“ƒçš„ï¼Œå®ƒä¸æä¾›ä»»ä½•ä¿¡æ¯ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œå¯ä»¥é€šè¿‡clashç”¨æˆ·çš„èº«ä»½è¿›è¡Œping&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">alias&lt;/span> &lt;span class="nv">ping&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;sudo -u clash ping&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æä¾›systemd-unit-file-ä»¥ä¸€é”®å¯åŠ¨clashåŠç›¸å…³iptablesç­‰é…ç½®">æä¾›systemd unit file ä»¥ä¸€é”®å¯åŠ¨clashåŠç›¸å…³iptablesç­‰é…ç½®
&lt;/h3>&lt;p>æ­¤æ­¥éª¤æ˜¯å¯é€‰çš„ï¼Œä½†æˆ‘è§‰å¾—èƒ½å¤Ÿä¸€é”®å¯åŠ¨/å…³é—­clashå¾ˆæ–¹ä¾¿ã€‚&lt;/p>
&lt;p>åŒæ—¶ä¹Ÿå¯ä»¥è®¾ç½®clashå¼€æœºå¯åŠ¨ã€‚&lt;/p>
&lt;p>Systemd é…ç½®æ–‡ä»¶å‘½åä¸º&lt;code>clash.service&lt;/code> ï¼Œæ”¾åœ¨ &lt;code>/usr/lib/systemd/system&lt;/code> ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ &lt;code>sudo systemctl start clash&lt;/code> æ¥å¯åŠ¨è¿è¡Œclash&lt;/p>
&lt;p>å¼€æœºå¯åŠ¨ï¼š &lt;code>sudo systemctl enable clash&lt;/code>.&lt;/p>
&lt;h3 id="é…ç½®clash">é…ç½®clash
&lt;/h3>&lt;p>ä¸‹é¢çœ‹ä¸€çœ‹å¯¹clashæœ¬èº«çš„é…ç½®&lt;/p>
&lt;p>clash ä½¿ç”¨ &lt;code>-d&lt;/code> é€‰é¡¹å¾—åˆ°é…ç½®æ–‡ä»¶ç›®å½•ï¼› &lt;code>-f&lt;/code> é€‰é¡¹å¾—åˆ°é…ç½®æ–‡ä»¶&lt;/p>
&lt;p>å½“ &lt;code>-f&lt;/code> è¢«å¿½ç•¥æ—¶ï¼Œé»˜è®¤çš„é…ç½®æ–‡ä»¶åæ˜¯ &lt;code>config.yaml&lt;/code>&lt;/p>
&lt;p>æˆ‘ä»¬æƒ³è¦é€šè¿‡ &lt;code>crontab&lt;/code> ä»clashçš„è®¢é˜…é“¾æ¥ä¸­å®šæ—¶æ›´æ–°clashçš„é…ç½®æ–‡ä»¶&lt;/p>
&lt;h4 id="æ„é€ è®¢é˜…è¿æ¥">æ„é€ è®¢é˜…è¿æ¥
&lt;/h4>&lt;p>TL;DR. å°†ä¸‹é¢URLä¸­&lt;code>XXXXXXXX&lt;/code> æ›¿æ¢æˆ&lt;a class="link" href="https://www.urlencoder.io/" target="_blank" rel="noopener"
>URL Encodeåçš„&lt;/a>èŠ‚ç‚¹è®¢é˜…URLå³å¯&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">https://sub.xeton.dev/sub?target=clash&amp;amp;new_name=true&amp;amp;filename=config.yaml&amp;amp;url=XXXXXXXX&amp;amp;config=https%3A%2F%2Fgist.githubusercontent.com%2Fcld4h%2F9a03ec2f826a25be5ab974fdbc540de4%2Fraw%2Fconfig.ini
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ‘ä»¬é€šè¿‡&lt;a class="link" href="https://github.com/tindy2013/subconverter" target="_blank" rel="noopener"
>subconverter&lt;/a>æ¥ç”Ÿæˆclashçš„é…ç½®æ–‡ä»¶ã€‚&lt;/p>
&lt;p>ä½ éœ€è¦ä¿®æ”¹è®¢é˜…é“¾æ¥ä¸­çš„ä¸€äº›å‚æ•°ä»¥ä½¿å¾—ç”Ÿæˆçš„clashæ­£ç¡®é…ç½®æˆ &lt;strong>ç›‘å¬tproxy&lt;/strong> ä»¥åŠ &lt;strong>fake-ip&lt;/strong> æ¨¡å¼&lt;/p>
&lt;p>å…·ä½“çš„ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;code>url&lt;/code> å‚æ•°è¦æ˜¯æ­£ç¡®çš„èŠ‚ç‚¹ä¿¡æ¯å¹¶ä¸”ç»è¿‡&lt;a class="link" href="https://www.urlencoder.io/" target="_blank" rel="noopener"
>URL Encode&lt;/a>.&lt;/li>
&lt;li>å¤šä¸ªèŠ‚ç‚¹è®¢é˜…URLè¦ç”¨ &lt;code>|&lt;/code> åˆ†å‰², æ­¤ç¬¦å·&lt;a class="link" href="https://www.urlencoder.io/" target="_blank" rel="noopener"
>URL Encode&lt;/a> ä¹‹åæ˜¯ &lt;code>%7C&lt;/code> .&lt;/li>
&lt;li>&lt;code>config&lt;/code> å‚æ•°æ˜¯ç”¨äºå‘Šè¯‰subconverterå¦‚ä½•è¿›è¡Œè®¢é˜…è½¬æ¢çš„å…³é”®ï¼Œåº”å½“&lt;a class="link" href="https://gist.githubusercontent.com/cld4h/9a03ec2f826a25be5ab974fdbc540de4/raw/config.ini" target="_blank" rel="noopener"
>é…ç½®æ­£ç¡®&lt;/a>. âš ï¸&lt;/li>
&lt;/ol>
&lt;p>âš ï¸ æ³¨æ„: è¿™é‡Œsubconverter çš„é…ç½®æ–‡ä»¶éå¸¸é‡è¦&lt;/p>
&lt;p>&lt;a class="link" href="https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online.ini" target="_blank" rel="noopener"
>ACL4SSR é¡¹ç›®æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„subconverteré…ç½®æ–‡ä»¶&lt;/a>ï¼Œè¿™ä¸ªæ–‡ä»¶æ²¡é—®é¢˜ï¼Œä½†é»˜è®¤çš„é€‰é¡¹ä¸è¶³ä»¥è®©clashå¼€å¯fake-ipæ¨¡å¼å¹¶ç›‘å¬tproxy&lt;/p>
&lt;p>è¦æƒ³ä½¿å…¶å·¥ä½œï¼Œéœ€æŒ‡å®š &lt;code>clash_rule_base&lt;/code>ï¼š åœ¨&lt;a class="link" href="https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online.ini" target="_blank" rel="noopener"
>å…¶&lt;/a>ä¸­æ’å…¥ä¸‹é¢è¿™ä¸€è¡Œ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">clash_rule_base=https://gist.githubusercontent.com/cld4h/9a03ec2f826a25be5ab974fdbc540de4/raw/clash-base-config.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸€è¡Œçš„ä½œç”¨æ˜¯å‘Šè¯‰subconverterä½¿ç”¨&lt;a class="link" href="https://gist.githubusercontent.com/cld4h/9a03ec2f826a25be5ab974fdbc540de4/raw/clash-base-config.yaml" target="_blank" rel="noopener"
>URLä¸­çš„æ–‡ä»¶&lt;/a>ä½œä¸ºclashçš„åŸºç¡€é…ç½®&lt;/p>
&lt;p>æˆ–è€…ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨&lt;a class="link" href="https://gist.githubusercontent.com/cld4h/9a03ec2f826a25be5ab974fdbc540de4/raw/config.ini" target="_blank" rel="noopener"
>æˆ‘çš„config.ini&lt;/a>&lt;/p>
&lt;p>ç¤ºä¾‹URL:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">https://sub.xeton.dev/sub? --- åç«¯åœ°å€
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">target=clash --- å®¢æˆ·ç«¯ç±»å‹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;new_name=true --- é‡å‘½å
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;filename=config.yaml --- æ–‡ä»¶å
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;url= --- èŠ‚ç‚¹ä¿¡æ¯
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ss%3A%2F%2FYmYtY2ZiOnRlc3QvIUAjOkAxOTIuMTY4LjEwMC4xOjg4ODg%23example-server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">%7C --- åˆ†éš”ç¬¦ |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ss%3A%2F%2FYmYtY2ZiOnRlc3QvIUAjOkAxOTIuMTY4LjEwMC4xOjg4ODg%23example-server-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;config= --- subconverterçš„é…ç½®æ–‡ä»¶; .ini æ ¼å¼
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https%3A%2F%2Fgist.githubusercontent.com%2Fcld4h%2F9a03ec2f826a25be5ab974fdbc540de4%2Fraw%2Fconfig.ini
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --- ä¸‹é¢è¿™äº›é…ç½®æ˜¯å¤šä½™çš„ï¼Œæ²¡å•¥ç”¨
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;list=false --- ç”¨äºè¾“å‡º Surge Node List æˆ–è€… Clash Proxy Provider æˆ–è€… Quantumult (X) çš„èŠ‚ç‚¹è®¢é˜… æˆ–è€… è§£ç åçš„ SIP002
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;tfo=false --- ç”¨äºå¼€å¯è¯¥è®¢é˜…é“¾æ¥çš„ TCP Fast Openï¼Œé»˜è®¤ä¸º false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;scv=false --- ç”¨äºå…³é—­ TLS èŠ‚ç‚¹çš„è¯ä¹¦æ£€æŸ¥ï¼Œé»˜è®¤ä¸º false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;fdn=false --- ç”¨äºè¿‡æ»¤ç›®æ ‡ç±»å‹ä¸æ”¯æŒçš„èŠ‚ç‚¹ï¼Œé»˜è®¤ä¸º true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;amp;sort=false --- ç”¨äºå¯¹è¾“å‡ºçš„èŠ‚ç‚¹æˆ–ç­–ç•¥ç»„æŒ‰èŠ‚ç‚¹åè¿›è¡Œå†æ¬¡æ’åºï¼Œé»˜è®¤ä¸º false
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="è®¾ç½®å®šæ—¶æ›´æ–°è®¢é˜…ä»»åŠ¡">è®¾ç½®å®šæ—¶æ›´æ–°è®¢é˜…ä»»åŠ¡
&lt;/h4>&lt;p>åˆ›å»ºè®¢é˜…æ›´æ–°è„šæœ¬ &lt;code>/etc/clash/update-config.sh&lt;/code> ï¼Œå†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/usr/bin/env bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="nb">set&lt;/span> -ex
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/bin/curl &lt;span class="s2">&amp;#34;https://sub.xeton.dev/sub?target=clash&amp;amp;new_name=true&amp;amp;filename=config.yaml&amp;amp;url=XXXXXXXX&amp;amp;config=https%3A%2F%2Fgist.githubusercontent.com%2Fcld4h%2F9a03ec2f826a25be5ab974fdbc540de4%2Fraw%2Fconfig.ini&amp;#34;&lt;/span> -o /etc/clash/config.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>âš ï¸ ä¸Šé¢çš„URLè¦æ›¿æ¢ä¸€ä¸‹&lt;/p>
&lt;p>æ‰‹åŠ¨æ‰§è¡Œä¸€ä¸‹ä¸Šè¿°è„šæœ¬ç¡®è®¤é…ç½®æ–‡ä»¶èƒ½å¤Ÿæ­£å¸¸ç”Ÿæˆã€‚&lt;/p>
&lt;p>ç¡®ä¿ä½ çš„clash&lt;code>config.yaml&lt;/code>é…ç½®æ–‡ä»¶ä¸­æœ‰å¦‚ä¸‹å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">tproxy-port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">7893&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">dns&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">listen&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0.0.0.0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">1053&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enhanced-mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">fake-ip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fake-ip-range&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">198.18.0.1&lt;/span>&lt;span class="l">/16&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ·»åŠ &lt;a class="link" href="https://crontab.guru" target="_blank" rel="noopener"
>å®šæ—¶ä»»åŠ¡&lt;/a>ï¼š æ‰§è¡Œ &lt;code>sudo crontab -e&lt;/code> å¹¶åŠ å…¥ä¸‹é¢è¿™ä¸€è¡Œä»¥åœ¨æ¯å¤©æ—©ä¸Š10:00æ‰§è¡Œè®¢é˜…æ›´æ–°è„šæœ¬ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="m">0&lt;/span> &lt;span class="m">10&lt;/span> * * * /usr/bin/bash /etc/clash/update-config.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item></channel></rss>
<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content=" 注意：本篇文章中提到的内容可能存在过时问题，另外有很多软件我已不再使用或反对使用，请小心！ 参考： http://valleycat.org/linux/arch-usb.html\n准备过程 下载iso 进入 https://www.archlinux.org/download/ 找到最近的镜像源下载iso即可\n"><title>Archlinux 安装</title>
<link rel=canonical href=https://cld4h.github.io/blog/zh-cn/p/archlinux-%E5%AE%89%E8%A3%85/><link rel=stylesheet href=/blog/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css><meta property='og:title' content="Archlinux 安装"><meta property='og:description' content=" 注意：本篇文章中提到的内容可能存在过时问题，另外有很多软件我已不再使用或反对使用，请小心！ 参考： http://valleycat.org/linux/arch-usb.html\n准备过程 下载iso 进入 https://www.archlinux.org/download/ 找到最近的镜像源下载iso即可\n"><meta property='og:url' content='https://cld4h.github.io/blog/zh-cn/p/archlinux-%E5%AE%89%E8%A3%85/'><meta property='og:site_name' content='cld4h 的博客'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2019-09-24T15:31:24+08:00'><meta property='article:modified_time' content='2022-02-20T16:38:30+08:00'><meta property='og:image' content='https://archlinux.org/static/logos/archlinux-logo-dark-scalable.518881f04ca9.svg'><meta name=twitter:title content="Archlinux 安装"><meta name=twitter:description content=" 注意：本篇文章中提到的内容可能存在过时问题，另外有很多软件我已不再使用或反对使用，请小心！ 参考： http://valleycat.org/linux/arch-usb.html\n准备过程 下载iso 进入 https://www.archlinux.org/download/ 找到最近的镜像源下载iso即可\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://archlinux.org/static/logos/archlinux-logo-dark-scalable.518881f04ca9.svg'></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/blog/zh-cn/><img src=/blog/img/avataaars_hu_25972a44ed8b91a1.png width=300 height=318 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🏡</span></figure><div class=site-meta><h1 class=site-name><a href=/blog/zh-cn>cld4h 的博客</a></h1><h2 class=site-description>Self sufficient!</h2></div></header><ol class=menu-social><li><a href=mailto:cld4h@disroot.org target=_blank title=email rel=me><svg class="icon icon-tabler icon-tabler-email" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M4 5.5s16 0 16 0c1.19.0 2 .13 2 1.5V17.5C22 18.87 21.19 19 20 19H4C2.81 19 2 18.87 2 17.5V7c0-1.37.81-1.5 2-1.5z"/><path d="M2.5 6c2 2 4 4 5.58 5.25C9.67 12.5 10.83 13 12 13s2.33-.5 3.92-1.75C17.5 10 19.5 8 21.5 6"/><path d="M8.5 12c-2 1.67-4 3.33-6 5"/><path d="M15.5 12c2 1.67 4 3.33 6 5"/></svg></a></li><li><a href=https://github.com/cld4h target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=/blog/about/#rss-links target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=/blog/about/#xmpp target=_blank title=xmpp:cld4h@disroot.org rel=me><svg class="icon icon-tabler icon-tabler-messages" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M21 14l-3-3h-7a1 1 0 01-1-1V4a1 1 0 011-1h9a1 1 0 011 1v10"/><path d="M14 15v2a1 1 0 01-1 1H6l-3 3V11a1 1 0 011-1h2"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/blog/blog target=_blank><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/blog/zh-cn/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li><a href=/blog/zh-cn/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索</span></a></li><li><a href=/blog/zh-cn/%E5%85%B3%E4%BA%8E/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://cld4h.github.io/blog/>English</option><option value=https://cld4h.github.io/blog/zh-tw/>中文正體</option><option value=https://cld4h.github.io/blog/zh-cn/ selected>中文简体</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/blog/zh-cn/p/archlinux-%E5%AE%89%E8%A3%85/><img src=https://archlinux.org/static/logos/archlinux-logo-dark-scalable.518881f04ca9.svg loading=lazy alt="Featured image of post Archlinux 安装"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/blog/zh-cn/p/archlinux-%E5%AE%89%E8%A3%85/>Archlinux 安装</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 24, 2019</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 6 分钟</time></div></footer></div></header><section class=article-content><mark>注意：本篇文章中提到的内容可能存在过时问题，另外有很多软件我已不再使用或反对使用，请小心！</mark><p>参考：
<a class=link href=http://valleycat.org/linux/arch-usb.html target=_blank rel=noopener>http://valleycat.org/linux/arch-usb.html</a></p><h2 id=准备过程>准备过程</h2><ul><li>下载iso</li></ul><p>进入 <a class=link href=https://www.archlinux.org/download/ target=_blank rel=noopener>https://www.archlinux.org/download/</a> 找到最近的镜像源下载iso即可</p><ul><li>刷入U盘</li></ul><p><a class=link href=https://wiki.archlinux.org/index.php/USB_flash_installation_media target=_blank rel=noopener>参见</a></p><p>运行下述命令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl> dd <span class=nv>bs</span><span class=o>=</span>4M <span class=k>if</span><span class=o>=</span>path/to/archlinux.iso <span class=nv>of</span><span class=o>=</span>/dev/sdx <span class=nv>status</span><span class=o>=</span>progress <span class=nv>oflag</span><span class=o>=</span>sync
</span></span></code></pre></td></tr></table></div></div><ul><li>启动进入Live CD</li></ul><h3 id=调整live-archlinux-root-分区的大小>调整Live archlinux root 分区的大小</h3><p><a class=link href=https://www.ostechnix.com/adjust-size-root-partition-live-arch-linux/ target=_blank rel=noopener>参见</a></p><p>启动时按下 <strong>e</strong> 或 tab 键以修改内核参数</p><p>在 <code>linux=...initrd=...</code> 后添加 <code>cow_spacesize=1G</code></p><p>如果没有在启动时修改内核参数，可以在启动后执行下述命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mount -o remount,size<span class=o>=</span>1G /run/archiso/cowspace
</span></span></code></pre></td></tr></table></div></div><p>cow 是 Copy On Write 的缩写，额外的空间使用的是内存</p><h2 id=开始安装无桌面环境等>开始安装（无桌面环境等）</h2><h3 id=验证系统启动模式uefibios>验证系统启动模式：UEFI/BIOS</h3><p>查看 <code>/sys/firmware/efi/efivars</code> 文件夹中的内容</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ls /sys/firmware/efi/efivars
</span></span></code></pre></td></tr></table></div></div><p>若有返回文件列表，则证明是在UEFI模式下
(或通过 <code>efivar -l</code> 命令也可查看)</p><h3 id=连接网络>连接网络</h3><p>通过 <code>ip link</code> 查看连接情况</p><p>镜像默认启动时启动了 <code>dhcpcd</code> 服务</p><p>通过 <code>ping www.baidu.coom</code> 确认能上网</p><h3 id=设置系统时间与ntp服务器同步>设置系统时间与NTP服务器同步</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>timedatectl set-ntp <span class=nb>true</span>
</span></span></code></pre></td></tr></table></div></div><p>通过 <code>timedatectl status</code> 命令检查服务状态</p><h3 id=磁盘分区>磁盘分区</h3><p>先 <code>lsblk</code> 一下确定磁盘名</p><p>通过 <code>gdisk /dev/sdX</code> xzyy 全盘清空</p><p>通过 <code>cgdisk</code> 进行分区</p><p>下表中的分区方式支持BIOS和UEFI</p><div class=table-wrapper><table><thead><tr><th>编码</th><th>文件系统类型</th><th>分区大小</th><th>设备名(示例)</th></tr></thead><tbody><tr><td>ef02</td><td>BIOS System</td><td>10MiB</td><td>/dev/sda1</td></tr><tr><td>ef00</td><td>EFI System</td><td>500MiB</td><td>/dev/sda2</td></tr><tr><td>8300</td><td>Linux File System</td><td>剩余全部空间</td><td>/dev/sda3</td></tr></tbody></table></div><p>swap 不设固定分区，由 swap 文件方式设置</p><p>格式化分区：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mkfs.fat -F32 /dev/sda2 <span class=c1>#EFI System</span>
</span></span><span class=line><span class=cl>mkfs.ext4 /dev/sda3 <span class=c1>#Linux File System</span>
</span></span></code></pre></td></tr></table></div></div><p>不对 <code>/dev/sda1</code> 进行格式化</p><p>挂载分区：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mount /dev/sda3 /mnt
</span></span><span class=line><span class=cl>mkdir /mnt/boot
</span></span><span class=line><span class=cl>mount /dev/sda2 /mnt/boot
</span></span></code></pre></td></tr></table></div></div><h3 id=设置镜像源>设置镜像源</h3><p><a class=link href="https://www.archlinux.org/mirrorlist/?country=all&amp;protocol=http&amp;ip_version=6" target=_blank rel=noopener>支持IPv6的镜像源</a>
<a class=link href=https://www.archlinux.org/mirrorlist/ target=_blank rel=noopener>镜像源列表生成器</a></p><p>编辑 <code>/etc/pacman.d/mirrorlist</code> 文件</p><p>创建和编辑 <code>/etc/pacman.d/mirrorlist</code> 文件之后，使用下面命令刷新镜像：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pacman -Syyu
</span></span></code></pre></td></tr></table></div></div><p>传入两次 <code>--refresh</code> 或 <code>-y</code> 将强制更新所有软件包，即使系统认为它们已经是最新。</p><p><strong>每次修改镜像之后都应该使用</strong><code>pacman -Syyu</code></p><p><a class=link href=https://wiki.archlinux.org/index.php/Mirrors target=_blank rel=noopener>参考</a></p><h3 id=安装软件>安装软件</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pacstrap -i /mnt base base-devel vim ntfs-3g networkmanager shadowsocks-libev
</span></span></code></pre></td></tr></table></div></div><p><code>-i</code> 选项表示"交互的(interactive)"</p><h3 id=创建swap文件>创建swap文件</h3><p>我没有固定设置swap分区，而是使用了swap文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo fallocate -l 1G /mnt/swapfile
</span></span></code></pre></td></tr></table></div></div><p>If fallocate is not installed or if you get an error message saying fallocate failed: Operation not supported then you can use the following command to create the swap file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo dd <span class=k>if</span><span class=o>=</span>/dev/zero <span class=nv>of</span><span class=o>=</span>/mnt/swapfile <span class=nv>bs</span><span class=o>=</span><span class=m>1024</span> <span class=nv>count</span><span class=o>=</span><span class=m>1048576</span>
</span></span></code></pre></td></tr></table></div></div><p>设置swapfile文件权限</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo chmod <span class=m>600</span> /mnt/swapfile
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo mkswap /mnt/swapfile
</span></span><span class=line><span class=cl>sudo swapon /mnt/swapfile
</span></span></code></pre></td></tr></table></div></div><p>生成 <code>/etc/fstab</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
</span></span></code></pre></td></tr></table></div></div><p>修改 <code>/etc/fstab</code> ，保证路径正确</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/swapfile none swap defaults 0 0
</span></span></code></pre></td></tr></table></div></div><p>验证 <code>swap</code> 已挂载</p><ol><li><code>sudo swapon --show</code></li><li><code>sudo free -h</code></li></ol><h3 id=chroot>chroot</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>arch-chroot /mnt
</span></span></code></pre></td></tr></table></div></div><h3 id=设置时区>设置时区</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</span></span></code></pre></td></tr></table></div></div><p>运行 <code>hwclock</code> 以生成 <code>/etc/adjtime</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>hwclock --systohc
</span></span></code></pre></td></tr></table></div></div><h3 id=本地化>本地化</h3><p>编辑 <code>/etc/locale.gen</code> 文件，将 <code>en_US.UTF-8 UTF-8</code> 取消注释
之后运行 <code>locale-gen</code> 命令</p><p>新建 <code>/etc/locale.conf</code> 文件，将 <code>LANG</code> 变量设置为对应值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>LANG=en_US.UTF-8
</span></span></code></pre></td></tr></table></div></div><h3 id=网络配置>网络配置</h3><p>编辑 <code>/etc/hostname</code> 文件，起一个好听好记的名字
如 <code>USB</code></p><p>编辑 <code>/etc/hosts</code> 文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>127.0.0.1	localhost
</span></span><span class=line><span class=cl>::1		localhost
</span></span><span class=line><span class=cl>127.0.1.1	USB.localdomain	USB
</span></span></code></pre></td></tr></table></div></div><h3 id=针对于将系统安装在-portable-usb-key上>针对于将系统安装在 portable USB key上</h3><h4 id=ram-disk-image>RAM disk image</h4><p><a class=link href=http://valleycat.org/linux/arch-usb.html#RAM_disk target=_blank rel=noopener>参见</a></p><p>(不用看this paragraph)
In order to boot the Linux Kernel persistently off of a USB device, some adjustments may be necessary to the initial RAM disk image. We need to ensure that block device support is properly loaded before any attempt at loading the filesystem. This not always the way a RAM disk image is configured in a generic Linux installation, and I suspect this may be another one of the failure points in other Linux USB installations out there. To configure a custom RAM disk image, open <code>/etc/mkinitcpio.conf</code> in an editor:</p><p>Ensure the <strong>block</strong> hook comes <strong>before</strong> the <strong>filesystems</strong> hook and <strong>directly after</strong> the <strong>udev</strong> hook like the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>HOOKS=(base udev block filesystems keyboard fsck)
</span></span></code></pre></td></tr></table></div></div><p>Now regenerate the initial RAM disk image with the changes made:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mkinitcpio -p linux
</span></span></code></pre></td></tr></table></div></div><h4 id=network-interface-names>network interface names</h4><p>Arch Linux&rsquo;s basic service manager, systemd, assigns network interfaces predictable names based on the actual device hardware. This is great for just about any other type of install, but can pose some problems for the portable USB installation we&rsquo;re going for. To ensure that the ethernet and wifi interfaces will always be respectively named <em>eth0</em> and <em>wlan0</em>, revert the Arch Linux USB back to traditional device naming:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ln -s /dev/null /etc/udev/rules.d/80-net-setup-link.rules
</span></span></code></pre></td></tr></table></div></div><h4 id=journal-config>journal config</h4><p>A default installation of Arch Linux is setup with systemd to continuously journal various information about current processes and write that data to storage on disk. For a persistent bootable installation on a flash memory device, however, we can change some options in <code>journald.conf</code> to enable journal keeping entirely in RAM (thus reducing writes to the flash device). To control where journal data is stored, open <code>/etc/systemd/journald.conf</code> in and editor, to switch journal data storage to RAM, set the storage variable to volatile by ensuring the following line is uncommented:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Storage=volatile
</span></span></code></pre></td></tr></table></div></div><p>As an additional precaution, to ensure the operating system doesn&rsquo;t overfill RAM with journal data, set the max-use variable by adding the line:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SystemMaxUse=16M
</span></span></code></pre></td></tr></table></div></div><h4 id=mount-options>mount options</h4><p>Modern filesystems are able to record various metadata (last accessed, last modified, user rights, etc.) about their files. A default filesystem mount generally keeps track of as much as this information as possible. For a persistent bootable operating system on a flash memory device, however, we should limit some of this record keeping in order to reduce writes to the flash device. Using the <code>noatime</code> mount option in fstab will disable the record keeping of file access times: no writes will occur when a file is read, only when it is modified.</p><p>To disable record keeping of file access times for the bootable USB, open /etc/fstab in an editor, change the mount options from <code>relatime</code> to <code>noatime</code>.</p><h3 id=root-密码>Root 密码</h3><p>通过 <code>passwd</code> 修改root密码</p><h3 id=boot-loader>Boot loader</h3><p>参考：
<a class=link href=http://valleycat.org/linux/arch-usb.html#bootloader target=_blank rel=noopener>BIOS and UEFI</a></p><ol><li>确保 <code>grub</code> 和 <code>efibootmgr</code> 已安装</li><li>确保 EFI 系统分区已经挂载（前面通过 <code>mount /dev/sda2 /mnt/boot</code> 挂载，对于此时 (chroot 之后) 来说，挂载点为 <code>/boot</code>），</li><li>运行</li></ol><p>同时安装两个启动项 <a class=link href=http://valleycat.org/linux/arch-usb.html#bootloader target=_blank rel=noopener>BIOS and UEFI</a>
Setup GRUB for MBR/BIOS booting mode:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>grub-install --target<span class=o>=</span>i386-pc --boot-directory /boot /dev/sda
</span></span></code></pre></td></tr></table></div></div><p>Setup GRUB for UEFI booting mode:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>grub-install --target<span class=o>=</span>x86_64-efi --efi-directory /boot --boot-directory /boot --removable
</span></span></code></pre></td></tr></table></div></div><p><a class=link href=https://wiki.archlinux.org/index.php/GRUB#Installation_2 target=_blank rel=noopener>GRUB</a> wiki中推荐的安装指令(与前面UEFI安装类似)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>grub-install --target<span class=o>=</span>x86_64-efi --efi-directory<span class=o>=</span>/boot --bootloader-id<span class=o>=</span>GRUB
</span></span></code></pre></td></tr></table></div></div><ol start=4><li>可以安装 <code>os-prober</code> 软件包并运行来检测其他OS</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo pacman -S os-prober
</span></span><span class=line><span class=cl>os-prober
</span></span></code></pre></td></tr></table></div></div><ol start=5><li>生成 <code>grub.cfg</code> 配置文件</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>grub-mkconfig -o /boot/grub/grub.cfg
</span></span></code></pre></td></tr></table></div></div><h3 id=网络>网络</h3><p>Install the ifplugd package to configure automatic IP leasing on ethernet devices:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pacman -S ifplugd
</span></span></code></pre></td></tr></table></div></div><p>Download the packages to enable wifi support with a basic command line interface:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pacman -S iw wpa_supplicant dialog
</span></span></code></pre></td></tr></table></div></div><p>安装 NetworkManager 并设置开机启动</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo pacman -S networkmanager
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> NetworkManager
</span></span></code></pre></td></tr></table></div></div><h3 id=显卡>显卡</h3><p>To support most common GPUs, install all four basic open source video drivers:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pacman -S xf86-video-ati xf86-video-intel xf86-video-nouveau xf86-video-vesa
</span></span></code></pre></td></tr></table></div></div><h3 id=触摸板>触摸板</h3><p>Install support for standard notebook touchpads:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pacman -S xf86-input-synaptics
</span></span></code></pre></td></tr></table></div></div><p>在 <code>.xinitrc</code> 文件中 <code>exec</code> 前添加</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>synclient <span class=nv>TapButton1</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl>synclient <span class=nv>TapButton2</span><span class=o>=</span><span class=m>3</span>
</span></span><span class=line><span class=cl>synclient <span class=nv>TapButton3</span><span class=o>=</span><span class=m>2</span>
</span></span><span class=line><span class=cl>synclient <span class=nv>VertScrollDelta</span><span class=o>=</span>-111
</span></span></code></pre></td></tr></table></div></div><h3 id=电池>电池</h3><p>Install support for checking battery charge and state:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pacman -S acpi
</span></span></code></pre></td></tr></table></div></div><h3 id=针对于ssd的trim指令的优化>针对于SSD的TRIM指令的优化</h3><p>将持续TRIM改为定时TRIM</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> fstrim.timer
</span></span></code></pre></td></tr></table></div></div><p>参见
<a class=link href=https://www.digitalocean.com/community/tutorials/how-to-configure-periodic-trim-for-ssd-storage-on-linux-servers target=_blank rel=noopener>https://www.digitalocean.com/community/tutorials/how-to-configure-periodic-trim-for-ssd-storage-on-linux-servers</a></p><h3 id=创建用户>创建用户</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>useradd -m -G wheel,storage hao
</span></span><span class=line><span class=cl><span class=c1># useradd -m -g users -G wheel,storage -s /bin/bash hao</span>
</span></span></code></pre></td></tr></table></div></div><p><code>-m</code> 选项创建home目录
<code>-g</code> 选项指定所在组
<code>-G</code> 选项指定包含所创建用户的额外的组
<code>-s</code> 选项指定用户所用的shell</p><p>运行上面的没有注释的命令会创建一个用户 <code>hao</code>(UID=1000) 和一个组 <code>hao</code>(GID=1000)</p><p>我们想把组 <code>hao</code>(GID=1000) 删除，把用户 <code>hao</code>(UID=1000) 更改到组 <code>users</code> 下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>usermod -g users -G wheel,storage,power hao
</span></span><span class=line><span class=cl>groupdel hao
</span></span></code></pre></td></tr></table></div></div><p>其他的可用命令 <code>useradd</code>,<code>userdel</code>,<code>groupadd</code>,<code>groupdel</code></p><h4 id=编辑-etcsudoers>编辑 <code>/etc/sudoers</code></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>EDITOR</span><span class=o>=</span>vim visudo
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>##
</span></span><span class=line><span class=cl>## User privilege specification
</span></span><span class=line><span class=cl>##
</span></span><span class=line><span class=cl>root ALL=(ALL) ALL
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## Uncomment to allow members of group wheel to exec
</span></span><span class=line><span class=cl>ute any command
</span></span><span class=line><span class=cl># %wheel ALL=(ALL) ALL
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## Same thing without a password
</span></span><span class=line><span class=cl># %wheel ALL=(ALL) NOPASSWD: ALL
</span></span><span class=line><span class=cl>%wheel ALL=(ALL) NOPASSWD: ALL
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## This keeps you from needing to reinsert your pass
</span></span><span class=line><span class=cl>words in each different terminal a wheel user uses s
</span></span><span class=line><span class=cl>udo in
</span></span><span class=line><span class=cl>Defaults !tty_tickets
</span></span></code></pre></td></tr></table></div></div><h2 id=安装图形界面>安装图形界面</h2><h3 id=安装-xorg-x>安装 X.org (X)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pacman -S xorg-server xorg-xinit
</span></span></code></pre></td></tr></table></div></div><p>输入 <code>xinit</code> 或 <code>startx</code> 后， X Server 会读取 <code>$HOME/.xinitrc</code> 来查找如何启动
如，要启动 i3，则在<code>$HOME/.xinitrc</code>中添加 <code>exec i3</code></p><h3 id=安装-i3-等相关程序>安装 i3 等相关程序</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pacman -S i3 dmenu ttf-dejavu firefox alacritty ranger
</span></span></code></pre></td></tr></table></div></div><h3 id=中文字体>中文字体</h3><p>环境变量 <code>LANG=zh_CN.UTF-8</code></p><ul><li><code>.bashrc</code>：每次<strong>终端登录</strong>时读取并运用里面的设置。</li><li><code>.xinitrc</code>：每次<code>startx</code> <strong>启动X界面</strong>时读取并运用里面的设置。</li><li><code>.xprofile</code>：每次使用<strong>gdm等图形登录</strong>时读取并运用里面的设置。</li></ul><p>在 <code>.xinitrc</code> 或 <code>.xprofile</code>中添加下面三行内容</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>export</span> <span class=n>LANG</span><span class=o>=</span><span class=n>zh_CN</span><span class=o>.</span><span class=n>UTF</span><span class=o>-</span><span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=k>export</span> <span class=n>LANGUAGE</span><span class=o>=</span><span class=n>zh_CN</span><span class=p>:</span><span class=n>en_US</span>
</span></span><span class=line><span class=cl><span class=k>export</span> <span class=n>LC_CTYPE</span><span class=o>=</span><span class=n>en_US</span><span class=o>.</span><span class=n>UTF</span><span class=o>-</span><span class=mi>8</span>
</span></span></code></pre></td></tr></table></div></div><p>安装思源字体</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pacman -S adobe-source-han-sans-cn-fonts adobe-source-han-serif-cn-fonts
</span></span></code></pre></td></tr></table></div></div><h3 id=中文输入法搜狗拼音输入法>中文输入法&mdash;<del>搜狗拼音输入法</del></h3><p><mark>强烈反对使用搜狗拼音输入法，建议使用自由的rime输入法。前者不但可能存在后门；配置时还有很多坑。</mark></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo pacman -S fcitx fcitx-im fcitx-configtool
</span></span></code></pre></td></tr></table></div></div><p>由于搜狗拼音输入法不在官方仓库中，我们可以用AUR，也可以添加非官方仓库[archlinuxcn]</p><p>编辑 <code>/etc/pacman.conf</code>，在所有仓库之后加入如下内容</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[archlinuxcn]
</span></span><span class=line><span class=cl>#SigLevel = Never
</span></span><span class=line><span class=cl>Include = /etc/pacman.d/archlinuxcn.mirrorlist
</span></span></code></pre></td></tr></table></div></div><p>编辑 <code>/etc/pacman.d/archlinuxcn.mirrorlist</code> 文件
加入如下内容</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>## 清华大学 (ipv4, ipv6, http, https)
</span></span><span class=line><span class=cl>Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## 中国科学技术大学 (ipv4, ipv6, http, https)
</span></span><span class=line><span class=cl>Server = https://mirrors.ustc.edu.cn/archlinuxcn/$arch
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## Our main server (ipv4, ipv6, http, https)
</span></span><span class=line><span class=cl>## Our main server located in Netherlands
</span></span><span class=line><span class=cl>Server = https://repo.archlinuxcn.org/$arch
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## 浙江大学 (浙江杭州) (ipv4, ipv6, http, https)
</span></span><span class=line><span class=cl>## Added: 2017-06-05
</span></span><span class=line><span class=cl>Server = https://mirrors.zju.edu.cn/archlinuxcn/$arch
</span></span></code></pre></td></tr></table></div></div><p>运行 <code>sudo pacman -Syyu</code> 和 <code>sudo pacman -S archlinuxcn-keyring</code></p><blockquote><p>pacman 清除缓存
<code>sudo pacman -Sc</code></p></blockquote><p><a class=link href=https://github.com/archlinuxcn/mirrorlist-repo target=_blank rel=noopener>更多源参见</a></p><p><del>安装搜狗拼音输入法</del></p><p><mark>！请不要安装搜狗拼音输入法！</mark></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># sudo pacman -S fcitx-sogoupinyin
</span></span><span class=line><span class=cl>sudo pacman -S fcitx-rime
</span></span></code></pre></td></tr></table></div></div><p>在 <code>~/.profile</code> 文件中加入下面几个环境变量：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GTK_IM_MODULE</span><span class=o>=</span>fcitx
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>QT_IM_MODULE</span><span class=o>=</span>fcitx
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>XMODIFIERS</span><span class=o>=</span><span class=s2>&#34;@im=fcitx&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>在 <code>.xinitrc</code> 中添加</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>fcitx <span class=p>&amp;</span>
</span></span></code></pre></td></tr></table></div></div><p>或在 i3配置文件中添加 <code>exec_always fcitx</code></p><h3 id=安装-virtualbox>安装 virtualbox</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo pacman -S linux-headers virtualbox virtualbox-guest-iso
</span></span></code></pre></td></tr></table></div></div><h3 id=修改键位>修改键位</h3><h4 id=使用-xmodmap>使用 <code>xmodmap</code></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>xmodmap -pke &gt; ~/.xmodmap
</span></span></code></pre></td></tr></table></div></div><p><code>xev</code> 可以查看keycode</p><p>编辑上一步得到的 <code>~/.xmodmap</code>文件，对应的keycode作修改
在文件开始处添加</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>clear control
</span></span><span class=line><span class=cl>clear lock
</span></span><span class=line><span class=cl>clear mod1
</span></span></code></pre></td></tr></table></div></div><p>在文件结尾处添加</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>add control =Control_L Control_R
</span></span><span class=line><span class=cl>add mod1 = Alt_L
</span></span></code></pre></td></tr></table></div></div><p>执行 xmodmap <code>~/.xmodmap</code></p><h3 id=安装无道词典>安装无道词典</h3><mark>我现在使用的是另一个程序：<a href=https://github.com/TimothyYe/ydict>ydict</a></mark><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo pacman -S python python-pip
</span></span><span class=line><span class=cl>sudo pip install bs4
</span></span><span class=line><span class=cl>sudo pip install lxml
</span></span></code></pre></td></tr></table></div></div><p><strong>注意，无道词典与variety冲突时，只需要pip uninstall 冲突的包即可</strong></p><h3 id=配置neovim>配置neovim</h3><p>将<code>.config/nvim/init.vim</code> 软链接到 <code>~/.vimrc</code>
编辑<code>~/.vimrc</code>
使用<code>vim-plug</code>工具管理vim插件
在vim中通过<code>:PlugInstall</code>安装插件<a class=link href=https://github.com/junegunn/vim-plug/wiki/tutorial#installing-plugins target=_blank rel=noopener>参考</a></p><h4 id=ultisnips-需要python支持>UltiSnips 需要python支持</h4><p>由于UltiSnips需要python支持，当启动neovim时，若没有pynvim包，则会报错：</p><blockquote><p>UltiSnips: the Python version from g:UltiSnipsUsePythonVersion (3) is not available.</p></blockquote><p>解决方案：pip安装pynvim</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo pip install -U pynvim
</span></span></code></pre></td></tr></table></div></div><h3 id=美化主题>美化主题</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># for GTK
</span></span><span class=line><span class=cl>sudo pacman -S lxappearance
</span></span><span class=line><span class=cl># for qt5
</span></span><span class=line><span class=cl>sudo pacman -S qt5ct
</span></span></code></pre></td></tr></table></div></div><p>更换桌面壁纸</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>sudo</span> <span class=n>pacman</span> <span class=o>-</span><span class=n>S</span> <span class=n>feh</span> <span class=n>variety</span>
</span></span></code></pre></td></tr></table></div></div><p>终端半透明</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo pacman -S compton
</span></span></code></pre></td></tr></table></div></div><p>alacritty: <code>.config/alacritty/config.yml</code> 设置 <code>opacity</code></p></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>最后更新于 Feb 20, 2022 16:38 CST</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><footer class=site-footer><section class=copyright>&copy;
2019 -
2025 cld4h 的博客</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.26.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/blog/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>
<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="VS Code allows us to connect to a remote envirnoment. This is very convenient especially for developing and testing code on cloud computing servers.\nHowever, starting with VS Code release 1.99 (March 2025), the prebuilt servers distributed by VS Code are only compatible with Linux distributions that are based on glibc 2.28 or later.\nThis create connection problems for users of Compute Canada. Specifically, connections to Graham and Niagara because of the no longer supported CentOS7 system.\n"><title>Workaround: VSCode Remote on Compute Canada CentOS7 Server</title>
<link rel=canonical href=https://cld4h.github.io/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/><link rel=stylesheet href=/blog/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css><meta property='og:title' content="Workaround: VSCode Remote on Compute Canada CentOS7 Server"><meta property='og:description' content="VS Code allows us to connect to a remote envirnoment. This is very convenient especially for developing and testing code on cloud computing servers.\nHowever, starting with VS Code release 1.99 (March 2025), the prebuilt servers distributed by VS Code are only compatible with Linux distributions that are based on glibc 2.28 or later.\nThis create connection problems for users of Compute Canada. Specifically, connections to Graham and Niagara because of the no longer supported CentOS7 system.\n"><meta property='og:url' content='https://cld4h.github.io/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/'><meta property='og:site_name' content="cld4h's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2025-05-16T00:00:00+00:00'><meta property='article:modified_time' content='2025-05-16T00:00:00+00:00'><meta name=twitter:title content="Workaround: VSCode Remote on Compute Canada CentOS7 Server"><meta name=twitter:description content="VS Code allows us to connect to a remote envirnoment. This is very convenient especially for developing and testing code on cloud computing servers.\nHowever, starting with VS Code release 1.99 (March 2025), the prebuilt servers distributed by VS Code are only compatible with Linux distributions that are based on glibc 2.28 or later.\nThis create connection problems for users of Compute Canada. Specifically, connections to Graham and Niagara because of the no longer supported CentOS7 system.\n"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/blog/><img src=/blog/img/avataaars_hu_25972a44ed8b91a1.png width=300 height=318 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🏡</span></figure><div class=site-meta><h1 class=site-name><a href=/blog>cld4h's blog</a></h1><h2 class=site-description>Self sufficient!</h2></div></header><ol class=menu-social><li><a href=mailto:cld4h@disroot.org target=_blank title=email rel=me><svg class="icon icon-tabler icon-tabler-email" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M4 5.5s16 0 16 0c1.19.0 2 .13 2 1.5V17.5C22 18.87 21.19 19 20 19H4C2.81 19 2 18.87 2 17.5V7c0-1.37.81-1.5 2-1.5z"/><path d="M2.5 6c2 2 4 4 5.58 5.25C9.67 12.5 10.83 13 12 13s2.33-.5 3.92-1.75C17.5 10 19.5 8 21.5 6"/><path d="M8.5 12c-2 1.67-4 3.33-6 5"/><path d="M15.5 12c2 1.67 4 3.33 6 5"/></svg></a></li><li><a href=https://github.com/cld4h target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=/blog/about/#rss-links target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=/blog/about/#xmpp target=_blank title=xmpp:cld4h@disroot.org rel=me><svg class="icon icon-tabler icon-tabler-messages" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M21 14l-3-3h-7a1 1 0 01-1-1V4a1 1 0 011-1h9a1 1 0 011 1v10"/><path d="M14 15v2a1 1 0 01-1 1H6l-3 3V11a1 1 0 011-1h2"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/blog/blog target=_blank><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/blog/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/blog/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/blog/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://cld4h.github.io/blog/ selected>English</option><option value=https://cld4h.github.io/blog/zh-tw/>中文正體</option><option value=https://cld4h.github.io/blog/zh-cn/>中文简体</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/>Workaround: VSCode Remote on Compute Canada CentOS7 Server</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>May 16, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><p>VS Code allows us to connect to a remote envirnoment. This is very convenient especially for developing and testing code on cloud computing servers.</p><p>However, <a class=link href=https://code.visualstudio.com/docs/remote/faq#_can-i-run-vs-code-server-on-older-linux-distributions target=_blank rel=noopener>starting with VS Code release <mark>1.99 (March 2025)</mark>, the prebuilt servers distributed by VS Code are only compatible with Linux distributions that are based on glibc 2.28 or later.</a></p><p>This create <a class=link href=https://docs.alliancecan.ca/wiki/Visual_Studio_Code#The_remote_session_does_not_work_anymore target=_blank rel=noopener>connection problems</a> for users of <a class=link href=https://alliancecan.ca/ target=_blank rel=noopener>Compute Canada</a>. Specifically, connections to Graham and Niagara because of the no longer supported CentOS7 system.</p><p>In this article, I&rsquo;ll show you all the steps I&rsquo;ve done to establish a <a class=link href=https://code.visualstudio.com/docs/remote/tunnels target=_blank rel=noopener>Remote Tunnel</a> and connect to the server.</p><h2 id=official-workaround-which-is-not-fully-working>Official Workaround (which is not fully working)</h2><p>Firstly I followed the <a class=link href=https://code.visualstudio.com/docs/remote/faq#_can-i-run-vs-code-server-on-older-linux-distributions target=_blank rel=noopener>VS Code official documentation</a>, to prepare a <code>sysroot</code>, a <code>patchelf</code> and set the three environment variables.</p><p>Long story short, it did not solve the problem but we still need these steps.</p><p>I don&rsquo;t want to repeate the steps mentioned in their official documentation, but several pitfalls worth mentioning:</p><ol><li>Build and run the crosstool-ng command <code>ct-ng build</code> on a docker environment (the Dockerfile is provided on the <a class=link href=https://code.visualstudio.com/docs/remote/faq#_can-i-run-vs-code-server-on-older-linux-distributions target=_blank rel=noopener>documentation</a> ), and compress the output <code>x86_64-linux-gnu</code> to send it to the server.</li><li>Set the 3 environment variables in <code>$HOME/.bash_profile</code> (Here I put the output from <code>ct-ng build</code> (the extracted <code>x86_64-linux-gnu</code> folder) under <code>$HOME/.local/share</code>)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>export</span> <span class=nv>VSCODE_SERVER_CUSTOM_GLIBC_LINKER</span><span class=o>=</span><span class=nv>$HOME</span>/.local/share/x86_64-linux-gnu/x86_64-linux-gnu/sysroot/lib64/ld-linux-x86-64.so.2
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>VSCODE_SERVER_CUSTOM_GLIBC_PATH</span><span class=o>=</span><span class=nv>$HOME</span>/.local/share/x86_64-linux-gnu/x86_64-linux-gnu/sysroot/lib64
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>VSCODE_SERVER_PATCHELF_PATH</span><span class=o>=</span><span class=nv>$HOME</span>/.local/bin/patchelf
</span></span></code></pre></td></tr></table></div></div><h2 id=remote-tunnels>Remote tunnels</h2><p>After failure of the official workarounds from VS Code, I noticed the suggestions from <a class=link href=https://docs.alliancecan.ca/wiki/Visual_Studio_Code#The_remote_session_does_not_work_anymore target=_blank rel=noopener>The Alliance wiki</a>:</p><blockquote><p>use the &ldquo;<mark>Remote Tunnels</mark>&rdquo; extension by running &lsquo;code tunnel&rsquo; (google <mark>vscode cli</mark> and download it). Use github or a microsoft account (OAuth) and connect to a remote vscode server, such as a niagara login node. You can have all the &ldquo;benefits&rdquo; of not using mfa as long as your server is running.</p></blockquote><p>First thing is to download the <a class=link href=https://code.visualstudio.com/Download target=_blank rel=noopener>VS Code CLI</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>wget -O vscode-cli.tar.gz <span class=s2>&#34;https://code.visualstudio.com/sha/download?build=stable&amp;os=cli-alpine-x64&#34;</span>
</span></span><span class=line><span class=cl>tar -xzvf vscode-cli.tar.gz -C <span class=nv>$HOME</span>/.local/bin/
</span></span><span class=line><span class=cl>rm vscode-cli.tar.gz
</span></span></code></pre></td></tr></table></div></div><p>On remote server, run <code>code tunnel</code> to start.</p><p><mark>Make sure environment variables (<code>echo $VSCODE_SERVER_CUSTOM_GLIBC_PATH</code> to check) are set</mark> from previous steps. Otherwise you&rsquo;ll get an error like this:</p><p><img src=/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/code_tunnel_error.png width=1085 height=582 srcset="/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/code_tunnel_error_hu_15abef57bc9208a7.png 480w, /blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/code_tunnel_error_hu_b825244fdcffad19.png 1024w" loading=lazy alt="code tunnel error" class=gallery-image data-flex-grow=186 data-flex-basis=447px></p><h2 id=manually-download-the-vscode-server-package>Manually download the vscode server package</h2><p>If you try to connect to the remote now, you will see the remote server keep crashing and on the remote server, vscode keeps downloading and extracting the server package.</p><p>What is the reason for this issue?</p><p>There must be some errors when we are trying to run the vscode server script.</p><p>Can we run it manually?</p><p>Here <a class=link href=https://github.com/cvcore target=_blank rel=noopener>@cvcore</a> provided <a class=link href=https://gist.github.com/cvcore/8e187163f41a77f5271c26a870e52778 target=_blank rel=noopener>a script for manually downloading the vscode-server</a></p><p>To run that script, we need to know the <code>commit_id</code>.</p><p>Go to your VS Code <mark>Client</mark>, on the top menu tabs, go to <code>Help</code>-><code>About</code> and you can see the commit id.</p><p><img src=/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/commit.png width=474 height=370 srcset="/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/commit_hu_d7db959512870239.png 480w, /blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/commit_hu_12c0b29005ac93d7.png 1024w" loading=lazy alt="commit id" class=gallery-image data-flex-grow=128 data-flex-basis=307px></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>/bin/bash -c <span class=s2>&#34;</span><span class=k>$(</span>curl -fsSL https://gist.githubusercontent.com/cvcore/8e187163f41a77f5271c26a870e52778/raw/download_vscode_server.sh<span class=k>)</span><span class=s2>&#34;</span> -- &lt;commit_id&gt;
</span></span></code></pre></td></tr></table></div></div><p>Replace <code>&lt;commit_id></code> with your actual commit id, run this command and it will download the vscode-server into your <code>$HOME/.vscode-server/bin/&lt;commit_id></code> folder.</p><h2 id=run-vscode-server-manually>Run vscode-server manually</h2><p>Now with the server downloaded in <code>$HOME/.vscode-server/bin/&lt;commit_id></code>, we can try to run it manually. But there will be an issue:</p><p>If you run the server <mark>with environment variables set</mark>, you can see the <code>patchelf</code> working but we still get an error:</p><p><img src=/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/run_server_1.png width=1098 height=444 srcset="/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/run_server_1_hu_aaa0e6b9c00d9c5c.png 480w, /blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/run_server_1_hu_a204d2cf2b51f0ae.png 1024w" loading=lazy alt="run server manually with env set" class=gallery-image data-flex-grow=247 data-flex-basis=593px></p><p>If you run the server <mark>without environment variables set</mark>, you&rsquo;ll also get an error:</p><p><img src=/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/run_server_2.png width=1099 height=715 srcset="/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/run_server_2_hu_cad1460ba84a3179.png 480w, /blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/run_server_2_hu_3cd96375b2b2a016.png 1024w" loading=lazy alt="run server manually without env set" class=gallery-image data-flex-grow=153 data-flex-basis=368px></p><p><a class=link href=https://docs.alliancecan.ca/wiki/Installing_software_in_your_home_directory#Installing_binary_packages target=_blank rel=noopener>Here is the SOLUTION to this problem. On the alliance wiki, it says</a>:</p><blockquote><p>If you install pre-compiled binaries in your home directory they may fail using errors such as <code>/lib64/libc.so.6: version 'GLIBC_2.18' not found</code>. Often such binaries can be patched using our <code>setrpaths.sh</code> script, using the syntax <code>setrpaths.sh --path path [--add_origin]</code> where path refers to the directory where you installed that software.</p></blockquote><p>The <code>setrpaths.sh</code> is hosted on <a class=link href=https://github.com/ComputeCanada/easybuild-computecanada-config/blob/main/setrpaths.sh target=_blank rel=noopener>their github repo here</a> but you don&rsquo;t need to download it. It&rsquo;s in your <code>PATH</code>
under the folder <code>/cvmfs/soft.computecanada.ca/easybuild/bin/</code></p><p>So here we simply run the following command (replace <code>&lt;commit_id></code> with the actual one):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>setrpaths.sh --path $HOME/.vscode-server/bin/&lt;commit_id&gt;
</span></span></code></pre></td></tr></table></div></div><p><img src=/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/run_server_3.png width=1090 height=463 srcset="/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/run_server_3_hu_2b748a878816f678.png 480w, /blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/run_server_3_hu_6ca08e4c8489ae30.png 1024w" loading=lazy alt="And now we can start the server manually with no errors. (Ctrl-C to kill it, we don’t need it now)" class=gallery-image data-flex-grow=235 data-flex-basis=565px></p><h2 id=modify-the-startup-script>Modify the startup script</h2><p>From the last step, we start the server from executing <code>./code-server</code>. This is just a shell script wrapping the node-js server executable:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/usr/bin/env sh
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Copyright (c) Microsoft Corporation. All rights reserved.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> in
</span></span><span class=line><span class=cl>        --inspect*<span class=o>)</span> <span class=nv>INSPECT</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span><span class=p>;</span> shift<span class=p>;;</span>
</span></span><span class=line><span class=cl><span class=k>esac</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>ROOT</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>dirname <span class=s2>&#34;</span><span class=k>$(</span>dirname <span class=s2>&#34;</span><span class=k>$(</span>readlink -f <span class=s2>&#34;</span><span class=nv>$0</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Set rpath before changing the interpreter path</span>
</span></span><span class=line><span class=cl><span class=c1># Refs https://github.com/NixOS/patchelf/issues/524</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> -n <span class=s2>&#34;</span><span class=nv>$VSCODE_SERVER_CUSTOM_GLIBC_LINKER</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> <span class=o>[</span> -n <span class=s2>&#34;</span><span class=nv>$VSCODE_SERVER_CUSTOM_GLIBC_PATH</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> <span class=o>[</span> -n <span class=s2>&#34;</span><span class=nv>$VSCODE_SERVER_PATCHELF_PATH</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;Patching glibc from </span><span class=nv>$VSCODE_SERVER_CUSTOM_GLIBC_PATH</span><span class=s2> with </span><span class=nv>$VSCODE_SERVER_PATCHELF_PATH</span><span class=s2>...&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;</span><span class=nv>$VSCODE_SERVER_PATCHELF_PATH</span><span class=s2>&#34;</span> --set-rpath <span class=s2>&#34;</span><span class=nv>$VSCODE_SERVER_CUSTOM_GLIBC_PATH</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$ROOT</span><span class=s2>/node&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;Patching linker from </span><span class=nv>$VSCODE_SERVER_CUSTOM_GLIBC_LINKER</span><span class=s2> with </span><span class=nv>$VSCODE_SERVER_PATCHELF_PATH</span><span class=s2>...&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;</span><span class=nv>$VSCODE_SERVER_PATCHELF_PATH</span><span class=s2>&#34;</span> --set-interpreter <span class=s2>&#34;</span><span class=nv>$VSCODE_SERVER_CUSTOM_GLIBC_LINKER</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$ROOT</span><span class=s2>/node&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;Patching complete.&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34;</span><span class=nv>$ROOT</span><span class=s2>/node&#34;</span> <span class=si>${</span><span class=nv>INSPECT</span><span class=k>:-</span><span class=si>}</span> <span class=s2>&#34;</span><span class=nv>$ROOT</span><span class=s2>/out/server-main.js&#34;</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Here you can see from line 14 to 20, it checkes the environment variables to patch glic and linker. We don&rsquo;t need that so <mark>comment out or remove</mark> those lines. Otherwise, by default, with 3 environment variables set, patching will be done and we will get the <code>FATAL: kernel too old</code> error.</p><h2 id=prepare-everything-in-the-correct-path>Prepare everything in the correct path</h2><p>(replace <code>&lt;commit_id></code> with the actual one)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>COMMIT_ID</span><span class=o>=</span>&lt;commit_id&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rm -rf <span class=nv>$HOME</span>/.vscode
</span></span><span class=line><span class=cl>mkdir -p <span class=nv>$HOME</span>/.vscode/cli/servers/Stable-<span class=nv>$COMMIT_ID</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF &gt; $HOME/.vscode/cli/servers/lru.json
</span></span></span><span class=line><span class=cl><span class=s>[&#34;Stable-$COMMIT_ID&#34;]
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>cp -r <span class=nv>$HOME</span>/.vscode-server/bin/<span class=nv>$COMMIT_ID</span> <span class=nv>$HOME</span>/.vscode/cli/servers/Stable-<span class=nv>$COMMIT_ID</span>/server
</span></span></code></pre></td></tr></table></div></div><p>Now you can start a <code>tmux</code> session and run <code>code tunnel</code> to start the server.</p><h2 id=results>Results</h2><p><img src=/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Server1.png width=1086 height=618 srcset="/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Server1_hu_5d9f8576a19f9754.png 480w, /blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Server1_hu_176770666c7e3078.png 1024w" loading=lazy alt="Start the server" class=gallery-image data-flex-grow=175 data-flex-basis=421px></p><p><img src=/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Auth.png width=766 height=820 srcset="/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Auth_hu_d1d20aa8821889ad.png 480w, /blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Auth_hu_7bfcb8778026f493.png 1024w" loading=lazy alt=Authentication class=gallery-image data-flex-grow=93 data-flex-basis=224px></p><p><img src=/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Server2.png width=1045 height=153 srcset="/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Server2_hu_2312fea3cc32348f.png 480w, /blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Server2_hu_4ee7b0f0a3bf7030.png 1024w" loading=lazy alt="Give the server a nickname" class=gallery-image data-flex-grow=683 data-flex-basis=1639px></p><p><img src=/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Connect1.png width=1083 height=578 srcset="/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Connect1_hu_49b11c512fb51090.png 480w, /blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Connect1_hu_db81bad2ddbd3d15.png 1024w" loading=lazy alt="Client connection: Open you local VS Code, press F1 key or click “Connect to…”" class=gallery-image data-flex-grow=187 data-flex-basis=449px></p><p><img src=/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Server3.png width=1088 height=585 srcset="/blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Server3_hu_944b4b93b6130b87.png 480w, /blog/p/workaround-vscode-remote-on-compute-canada-centos7-server/Server3_hu_6131e4e02c1377cf.png 1024w" loading=lazy alt="Server is running and we can see the connection from the client" class=gallery-image data-flex-grow=185 data-flex-basis=446px></p></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><footer class=site-footer><section class=copyright>&copy;
2019 -
2025 cld4h's blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.26.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/blog/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>